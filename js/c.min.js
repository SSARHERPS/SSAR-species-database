(function(){var u,l,k,d,H,A,b,s,i,D,n,p,r,G,v,q,z,h,y,c,a,B,o,t,f,E,g,j,C,F,m,w=[].slice;B=typeof exports!=="undefined"&&exports!==null?exports:this;p=function(I){return I===true||I===false};r=function(I){return !I||I.length===0};n=function(I){return !I||/^\s*$/.test(I)};v=function(J){try{if(r(J)||n(J)||(J==null)){if(!(J===false||J===0)){return true}}}catch(I){}return false};G=function(J){if(typeof J==="object"){return true}try{JSON.parse(J);return true}catch(I){}return false};q=function(I){return !isNaN(parseFloat(I))&&isFinite(I)};g=function(I){if(!q(I)||v(I)){return 0}return parseFloat(I)};j=function(I){if(!q(I)||v(I)){return 0}return parseInt(I)};function x(I){var K={};for(var J=0;J<I.length;++J){if(I[J]!==undefined){K[J]=I[J]}}return K}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(K){var J,I;I=0;for(J in K){if(K.hasOwnProperty(J)){I++}}return I};H=function(I,J){return setTimeout(J,I)};o=function(J,K){var I;if(K==null){K=0}I=Math.pow(10,K);return Math.round(J*I)/I};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};l=(function(I){return function(J){return encodeURI(J).split(/%..|./).length-1}})(this);function e(L){for(var J,I,K=L.length;K;J=Math.floor(Math.random()*K),I=L[--K],L[K]=L[J],L[J]=I){}return L}window.debounce_timer=null;({debounce:function(K,I,J){if(I==null){I=300}if(J==null){J=false}return function(){var M,L,N;M=1<=arguments.length?w.call(arguments,0):[];N=this;L=function(){if(!J){return K.apply(N,M)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(J){K.apply(N,M)}}return window.debounce_timer=setTimeout(L,I)}}});Function.prototype.debounce=function(){var L,K,O,J,M,I,N;I=arguments[0],J=arguments[1],N=arguments[2],L=4<=arguments.length?w.call(arguments,3):[];if(I==null){I=300}if(J==null){J=false}if(N==null){N=window.debounce_timer}M=this;K=function(){if(!J){M.apply(M,L)}return console.log("Debounce applied")};if(N!=null){try{clearTimeout(N)}catch(P){O=P}}else{if(J){M.apply(obj,L);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(K,I)};h=function(){return $(".newwindow").each(function(){var I,J;I=$(this).attr("href");J=function(K){if(K==null){return false}window.open(K);return false};$(this).click(function(){return J(I)});return $(this).keypress(function(){return J(I)})})};u=function(P,N){var K,O,L,I,J,M;if(P==null){P=50}if(N==null){N="#status-container"}try{if($(N).exists()){J=o(P*0.5);K=$(N).find(".ball");M=$(N).find(".ball1");K.removeClass("stop hide");K.css({width:""+P+"px",height:""+P+"px"});L=o(P/2+J/2+9);I=o((P+10)/2-(J+6)/2);M.removeClass("stop hide");M.css({width:""+J+"px",height:""+J+"px",top:"-"+L+"px","margin-left":""+I+"px"});return true}return false}catch(Q){O=Q;return console.log("Could not animate loader",O.message)}};f=function(J){var I,L,K;if(J==null){J="#status-container"}try{if($(J).exists()){I=$(J).find(".ball");K=$(J).find(".ball1");I.addClass("bballgood ballgood");K.addClass("bballgood ball1good");return H(250,function(){I.addClass("stop hide");I.removeClass("bballgood ballgood");K.addClass("stop hide");return K.removeClass("bballgood ballgood")})}}catch(M){L=M;return console.log("Could not stop load animation",L.message)}};E=function(J){var I,L,K;if(J==null){J="#status-container"}try{if($(J).exists()){I=$(J).find(".ball");K=$(J).find(".ball1");I.addClass("bballerror ballerror");K.addClass("bballerror ball1error");return H(1500,function(){I.addClass("stop hide");I.removeClass("bballerror ballerror");K.addClass("stop hide");return K.removeClass("bballerror ballerror")})}}catch(M){L=M;return console.log("Could not stop load error animation",L.message)}};$(function(){var I;try{window.picturefill()}catch(J){I=J;console.log("Could not execute picturefill.")}return h()});if(typeof c!=="object"){c=new Object()}c.goodbg="#cae682";c.badbg="#e5786d";if(c.minLength==null){c.minLength=8}if(c.overrideLength==null){c.overrideLength=21}F=new Object();F.mainStylesheetPath="css/otp_styles.css";F.popStylesheetPath="css/otp_panels.css";F.popClass="pop-panel";F.home="http://velociraptorsystems.com/samples/userhandler/test_page.php";d=function(){var I;I=$("#password").val();if(I.length>c.overrideLength||I.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",c.goodbg);c.basepwgood=true}else{$("#password").css("background",c.badbg);c.basepwgood=false}i();if(!v($("#password2").val())){k();C()}return false};k=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",c.goodbg);c.passmatch=true}else{$("#password2").css("background",c.badbg);c.passmatch=false}C();return false};C=function(){var J,I;try{J=!(c.passmatch&&c.basepwgood);return $("#createUser_submit").attr("disabled",J)}catch(K){I=K;c.passmatch=false;return c.basepwgood=false}};i=function(){var I,J,K;if(!$("#strength-meter").exists()){I="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(I)}J=$("#password").val();K=zxcvbn(J);$(".strength-eval").css("background",c.badbg);if(J.length>20){$(".strength-eval").css("background",c.goodbg)}else{if(J.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",c.goodbg)}if(J.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",c.goodbg)}if(J.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",c.goodbg)}}return $("#password-strength").attr("value",K.score+1)};A=function(){};s=function(P){var R,O,J,M,Q,N,I,K,L;if(P==null){P=F.home}y();u();J=$("#totp_code").val();L=$("#username").val();Q=$("#password").val();M=$("#remote").val();I=$.url();R="async_login_handler.php";K=I.attr("protocol")+"://"+I.attr("host")+"/"+I.attr("directory")+"/../"+R;O="action=verifytotp&code="+J+"&user="+L+"&password="+Q+"&remote="+M;N=$.post(K,O,"json");console.log("Checking",K+"?"+O);N.done(function(S){var U,T;if(S.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");T=0;return $.each(S.cookies.raw_cookie,function(W,Z){var X;try{$.cookie(W,Z,S.cookies.expires)}catch(Y){X=Y;console.error("Couldn't set cookies",S.cookies.raw_cookie)}T++;if(T===Object.size(S.cookies.raw_cookie)){if(P==null){P=I.attr("protocol")+"://"+I.attr("host")+"/"}f();console.log(S.cookies);return H(500,function(){return window.location.href=P})}})}catch(V){U=V;return console.error("Unexpected error while validating",U.message)}}else{$("#totp_message").text(S.human_error);$("#totp_code").val("");$("#totp_code").focus();E();return console.error("Invalid code error",S.error,S)}});return N.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",K+"?"+O,S,T);return E()})};b=function(){return y()};z=function(){var Q,N,L,O,P,M,I,J,K;y();u();K=$("#username").val();P=$("#password").val();L=$("#hash").val();O=$("#secret").val();I=$.url();Q="async_login_handler.php";J=I.attr("protocol")+"://"+I.attr("host")+"/"+I.attr("directory")+"/../"+Q;N="action=maketotp&password="+P+"&user="+K;M=$.post(J,N,"json");M.done(function(R){var V,U,T,W,X,S;if(R.status===true){S=R.svg;T=R.raw;X="show_secret";W="showAltBarcode";V="secretBarcode";U="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+X+"'>click here to manually input your key.</a></p> <div id='"+V+"'> "+R.svg+" <p>Don't see the barcode? <a href='#' id='"+W+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+K+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(U);$("#"+X).click(function(){return a(R.human_secret)});$("#"+W).click(function(){var Y;Y="<img src='"+R.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(Y)});$("#verify_totp_button").click(function(){y();return t(O,L)});$("#totp_verify").submit(function(){y();return t(O,L)});return f()}else{console.error("Couldn't generate TOTP code",J+"?"+N);$("#totp_message").text("There was an error generating your code. Please try again.");return E()}});M.fail(function(R,S){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",J+"?"+N,R,S);return E()});return false};t=function(P,M){var Q,O,J,N,I,K,L;y();J=$("#code").val();L=$("#username").val();I=$.url();Q="async_login_handler.php";K=I.attr("protocol")+"://"+I.attr("host")+"/"+I.attr("directory")+"/../"+Q;O="action=savetotp&secret="+P+"&user="+L+"&hash="+M+"&code="+J;console.log("Checking",K+"?"+O);N=$.post(K,O,"json");N.done(function(R){var S;if(R.status===true){S="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+R.backup+"</pre>";$("#totp_add").html(S);console.log("Success!");return f()}else{S="<p class='error' id='temp_error'>"+R.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(S)}else{$("#temp_error").html(S)}console.error(R.error);return E()}});return N.fail(function(R,S){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",R,S);return E()})};a=function(I){var J;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:F.popStylesheetPath}).appendTo("head");J="<div id='secret_id_panel' class='"+F.popClass+"'><p class='close-popup'>X</p><h2>"+I+"</h2></div>";$("#totp_add").after(J);return $(".close-popup").click(function(){return $("#secret_id_panel").remove()})};D=function(){var U,S,P,O,M,T,K,Q,J,R,I,L,N;I=$.url();U="async_login_handler.php";L=I.attr("protocol")+"://"+I.attr("host")+"/"+I.attr("directory")+"/../"+U;N=$("#username").val();S="action=cansms&user="+N;Q="remove_totp_link";R="send_totp_sms";M="alt_auth_pane";T="alt_auth_messages";O=new Object();O.remove="<a href='#' id='"+Q+"'>Remove two-factor authentication</a>";J=$.get(L,S,"json");J.done(function(V){if(V[0]===true){return O.sms="<a href='#' id='"+R+"'>Send SMS</a>"}});J.fail(function(V,W){return console.error("Could not check SMS-ability",V,W)});K="";$.each(O,function(W,V){return K+=V});P="<div id='"+M+"'><p>"+K+"</p><p id='"+T+"'></p></div>";$("#"+Q).click(function(){if(F.home==null){F.home=I.attr("protocol")+"://"+I.attr("host")+"/login.php"}return window.location.href=F.home+"?2fa=t"});return $("#"+R).click(function(){var V;S="action=sendtotptext&user="+N;V=$.get(L,S,"json");V.done(function(W){if(W.status===true){$("#"+M).remove();return $("#totp_message").text(W.message)}else{$("#"+T).addClass("error").text(W.human_error);return console.error(W.error)}});return V.fail(function(W,X){console.error("AJAX failure trying to send TOTP text",L+"?"+S);return console.error("Returns:",W,X)})})};m=function(){};y=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password").keyup(function(){return d()}).change(function(){return d()});$("#password2").change(function(){return k()}).keyup(function(){return k()});$("#totp_submit").submit(function(){return s()});$("#verify_totp_button").click(function(){return s()});$("#totp_start").submit(function(){return z()});$("#add_totp_button").click(function(){return z()});$("#totp_remove").submit(function(){return b()});$("#remove_totp_button").click(function(){return b()});$("#alternate_verification_prompt").click(function(){return D()});return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:F.mainStylesheetPath}).appendTo("head")})}).call(this);