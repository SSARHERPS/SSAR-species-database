(function(){var t,l,k,d,G,z,b,r,i,C,m,o,q,F,u,p,y,h,x,c,a,A,n,s,f,D,g,j,B,E,v=[].slice;A=typeof exports!=="undefined"&&exports!==null?exports:this;o=function(H){return H===true||H===false};q=function(H){return !H||H.length===0};m=function(H){return !H||/^\s*$/.test(H)};u=function(I){try{if(q(I)||m(I)||(I==null)){if(!(I===false||I===0)){return true}}}catch(H){}return false};F=function(I){if(typeof I==="object"){return true}try{JSON.parse(I);return true}catch(H){}return false};p=function(H){return !isNaN(parseFloat(H))&&isFinite(H)};g=function(H){if(!p(H)||u(H)){return 0}return parseFloat(H)};j=function(H){if(!p(H)||u(H)){return 0}return parseInt(H)};function w(H){var J={};for(var I=0;I<H.length;++I){if(H[I]!==undefined){J[I]=H[I]}}return J}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(J){var I,H;H=0;for(I in J){if(J.hasOwnProperty(I)){H++}}return H};G=function(H,I){return setTimeout(I,H)};n=function(I,J){var H;if(J==null){J=0}H=Math.pow(10,J);return Math.round(I*H)/H};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};l=(function(H){return function(I){return encodeURI(I).split(/%..|./).length-1}})(this);function e(K){for(var I,H,J=K.length;J;I=Math.floor(Math.random()*J),H=K[--J],K[J]=K[I],K[I]=H){}return K}window.debounce_timer=null;({debounce:function(J,H,I){if(H==null){H=300}if(I==null){I=false}return function(){var L,K,M;L=1<=arguments.length?v.call(arguments,0):[];M=this;K=function(){if(!I){return J.apply(M,L)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(I){J.apply(M,L)}}return window.debounce_timer=setTimeout(K,H)}}});Function.prototype.debounce=function(){var K,J,N,I,L,H,M;H=arguments[0],I=arguments[1],M=arguments[2],K=4<=arguments.length?v.call(arguments,3):[];if(H==null){H=300}if(I==null){I=false}if(M==null){M=window.debounce_timer}L=this;J=function(){if(!I){L.apply(L,K)}return console.log("Debounce applied")};if(M!=null){try{clearTimeout(M)}catch(O){N=O}}else{if(I){L.apply(obj,K);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(J,H)};h=function(){return $(".newwindow").each(function(){var H,I;H=$(this).attr("href");I=function(J){if(J==null){return false}window.open(J);return false};$(this).click(function(){return I(H)});return $(this).keypress(function(){return I(H)})})};t=function(O,M){var J,N,K,H,I,L;if(O==null){O=50}if(M==null){M="#status-container"}try{if($(M).exists()){I=n(O*0.5);J=$(M).find(".ball");L=$(M).find(".ball1");J.removeClass("stop hide");J.css({width:""+O+"px",height:""+O+"px"});K=n(O/2+I/2+9);H=n((O+10)/2-(I+6)/2);L.removeClass("stop hide");L.css({width:""+I+"px",height:""+I+"px",top:"-"+K+"px","margin-left":""+H+"px"});return true}return false}catch(P){N=P;return console.log("Could not animate loader",N.message)}};f=function(I){var H,K,J;if(I==null){I="#status-container"}try{if($(I).exists()){H=$(I).find(".ball");J=$(I).find(".ball1");H.addClass("bballgood ballgood");J.addClass("bballgood ball1good");return G(250,function(){H.addClass("stop hide");H.removeClass("bballgood ballgood");J.addClass("stop hide");return J.removeClass("bballgood ballgood")})}}catch(L){K=L;return console.log("Could not stop load animation",K.message)}};D=function(I){var H,K,J;if(I==null){I="#status-container"}try{if($(I).exists()){H=$(I).find(".ball");J=$(I).find(".ball1");H.addClass("bballerror ballerror");J.addClass("bballerror ball1error");return G(1500,function(){H.addClass("stop hide");H.removeClass("bballerror ballerror");J.addClass("stop hide");return J.removeClass("bballerror ballerror")})}}catch(L){K=L;return console.log("Could not stop load error animation",K.message)}};$(function(){var H;try{window.picturefill()}catch(I){H=I;console.log("Could not execute picturefill.")}return h()});if(typeof c!=="object"){c=new Object()}c.goodbg="#cae682";c.badbg="#e5786d";if(c.minLength==null){c.minLength=8}if(c.overrideLength==null){c.overrideLength=21}E=new Object();E.mainStylesheetPath="css/otp_styles.css";E.popStylesheetPath="css/otp_panels.css";E.popClass="pop-panel";E.home="http://velociraptorsystems.com/samples/userhandler/test_page.php";d=function(){var H;H=$("#password").val();if(H.length>c.overrideLength||H.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",c.goodbg);c.basepwgood=true}else{$("#password").css("background",c.badbg);c.basepwgood=false}i();if(!u($("#password2").val())){k();B()}return false};k=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",c.goodbg);c.passmatch=true}else{$("#password2").css("background",c.badbg);c.passmatch=false}B();return false};B=function(){var I,H;try{I=!(c.passmatch&&c.basepwgood);return $("#createUser_submit").attr("disabled",I)}catch(J){H=J;c.passmatch=false;return c.basepwgood=false}};i=function(){var H,I,J;if(!$("#strength-meter").exists()){H="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(H)}I=$("#password").val();J=zxcvbn(I);$(".strength-eval").css("background",c.badbg);if(I.length>20){$(".strength-eval").css("background",c.goodbg)}else{if(I.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",c.goodbg)}if(I.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",c.goodbg)}if(I.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",c.goodbg)}}return $("#password-strength").attr("value",J.score+1)};z=function(){};r=function(O){var Q,N,I,L,P,M,H,J,K;if(O==null){O=E.home}x();t();I=$("#totp_code").val();K=$("#username").val();P=$("#password").val();L=$("#remote").val();H=$.url();Q="async_login_handler.php";J=H.attr("protocol")+"://"+H.attr("host")+"/"+H.attr("directory")+"/../"+Q;N="action=verifytotp&code="+I+"&user="+K+"&password="+P+"&remote="+L;M=$.post(J,N,"json");console.log("Checking",J+"?"+N);M.done(function(R){var T,S;if(R.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");S=0;return $.each(R.cookies.raw_cookie,function(V,Y){var W;try{$.cookie(V,Y,R.cookies.expires)}catch(X){W=X;console.error("Couldn't set cookies",R.cookies.raw_cookie)}S++;if(S===Object.size(R.cookies.raw_cookie)){if(O==null){O=H.attr("protocol")+"://"+H.attr("host")+"/"}f();console.log(R.cookies);return G(500,function(){return window.location.href=O})}})}catch(U){T=U;return console.error("Unexpected error while validating",T.message)}}else{$("#totp_message").text(R.human_error);$("#totp_code").val("");$("#totp_code").focus();D();return console.error("Invalid code error",R.error,R)}});return M.fail(function(R,S){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",J+"?"+N,R,S);return D()})};b=function(){return x()};y=function(){var P,M,K,N,O,L,H,I,J;x();t();J=$("#username").val();O=$("#password").val();K=$("#hash").val();N=$("#secret").val();H=$.url();P="async_login_handler.php";I=H.attr("protocol")+"://"+H.attr("host")+"/"+H.attr("directory")+"/../"+P;M="action=maketotp&password="+O+"&user="+J;L=$.post(I,M,"json");L.done(function(Q){var U,T,S,V,W,R;if(Q.status===true){R=Q.svg;S=Q.raw;W="show_secret";V="showAltBarcode";U="secretBarcode";T="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+W+"'>click here to manually input your key.</a></p> <div id='"+U+"'> "+Q.svg+" <p>Don't see the barcode? <a href='#' id='"+V+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+J+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(T);$("#"+W).click(function(){return a(Q.human_secret)});$("#"+V).click(function(){var X;X="<img src='"+Q.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(X)});$("#verify_totp_button").click(function(){x();return s(N,K)});$("#totp_verify").submit(function(){x();return s(N,K)});return f()}else{console.error("Couldn't generate TOTP code",I+"?"+M);$("#totp_message").text("There was an error generating your code. Please try again.");return D()}});L.fail(function(Q,R){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",I+"?"+M,Q,R);return D()});return false};s=function(O,L){var P,N,I,M,H,J,K;x();I=$("#code").val();K=$("#username").val();H=$.url();P="async_login_handler.php";J=H.attr("protocol")+"://"+H.attr("host")+"/"+H.attr("directory")+"/../"+P;N="action=savetotp&secret="+O+"&user="+K+"&hash="+L+"&code="+I;console.log("Checking",J+"?"+N);M=$.post(J,N,"json");M.done(function(Q){var R;if(Q.status===true){R="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+Q.backup+"</pre>";$("#totp_add").html(R);console.log("Success!");return f()}else{R="<p class='error' id='temp_error'>"+Q.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(R)}else{$("#temp_error").html(R)}console.error(Q.error);return D()}});return M.fail(function(Q,R){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",Q,R);return D()})};a=function(H){var I;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:E.popStylesheetPath}).appendTo("head");I="<div id='secret_id_panel' class='"+E.popClass+"'><p class='close-popup'>X</p><h2>"+H+"</h2></div>";$("#totp_add").after(I);return $(".close-popup").click(function(){return $("#secret_id_panel").remove()})};C=function(){var T,R,O,N,L,S,J,P,I,Q,H,K,M;H=$.url();T="async_login_handler.php";K=H.attr("protocol")+"://"+H.attr("host")+"/"+H.attr("directory")+"/../"+T;M=$("#username").val();R="action=cansms&user="+M;P="remove_totp_link";Q="send_totp_sms";L="alt_auth_pane";S="alt_auth_messages";N=new Object();N.remove="<a href='#' id='"+P+"'>Remove two-factor authentication</a>";I=$.get(K,R,"json");I.done(function(U){if(U[0]===true){return N.sms="<a href='#' id='"+Q+"'>Send SMS</a>"}});I.fail(function(U,V){return console.error("Could not check SMS-ability",U,V)});J="";$.each(N,function(V,U){return J+=U});O="<div id='"+L+"'><p>"+J+"</p><p id='"+S+"'></p></div>";$("#"+P).click(function(){if(E.home==null){E.home=H.attr("protocol")+"://"+H.attr("host")+"/login.php"}return window.location.href=E.home+"?2fa=t"});return $("#"+Q).click(function(){var U;R="action=sendtotptext&user="+M;U=$.get(K,R,"json");U.done(function(V){if(V.status===true){$("#"+L).remove();return $("#totp_message").text(V.message)}else{$("#"+S).addClass("error").text(V.human_error);return console.error(V.error)}});return U.fail(function(V,W){console.error("AJAX failure trying to send TOTP text",K+"?"+R);return console.error("Returns:",V,W)})})};x=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password").keyup(function(){return d()}).change(function(){return d()});$("#password2").change(function(){return k()}).keyup(function(){return k()});$("#totp_submit").submit(function(){return r()});$("#verify_totp_button").click(function(){return r()});$("#totp_start").submit(function(){return y()});$("#add_totp_button").click(function(){return y()});$("#totp_remove").submit(function(){return b()});$("#remove_totp_button").click(function(){return b()});$("#alternate_verification_prompt").click(function(){return C()});return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:E.mainStylesheetPath}).appendTo("head")})}).call(this);