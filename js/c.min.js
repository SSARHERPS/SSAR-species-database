(function(){var v,m,l,d,I,B,b,t,j,E,o,q,s,H,w,r,A,i,z,c,a,C,p,u,g,F,h,k,D,G,e,n,x=[].slice;C=typeof exports!=="undefined"&&exports!==null?exports:this;q=function(J){return J===true||J===false};s=function(J){return !J||J.length===0};o=function(J){return !J||/^\s*$/.test(J)};w=function(K){try{if(s(K)||o(K)||(K==null)){if(!(K===false||K===0)){return true}}}catch(J){}return false};H=function(K){if(typeof K==="object"){return true}try{JSON.parse(K);return true}catch(J){}return false};r=function(J){return !isNaN(parseFloat(J))&&isFinite(J)};h=function(J){if(!r(J)||w(J)){return 0}return parseFloat(J)};k=function(J){if(!r(J)||w(J)){return 0}return parseInt(J)};function y(J){var L={};for(var K=0;K<J.length;++K){if(J[K]!==undefined){L[K]=J[K]}}return L}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(L){var K,J;J=0;for(K in L){if(L.hasOwnProperty(K)){J++}}return J};I=function(J,K){return setTimeout(K,J)};p=function(K,L){var J;if(L==null){L=0}J=Math.pow(10,L);return Math.round(K*J)/J};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};m=(function(J){return function(K){return encodeURI(K).split(/%..|./).length-1}})(this);function f(M){for(var K,J,L=M.length;L;K=Math.floor(Math.random()*L),J=M[--L],M[L]=M[K],M[K]=J){}return M}window.debounce_timer=null;({debounce:function(L,J,K){if(J==null){J=300}if(K==null){K=false}return function(){var N,M,O;N=1<=arguments.length?x.call(arguments,0):[];O=this;M=function(){if(!K){return L.apply(O,N)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(K){L.apply(O,N)}}return window.debounce_timer=setTimeout(M,J)}}});Function.prototype.debounce=function(){var M,L,P,K,N,J,O;J=arguments[0],K=arguments[1],O=arguments[2],M=4<=arguments.length?x.call(arguments,3):[];if(J==null){J=300}if(K==null){K=false}if(O==null){O=window.debounce_timer}N=this;L=function(){if(!K){N.apply(N,M)}return console.log("Debounce applied")};if(O!=null){try{clearTimeout(O)}catch(Q){P=Q}}else{if(K){N.apply(obj,M);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(L,J)};i=function(){return $(".newwindow").each(function(){var J,K;J=$(this).attr("href");K=function(L){if(L==null){return false}window.open(L);return false};$(this).click(function(){return K(J)});return $(this).keypress(function(){return K(J)})})};v=function(Q,O){var L,P,M,J,K,N;if(Q==null){Q=50}if(O==null){O="#status-container"}try{if($(O).exists()){K=p(Q*0.5);L=$(O).find(".ball");N=$(O).find(".ball1");L.removeClass("stop hide");L.css({width:""+Q+"px",height:""+Q+"px"});M=p(Q/2+K/2+9);J=p((Q+10)/2-(K+6)/2);N.removeClass("stop hide");N.css({width:""+K+"px",height:""+K+"px",top:"-"+M+"px","margin-left":""+J+"px"});return true}return false}catch(R){P=R;return console.log("Could not animate loader",P.message)}};g=function(K){var J,M,L;if(K==null){K="#status-container"}try{if($(K).exists()){J=$(K).find(".ball");L=$(K).find(".ball1");J.addClass("bballgood ballgood");L.addClass("bballgood ball1good");return I(250,function(){J.addClass("stop hide");J.removeClass("bballgood ballgood");L.addClass("stop hide");return L.removeClass("bballgood ballgood")})}}catch(N){M=N;return console.log("Could not stop load animation",M.message)}};F=function(K){var J,M,L;if(K==null){K="#status-container"}try{if($(K).exists()){J=$(K).find(".ball");L=$(K).find(".ball1");J.addClass("bballerror ballerror");L.addClass("bballerror ball1error");return I(1500,function(){J.addClass("stop hide");J.removeClass("bballerror ballerror");L.addClass("stop hide");return L.removeClass("bballerror ballerror")})}}catch(N){M=N;return console.log("Could not stop load error animation",M.message)}};$(function(){var J;try{window.picturefill()}catch(K){J=K;console.log("Could not execute picturefill.")}return i()});if(typeof c!=="object"){c=new Object()}c.goodbg="#cae682";c.badbg="#e5786d";if(c.minLength==null){c.minLength=8}if(c.overrideLength==null){c.overrideLength=21}if(typeof G!=="object"){G=new Object()}G.mainStylesheetPath="css/otp_styles.css";G.popStylesheetPath="css/otp_panels.css";G.popClass="pop-panel";if(G.home==null){e=$.url();G.home=e.attr("protocol")+"://"+e.attr("host")+"/"}d=function(){var J;J=$("#password").val();if(J.length>c.overrideLength||J.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",c.goodbg);c.basepwgood=true}else{$("#password").css("background",c.badbg);c.basepwgood=false}j();if(!w($("#password2").val())){l();D()}return false};l=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",c.goodbg);c.passmatch=true}else{$("#password2").css("background",c.badbg);c.passmatch=false}D();return false};D=function(){var K,J;try{K=!(c.passmatch&&c.basepwgood);return $("#createUser_submit").attr("disabled",K)}catch(L){J=L;c.passmatch=false;return c.basepwgood=false}};j=function(){var J,K,L;if(!$("#strength-meter").exists()){J="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(J)}K=$("#password").val();L=zxcvbn(K);$(".strength-eval").css("background",c.badbg);if(K.length>20){$(".strength-eval").css("background",c.goodbg)}else{if(K.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",c.goodbg)}if(K.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",c.goodbg)}if(K.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",c.goodbg)}}return $("#password-strength").attr("value",L.score+1)};B=function(){};t=function(P){var R,O,J,M,Q,N,K,L;if(P==null){P=G.home}z();v();J=$("#totp_code").val();L=$("#username").val();Q=$("#password").val();M=$("#remote").val();e=$.url();R="async_login_handler.php";K=e.attr("protocol")+"://"+e.attr("host")+"/"+e.attr("directory")+"/../"+R;O="action=verifytotp&code="+J+"&user="+L+"&password="+Q+"&remote="+M;N=$.post(K,O,"json");console.log("Checking",K+"?"+O);N.done(function(S){var U,T;if(S.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");T=0;return $.each(S.cookies.raw_cookie,function(W,Z){var X;try{$.cookie(W,Z,S.cookies.expires)}catch(Y){X=Y;console.error("Couldn't set cookies",S.cookies.raw_cookie)}T++;if(T===Object.size(S.cookies.raw_cookie)){if(P==null){P=e.attr("protocol")+"://"+e.attr("host")+"/"}g();console.log(S.cookies);return I(500,function(){return window.location.href=P})}})}catch(V){U=V;return console.error("Unexpected error while validating",U.message)}}else{$("#totp_message").text(S.human_error);$("#totp_code").val("");$("#totp_code").focus();F();return console.error("Invalid code error",S.error,S)}});return N.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",K+"?"+O,S,T);return F()})};b=function(){return z()};A=function(){var J,M,P,N,L,Q,O,K;z();v();K=$("#username").val();L=$("#password").val();P=$("#hash").val();N=$("#secret").val();e=$.url();J="async_login_handler.php";O=e.attr("protocol")+"://"+e.attr("host")+"/"+e.attr("directory")+"/../"+J;M="action=maketotp&password="+L+"&user="+K;Q=$.post(O,M,"json");Q.done(function(R){var V,U,T,W,X,S;if(R.status===true){S=R.svg;T=R.raw;X="show_secret";W="showAltBarcode";V="secretBarcode";U="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+X+"'>click here to manually input your key.</a></p> <div id='"+V+"'> "+R.svg+" <p>Don't see the barcode? <a href='#' id='"+W+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+K+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(U);$("#"+X).click(function(){return a(R.human_secret)});$("#"+W).click(function(){var Y;Y="<img src='"+R.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(Y)});$("#verify_totp_button").click(function(){z();return u(N,P)});$("#totp_verify").submit(function(){z();return u(N,P)});return g()}else{console.error("Couldn't generate TOTP code",O+"?"+M);$("#totp_message").text("There was an error generating your code. Please try again.");return F()}});Q.fail(function(R,S){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",O+"?"+M,R,S);return F()});return false};u=function(M,P){var J,L,N,Q,O,K;z();N=$("#code").val();K=$("#username").val();e=$.url();J="async_login_handler.php";O=e.attr("protocol")+"://"+e.attr("host")+"/"+e.attr("directory")+"/../"+J;L="action=savetotp&secret="+M+"&user="+K+"&hash="+P+"&code="+N;console.log("Checking",O+"?"+L);Q=$.post(O,L,"json");Q.done(function(R){var S;if(R.status===true){S="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+R.backup+"</pre>";$("#totp_add").html(S);console.log("Success!");return g()}else{S="<p class='error' id='temp_error'>"+R.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(S)}else{$("#temp_error").html(S)}console.error(R.error);return F()}});return Q.fail(function(R,S){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",R,S);return F()})};a=function(J){var K;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:G.popStylesheetPath}).appendTo("head");K="<div id='secret_id_panel' class='"+G.popClass+"'><p class='close-popup'>X</p><h2>"+J+"</h2></div>";$("#totp_add").after(K);return $(".close-popup").click(function(){return $("#secret_id_panel").remove()})};E=function(){var U,S,P,O,M,T,K,Q,J,R,L,N;e=$.url();U="async_login_handler.php";L=e.attr("protocol")+"://"+e.attr("host")+"/"+e.attr("directory")+"/../"+U;N=$("#username").val();S="action=cansms&user="+N;Q="remove_totp_link";R="send_totp_sms";M="alt_auth_pane";T="alt_auth_messages";O=new Object();O.remove="<a href='#' id='"+Q+"'>Remove two-factor authentication</a>";J=$.get(L,S,"json");J.done(function(V){if(V[0]===true){return O.sms="<a href='#' id='"+R+"'>Send SMS</a>"}});J.fail(function(V,W){return console.error("Could not check SMS-ability",V,W)});K="";$.each(O,function(W,V){return K+=V});P="<div id='"+M+"'><p>"+K+"</p><p id='"+T+"'></p></div>";$("#"+Q).click(function(){if(G.home==null){G.home=e.attr("protocol")+"://"+e.attr("host")+"/login.php"}return window.location.href=G.home+"?2fa=t"});return $("#"+R).click(function(){var V;S="action=sendtotptext&user="+N;V=$.get(L,S,"json");V.done(function(W){if(W.status===true){$("#"+M).remove();return $("#totp_message").text(W.message)}else{$("#"+T).addClass("error").text(W.human_error);return console.error(W.error)}});return V.fail(function(W,X){console.error("AJAX failure trying to send TOTP text",L+"?"+S);return console.error("Returns:",W,X)})})};n=function(){return z()};z=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password").keyup(function(){return d()}).change(function(){return d()});$("#password2").change(function(){return l()}).keyup(function(){return l()});$("#totp_submit").submit(function(){return t()});$("#verify_totp_button").click(function(){return t()});$("#totp_start").submit(function(){return A()});$("#add_totp_button").click(function(){return A()});$("#totp_remove").submit(function(){return b()});$("#remove_totp_button").click(function(){return b()});$("#alternate_verification_prompt").click(function(){return E()});$("#verify_phone").click(function(){return n()});$("#verify_phone_button").click(function(){return n()});$("#verify_later").click(function(){return window.location.href=G.home});return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:G.mainStylesheetPath}).appendTo("head")})}).call(this);