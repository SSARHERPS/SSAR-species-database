var activityIndicatorOff,activityIndicatorOn,animateLoad,byteCount,delay,formatScientificNames,formatSearchResults,goTo,isBlank,isBool,isEmpty,isJson,isNull,isNumber,lightboxImages,mapNewWindows,openLink,openTab,overlayOff,overlayOn,performSearch,randomInt,root,roundNumber,searchParams,sortResults,stopLoad,stopLoadError,toFloat,toInt,toastStatusMessage,uri,__slice=[].slice;root=typeof exports!=="undefined"&&exports!==null?exports:this;uri=new Object();uri.o=$.url();uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+"/";isBool=function(a){return a===true||a===false};isEmpty=function(a){return !a||a.length===0};isBlank=function(a){return !a||/^\s*$/.test(a)};isNull=function(b){try{if(isEmpty(b)||isBlank(b)||(b==null)){if(!(b===false||b===0)){return true}}}catch(a){}return false};isJson=function(b){if(typeof b==="object"){return true}try{JSON.parse(b);return true}catch(a){}return false};isNumber=function(a){return !isNaN(parseFloat(a))&&isFinite(a)};toFloat=function(a){if(!isNumber(a)||isNull(a)){return 0}return parseFloat(a)};toInt=function(a){if(!isNumber(a)||isNull(a)){return 0}return parseInt(a)};function toObject(a){var c={};for(var b=0;b<a.length;++b){if(a[b]!==undefined){c[b]=a[b]}}return c}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Number.prototype.toBool=function(){return this===1};Object.size=function(c){var b,a;a=0;for(b in c){if(c.hasOwnProperty(b)){a++}}return a};delay=function(a,b){return setTimeout(b,a)};roundNumber=function(b,c){var a;if(c==null){c=0}a=Math.pow(10,c);return Math.round(b*a)/a};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.polymerSelected=function(a){var b,d;if(a==null){a=void 0}if(a!=null){try{return jQuery(this).prop("selected",a)}catch(c){b=c;return false}}else{try{d=jQuery(this)[0].selected}catch(c){b=c;return false}if(d==="null"||(d==null)){d=void 0}return d}};jQuery.fn.polymerChecked=function(a){var b;if(a==null){a=void 0}if(a!=null){return jQuery(this).prop("checked",a)}else{b=jQuery(this)[0].checked;if(b==="null"||(b==null)){b=void 0}return b}};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};byteCount=(function(a){return function(b){return encodeURI(b).split(/%..|./).length-1}})(this);function shuffle(d){for(var b,a,c=d.length;c;b=Math.floor(Math.random()*c),a=d[--c],d[c]=d[b],d[b]=a){}return d}randomInt=function(b,c){var e,d,a;if(b==null){b=0}if(c==null){c=1}e=Math.random();if(b==null){d=[0,b],b=d[0],c=d[1]}if(b>c){a=[c,b],b=a[0],c=a[1]}return Math.floor(e*(c-b+1)+b)};window.debounce_timer=null;({debounce:function(c,a,b){if(a==null){a=300}if(b==null){b=false}return function(){var e,d,f;e=1<=arguments.length?__slice.call(arguments,0):[];f=this;d=function(){if(!b){return c.apply(f,e)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(b){c.apply(f,e)}}return window.debounce_timer=setTimeout(d,a)}}});Function.prototype.debounce=function(){var d,c,h,b,f,a,g;a=arguments[0],b=arguments[1],g=arguments[2],d=4<=arguments.length?__slice.call(arguments,3):[];if(a==null){a=300}if(b==null){b=false}if(g==null){g=window.debounce_timer}f=this;c=function(){if(!b){f.apply(f,d)}return console.log("Debounce applied")};if(g!=null){try{clearTimeout(g)}catch(i){h=i}}else{if(b){f.apply(obj,d);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(c,a)};mapNewWindows=function(){return $(".newwindow").each(function(){var a,b;a=$(this).attr("href");b=function(c){if(c==null){return false}window.open(c);return false};$(this).click(function(){return b(a)});return $(this).keypress(function(){return b(a)})})};toastStatusMessage=function(d,c,e,a){var b;if(c==null){c="error"}if(e==null){e=3000}if(a==null){a="#status-message"}if(!isNumber(e)){e=3000}if(a.slice(0,1)===!"#"){a="#"+a}if(!$(a).exists()){b='<paper-toast id="'+(a.slice(1))+'" duration="'+e+'"></paper-toast>';$(b).appendTo("body")}$(a).attr("text",d);$(a).addClass(c);$(a)[0].show();return delay(e+500,function(){$(a).empty();$(a).removeClass(c);return $(a).attr("text","")})};openLink=function(a){if(a==null){return false}window.open(a);return false};openTab=function(a){return openLink(a)};goTo=function(a){if(a==null){return false}window.location.href=a;return false};animateLoad=function(g,b){var c,a;if(g==null){g=50}if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if(!$(a).exists()){$("body").append('<paper-spinner id="'+b+'" active></paper-spinner')}else{$(a).attr("active",true)}return false}catch(f){c=f;return console.log("Could not animate loader",c.message)}};stopLoad=function(b){var c,a;if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if($(a).exists()){$(a).addClass("good");return delay(1000,function(){$(a).removeClass("good");return $(a).attr("active",false)})}}catch(d){c=d;return console.log("Could not stop load animation",c.message)}};stopLoadError=function(b){var c,a;if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if($(a).exists()){$(a).addClass("bad");return delay(3000,function(){$(a).removeClass("bad");return $(a).attr("active",false)})}}catch(d){c=d;return console.log("Could not stop load error animation",c.message)}};lightboxImages=function(a){var b;if(a==null){a=".lightboximage"}b={onStart:function(){return overlayOn()},onEnd:function(){overlayOff();return activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif"};return $(a).imageLightbox(b)};activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")};activityIndicatorOff=function(){return $("#imagelightbox-loading").remove()};overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")};overlayOff=function(){return $("#imagelightbox-overlay").remove()};formatScientificNames=function(a){if(a==null){a=".sciname"}return $(".sciname").each(function(){var b;b=$(this).css("font-style")==="italic"?"normal":"italic";return $(this).css("font-style",b)})};searchParams=new Object();searchParams.workingDir="cndb";searchParams.targetApi="commonnames_api.php";searchParams.targetContainer="#result_container";uri.urlString=uri.urlString+searchParams.workingDir+"/";searchParams.apiPath=uri.urlString+searchParams.targetApi;performSearch=function(){var a,b;b=$("#search").val();if(isNull(b)){$("#search-status").attr("text","Please enter a search term.");$("#search-status")[0].show();return false}animateLoad();if($("#strict-search").polymerSelected()!==true){b=b.toLowerCase();b=""+b+"&loose=true"}a="q="+b;console.log("Got search value "+b+", hitting",""+searchParams.apiPath+"?"+a);return $.get(searchParams.targetApi,a,"json").done(function(c){console.log("Search executed by "+c.method+" with "+c.count+" results.");if(toInt(c.count)===0){$("#search-status").attr("text",'"'+b+'" returned no results.');$("#search-status")[0].show();stopLoadError();return false}if(c.status===true){formatSearchResults(c);return false}$("#search-status").attr("text",c.human_error);$("#search-status")[0].show();console.error(c.error);console.warn(c);return stopLoadError()}).fail(function(c,d){console.error("There was an error performing the search");console.warn(c,d,c.statusText);d=""+c.status+" - "+c.statusText;$("#search-status").attr("text","Couldn't execute the search - "+d);$("#search-status")[0].show();return stopLoadError()}).always(function(){return false})};formatSearchResults=function(a,b){var g,h,d,c,f,e;if(b==null){b=searchParams.targetContainer}g=a.result;searchParams.result=g;h=new Array();d="";f="<table id='cndb-result-list'>\n\t<tr class='cndb-row-headers'>";c="</table>";e=toInt(a.count)-1;return $.each(g,function(n,p){var o,m,k;if(toInt(n)===0){m=0;f+="\n<!-- Table Headers -->";$.each(p,function(j,i){var q,l;l=j.replace(/_/g," ");if(l!=="id"&&l!=="image"){if($("#show-deprecated").polymerSelected()!==true){q="deprecated_scientific"}else{q=""}if(j!==q){f+="\n\t\t<th class='text-center'>"+l+"</th>"}}m++;if(m===Object.size(p)){f+="\n\t</tr>";return f+="\n<!-- End Table Headers -->"}})}o="\n\t<tr id='cndb-row"+n+"' class='cndb-result-entry'>";k=0;$.each(p,function(i,j){var s,u,r,q,l;if(i!=="id"&&i!=="image"){if(i==="authority_year"){try{u=JSON.parse(j);q=Object.keys(u)[0];l=u[q];j="G: "+q+"<br/>S: "+l}catch(t){r=t;u=j}}if($("#show-deprecated").polymerSelected()!==true){s="deprecated_scientific"}else{s=""}if(i!==s){if(i==="image"){if(isNull(j)){j="<a href='http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+p.genus+"+"+p.species+"' class='newwindow'>IMG</a>"}else{j="<a href='"+j+"' class='lightboximage'>LOCAL IMG</a>"}}o+="\n\t\t<td id='"+i+"-"+n+"' class='"+i+"'>"+j+"</td>"}}k++;if(k===Object.size(p)){o+="\n\t</tr>";return d+=o}});if(toInt(n)===e){d=f+d+c;console.log("Processed "+(toInt(n)+1)+" rows");$(b).html(d);mapNewWindows();lightboxImages();return stopLoad()}})};sortResults=function(b){var a;return a=searchParams.result};$(function(){console.log("Doing onloads ...");animateLoad();$("#search_form").submit(function(a){a.preventDefault();return performSearch()});$("#search_form").keypress(function(a){if(a.which===13){return performSearch()}});$("#do-search").click(function(){return performSearch()});return $.post(searchParams.targetApi,"","json").done(function(a){if(a.status===true){console.log("Got a valid result, formatting "+a.count+" results.");formatSearchResults(a);return false}$("#search-status").attr("text",a.human_error);$("#search-status")[0].show();console.error(a.error);console.warn(a);return stopLoadError()}).fail(function(a,b){console.error("There was an error loading the generic table");console.warn(a,b,a.statusText);b=""+a.status+" - "+a.statusText;$("#search-status").attr("text","Couldn't load table - "+b);$("#search-status")[0].show();return stopLoadError()}).always(function(){$("#search").attr("disabled",false);return false})});