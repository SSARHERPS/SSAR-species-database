(function(){var p,f,F,C,y,H,g,e,A,x,w,u,k,l,B,I,m,r,D,G,q,n,a,t,E,o,c,b,h,j,i,d,J,s=[].slice;n=typeof exports!=="undefined"&&exports!==null?exports:this;u=function(K){return K===true||K===false};k=function(K){return !K||K.length===0};w=function(K){return !K||/^\s*$/.test(K)};B=function(L){try{if(k(L)||w(L)||(L==null)){if(!(L===false||L===0)){return true}}}catch(K){}return false};l=function(L){if(typeof L==="object"){return true}try{JSON.parse(L);return true}catch(K){}return false};I=function(K){return !isNaN(parseFloat(K))&&isFinite(K)};b=function(K){if(!I(K)||B(K)){return 0}return parseFloat(K)};h=function(K){if(!I(K)||B(K)){return 0}return parseInt(K)};function v(K){var M={};for(var L=0;L<K.length;++L){if(K[L]!==undefined){M[L]=K[L]}}return M}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(M){var L,K;K=0;for(L in M){if(M.hasOwnProperty(L)){K++}}return K};y=function(K,L){return setTimeout(L,K)};a=function(L,M){var K;if(M==null){M=0}K=Math.pow(10,M);return Math.round(L*K)/K};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};f=(function(K){return function(L){return encodeURI(L).split(/%..|./).length-1}})(this);function z(N){for(var L,K,M=N.length;M;L=Math.floor(Math.random()*M),K=N[--M],N[M]=N[L],N[L]=K){}return N}window.debounce_timer=null;({debounce:function(M,K,L){if(K==null){K=300}if(L==null){L=false}return function(){var O,N,P;O=1<=arguments.length?s.call(arguments,0):[];P=this;N=function(){if(!L){return M.apply(P,O)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(L){M.apply(P,O)}}return window.debounce_timer=setTimeout(N,K)}}});Function.prototype.debounce=function(){var N,M,Q,L,O,K,P;K=arguments[0],L=arguments[1],P=arguments[2],N=4<=arguments.length?s.call(arguments,3):[];if(K==null){K=300}if(L==null){L=false}if(P==null){P=window.debounce_timer}O=this;M=function(){if(!L){O.apply(O,N)}return console.log("Debounce applied")};if(P!=null){try{clearTimeout(P)}catch(R){Q=R}}else{if(L){O.apply(obj,N);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(M,K)};r=function(){return $(".newwindow").each(function(){var K,L;K=$(this).attr("href");L=function(M){if(M==null){return false}window.open(M);return false};$(this).click(function(){return L(K)});return $(this).keypress(function(){return L(K)})})};p=function(R,P){var M,Q,N,K,L,O;if(R==null){R=50}if(P==null){P="#status-container"}try{if($(P).exists()){L=a(R*0.5);M=$(P).find(".ball");O=$(P).find(".ball1");M.removeClass("stop hide");M.css({width:""+R+"px",height:""+R+"px"});N=a(R/2+L/2+9);K=a((R+10)/2-(L+6)/2);O.removeClass("stop hide");O.css({width:""+L+"px",height:""+L+"px",top:"-"+N+"px","margin-left":""+K+"px"});return true}return false}catch(S){Q=S;return console.log("Could not animate loader",Q.message)}};o=function(L){var K,N,M;if(L==null){L="#status-container"}try{if($(L).exists()){K=$(L).find(".ball");M=$(L).find(".ball1");K.addClass("bballgood ballgood");M.addClass("bballgood ball1good");return y(250,function(){K.addClass("stop hide");K.removeClass("bballgood ballgood");M.addClass("stop hide");return M.removeClass("bballgood ballgood")})}}catch(O){N=O;return console.log("Could not stop load animation",N.message)}};c=function(L){var K,N,M;if(L==null){L="#status-container"}try{if($(L).exists()){K=$(L).find(".ball");M=$(L).find(".ball1");K.addClass("bballerror ballerror");M.addClass("bballerror ball1error");return y(1500,function(){K.addClass("stop hide");K.removeClass("bballerror ballerror");M.addClass("stop hide");return M.removeClass("bballerror ballerror")})}}catch(O){N=O;return console.log("Could not stop load error animation",N.message)}};$(function(){var K;try{window.picturefill()}catch(L){K=L;console.log("Could not execute picturefill.")}return r()});if(typeof G!=="object"){G=new Object()}G.goodbg="#cae682";G.badbg="#e5786d";if(G.minLength==null){G.minLength=8}if(G.overrideLength==null){G.overrideLength=21}if(typeof i!=="object"){i=new Object()}i.mainStylesheetPath="css/otp_styles.css";i.popStylesheetPath="css/otp_panels.css";i.popClass="pop-panel";if(i.home==null){d=$.url();i.home=d.attr("protocol")+"://"+d.attr("host")+"/"}C=function(){var K;K=$("#password").val();if(K.length>G.overrideLength||K.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",G.goodbg);G.basepwgood=true}else{$("#password").css("background",G.badbg);G.basepwgood=false}A();if(!B($("#password2").val())){F();j()}return false};F=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",G.goodbg);G.passmatch=true}else{$("#password2").css("background",G.badbg);G.passmatch=false}j();return false};j=function(){var L,K;try{L=!(G.passmatch&&G.basepwgood);return $("#createUser_submit").attr("disabled",L)}catch(M){K=M;G.passmatch=false;return G.basepwgood=false}};A=function(){var K,L,M;if(!$("#strength-meter").exists()){K="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(K)}L=$("#password").val();M=zxcvbn(L);$(".strength-eval").css("background",G.badbg);if(L.length>20){$(".strength-eval").css("background",G.goodbg)}else{if(L.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",G.goodbg)}if(L.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",G.goodbg)}if(L.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",G.goodbg)}}return $("#password-strength").attr("value",M.score+1)};H=function(){};e=function(Q){var S,P,K,N,R,O,L,M;if(Q==null){Q=i.home}D();console.log("Running TOTPSubmit");p();K=$("#totp_code").val();M=$("#username").val();R=$("#password").val();N=$("#remote").val();d=$.url();S="async_login_handler.php";L=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+S;P="action=verifytotp&code="+K+"&user="+M+"&password="+R+"&remote="+N;O=$.post(L,P,"json");console.log("Checking",L+"?"+P);O.done(function(T){var V,U;if(T.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");U=0;return $.each(T.cookies.raw_cookie,function(X,aa){var Y;try{$.cookie(X,aa,T.cookies.expires)}catch(Z){Y=Z;console.error("Couldn't set cookies",T.cookies.raw_cookie)}U++;if(U===Object.size(T.cookies.raw_cookie)){if(Q==null){Q=d.attr("protocol")+"://"+d.attr("host")+"/"}o();console.log(T.cookies);return y(500,function(){return window.location.href=Q})}})}catch(W){V=W;return console.error("Unexpected error while validating",V.message)}}else{$("#totp_message").text(T.human_error);$("#totp_code").val("");$("#totp_code").focus();c();return console.error("Invalid code error",T.error,T)}});return O.fail(function(T,U){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",L+"?"+P,T,U);return c()})};g=function(){return D()};m=function(){var K,N,Q,O,M,R,P,L;D();p();L=$("#username").val();M=$("#password").val();Q=$("#hash").val();O=$("#secret").val();d=$.url();K="async_login_handler.php";P=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;N="action=maketotp&password="+M+"&user="+L;R=$.post(P,N,"json");R.done(function(S){var W,V,U,X,Y,T;if(S.status===true){T=S.svg;U=S.raw;Y="show_secret";X="showAltBarcode";W="secretBarcode";V="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+Y+"'>click here to manually input your key.</a></p> <div id='"+W+"'> "+S.svg+" <p>Don't see the barcode? <a href='#' id='"+X+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+L+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(V);$("#"+Y).click(function(){return q(S.human_secret)});$("#"+X).click(function(){var Z;Z="<img src='"+S.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(Z)});$("#verify_totp_button").click(function(){D();return t(O,Q)});$("#totp_verify").submit(function(){D();return t(O,Q)});return o()}else{console.error("Couldn't generate TOTP code",P+"?"+N);$("#totp_message").text("There was an error generating your code. Please try again.");return c()}});R.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",P+"?"+N,S,T);return c()});return false};t=function(N,Q){var K,M,O,R,P,L;D();O=$("#code").val();L=$("#username").val();d=$.url();K="async_login_handler.php";P=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;M="action=savetotp&secret="+N+"&user="+L+"&hash="+Q+"&code="+O;console.log("Checking",P+"?"+M);R=$.post(P,M,"json");R.done(function(S){var T;if(S.status===true){T="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+S.backup+"</pre>";$("#totp_add").html(T);console.log("Success!");return o()}else{T="<p class='error' id='temp_error'>"+S.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(T)}else{$("#temp_error").html(T)}console.error(S.error);return c()}});return R.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",S,T);return c()})};q=function(K){var L;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:i.popStylesheetPath}).appendTo("head");L="<div id='cover_wrapper'><div id='secret_id_panel' class='"+i.popClass+" cover_content'><p class='close-popup'>X</p><h2>"+K+"</h2></div></div>";$("article").after(L);$("article").addClass("blur");return $(".close-popup").click(function(){$("#secret_id_panel").remove();return $("article").removeClass("blur")})};x=function(){var V,T,Q,P,N,U,L,R,K,S,M,O;console.log("Running alt options");d=$.url();V="async_login_handler.php";M=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+V;O=$("#username").val();T="action=cansms&user="+O;R="remove_totp_link";S="send_totp_sms";N="alt_auth_pane";U="alt_auth_messages";P=new Object();P.remove="<a href='#' id='"+R+"'>Remove two-factor authentication</a>";K=$.get(M,T,"json");K.done(function(W){if(W[0]===true){return P.sms="<a href='#' id='"+S+"'>Send SMS</a>"}else{return console.warn("Couldn't get a valid result",W,M+"?"+T)}});K.fail(function(W,X){return console.error("Could not check SMS-ability",W,X)});L="";$.each(P,function(X,W){return L+=W});Q="<div id='"+N+"'><p>"+L+"</p><p id='"+U+"'></p></div>";$("#totp_submit").after(Q);$("#"+R).click(function(){if(i.home==null){i.home=d.attr("protocol")+"://"+d.attr("host")+"/login.php"}return window.location.href=i.home+"?2fa=t"});return $("#"+S).click(function(){var W;T="action=sendtotptext&user="+O;W=$.get(M,T,"json");W.done(function(X){if(X.status===true){$("#"+N).remove();return $("#totp_message").text(X.message)}else{$("#"+U).addClass("error").text(X.human_error);return console.error(X.error)}});return W.fail(function(X,Y){console.error("AJAX failure trying to send TOTP text",M+"?"+T);return console.error("Returns:",X,Y)})})};J=function(){var K,M,N,O,L;D();d=$.url();K="async_login_handler.php";O=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;N=$("#phone_auth").val()!=null?$("#phone_auth").val():null;L=$("#username").val();M="action=verifyphone&username="+L+"&auth="+N;J=$.get(O,M,"json");J.done(function(P){var Q,R;if(P.status===false){if(!$("#phone_verify_message").exists()){$("#phone").before("<p id='phone_verify_message'></p>")}if(P.is_good===true){$("#verify_phone_button").remove();Q="<p>You've already verified your phone number, thanks!</p>";R="good"}else{Q=P.human_error;R="error"}$("#phone_verify_message").text(Q).addClass(R);if(P.fatal===true){$("#verify_phone_button").attr("disabled",true);$("#verify_phone").unbind("submit").attr("onsubmit","")}return false}if(P.status===true){if(!$("#phone_auth").exists()){$("#username").after("<br/><input type='text' length='8' name='phone_auth' id='phone_auth' placeholder='Authorization Code'/>")}if(!$("#phone_verify_message").exists()){$("#phone").before("<p id='phone_verify_message'></p>")}$("#phone_verify_message").text(P.message);if(P.is_good!==true){return $("#verify_phone_button").text("Confirm")}else{return $("#verify_phone_button").html("Continue &#187; ").unbind("click").click(function(){return window.location.href=i.home})}}else{console.warn("Unexpected condition encountered verifying the phone number");return false}});return J.fail(function(P,Q){console.error("AJAX failure trying to send phone verification text",O+"?"+M);return console.error("Returns:",P,Q)})};E=function(K){if(K==null){K="help/instructions_pop.html"}console.log("Showing instructions");$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:i.popStylesheetPath}).appendTo("head");return $.get(K).done(function(M){var L,N;$("article").after(M);$("article").addClass("blur");d=$.url();N=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../";L=""+N+"assets/";console.log("Looking in "+L);$(".android").html("<img src='"+L+"playstore.png' alt='Google Play Store'/>");$(".ios").html("<img src='"+L+"appstore.png' alt='iOS App Store'/>");$(".wp8").html("<img src='"+L+"wpstore.png' alt='Windows Phone Store'/>");$(".app_link_container a").addClass("newwindow");r();return $(".close-popup").click(function(){$("article").removeClass("blur");return $("#cover_wrapper").remove()})}).fail(function(L,M){return console.error("Failed to load instructions @ "+K,L,M)})};D=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password").keyup(function(){return C()}).change(function(){return C()});$("#password2").change(function(){return F()}).keyup(function(){return F()});$("#totp_submit").submit(function(){return e()});$("#verify_totp_button").click(function(){return e()});$("#totp_start").submit(function(){return m()});$("#add_totp_button").click(function(){return m()});$("#totp_remove").submit(function(){return g()});$("#remove_totp_button").click(function(){return g()});$("#alternate_verification_prompt").click(function(){return x()});$("#verify_phone").click(function(){return J()});$("#verify_phone_button").click(function(){return J()});$("#verify_later").click(function(){return window.location.href=i.home});$("#totp_help").click(function(){return E()});return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:i.mainStylesheetPath}).appendTo("head")})}).call(this);