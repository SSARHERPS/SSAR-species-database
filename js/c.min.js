(function(){var t,l,k,d,F,z,b,r,i,m,o,q,E,u,p,y,h,x,c,a,A,n,s,f,C,g,j,B,D,v=[].slice;A=typeof exports!=="undefined"&&exports!==null?exports:this;o=function(G){return G===true||G===false};q=function(G){return !G||G.length===0};m=function(G){return !G||/^\s*$/.test(G)};u=function(H){try{if(q(H)||m(H)||(H==null)){if(!(H===false||H===0)){return true}}}catch(G){}return false};E=function(H){if(typeof H==="object"){return true}try{JSON.parse(H);return true}catch(G){}return false};p=function(G){return !isNaN(parseFloat(G))&&isFinite(G)};g=function(G){if(!p(G)||u(G)){return 0}return parseFloat(G)};j=function(G){if(!p(G)||u(G)){return 0}return parseInt(G)};function w(G){var I={};for(var H=0;H<G.length;++H){if(G[H]!==undefined){I[H]=G[H]}}return I}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(I){var H,G;G=0;for(H in I){if(I.hasOwnProperty(H)){G++}}return G};F=function(G,H){return setTimeout(H,G)};n=function(H,I){var G;if(I==null){I=0}G=Math.pow(10,I);return Math.round(H*G)/G};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};l=(function(G){return function(H){return encodeURI(H).split(/%..|./).length-1}})(this);function e(J){for(var H,G,I=J.length;I;H=Math.floor(Math.random()*I),G=J[--I],J[I]=J[H],J[H]=G){}return J}window.debounce_timer=null;({debounce:function(I,G,H){if(G==null){G=300}if(H==null){H=false}return function(){var K,J,L;K=1<=arguments.length?v.call(arguments,0):[];L=this;J=function(){if(!H){return I.apply(L,K)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(H){I.apply(L,K)}}return window.debounce_timer=setTimeout(J,G)}}});Function.prototype.debounce=function(){var J,I,M,H,K,G,L;G=arguments[0],H=arguments[1],L=arguments[2],J=4<=arguments.length?v.call(arguments,3):[];if(G==null){G=300}if(H==null){H=false}if(L==null){L=window.debounce_timer}K=this;I=function(){if(!H){K.apply(K,J)}return console.log("Debounce applied")};if(L!=null){try{clearTimeout(L)}catch(N){M=N}}else{if(H){K.apply(obj,J);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(I,G)};h=function(){return $(".newwindow").each(function(){var G,H;G=$(this).attr("href");H=function(I){if(I==null){return false}window.open(I);return false};$(this).click(function(){return H(G)});return $(this).keypress(function(){return H(G)})})};t=function(N,L){var I,M,J,G,H,K;if(N==null){N=50}if(L==null){L="#status-container"}try{if($(L).exists()){H=n(N*0.5);I=$(L).find(".ball");K=$(L).find(".ball1");I.removeClass("stop hide");I.css({width:""+N+"px",height:""+N+"px"});J=n(N/2+H/2+9);G=n((N+10)/2-(H+6)/2);K.removeClass("stop hide");K.css({width:""+H+"px",height:""+H+"px",top:"-"+J+"px","margin-left":""+G+"px"});return true}return false}catch(O){M=O;return console.log("Could not animate loader",M.message)}};f=function(H){var G,J,I;if(H==null){H="#status-container"}try{if($(H).exists()){G=$(H).find(".ball");I=$(H).find(".ball1");G.addClass("bballgood ballgood");I.addClass("bballgood ball1good");return F(250,function(){G.addClass("stop hide");G.removeClass("bballgood ballgood");I.addClass("stop hide");return I.removeClass("bballgood ballgood")})}}catch(K){J=K;return console.log("Could not stop load animation",J.message)}};C=function(H){var G,J,I;if(H==null){H="#status-container"}try{if($(H).exists()){G=$(H).find(".ball");I=$(H).find(".ball1");G.addClass("bballerror ballerror");I.addClass("bballerror ball1error");return F(1500,function(){G.addClass("stop hide");G.removeClass("bballerror ballerror");I.addClass("stop hide");return I.removeClass("bballerror ballerror")})}}catch(K){J=K;return console.log("Could not stop load error animation",J.message)}};$(function(){var G;try{window.picturefill()}catch(H){G=H;console.log("Could not execute picturefill.")}return h()});if(typeof c!=="object"){c=new Object()}c.goodbg="#cae682";c.badbg="#e5786d";if(c.minLength==null){c.minLength=8}if(c.overrideLength==null){c.overrideLength=21}D=new Object();D.mainStylesheetPath="css/otp_styles.css";D.popStylesheetPath="css/otp_panels.css";D.popClass="pop-panel";D.home="http://velociraptorsystems.com/samples/userhandler/test_page.php";d=function(){var G;G=$("#password").val();if(G.length>c.overrideLength||G.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",c.goodbg);c.basepwgood=true}else{$("#password").css("background",c.badbg);c.basepwgood=false}i();if(!u($("#password2").val())){k();B()}return false};k=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",c.goodbg);c.passmatch=true}else{$("#password2").css("background",c.badbg);c.passmatch=false}B();return false};B=function(){var H,G;try{H=!(c.passmatch&&c.basepwgood);return $("#createUser_submit").attr("disabled",H)}catch(I){G=I;c.passmatch=false;return c.basepwgood=false}};i=function(){var G,H,I;if(!$("#strength-meter").exists()){G="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(G)}H=$("#password").val();I=zxcvbn(H);$(".strength-eval").css("background",c.badbg);if(H.length>20){$(".strength-eval").css("background",c.goodbg)}else{if(H.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",c.goodbg)}if(H.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",c.goodbg)}if(H.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",c.goodbg)}}return $("#password-strength").attr("value",I.score+1)};z=function(){};r=function(N){var P,M,H,K,O,L,G,I,J;if(N==null){N=D.home}x();t();H=$("#totp_code").val();J=$("#username").val();O=$("#password").val();K=$("#remote").val();G=$.url();P="async_login_handler.php";I=G.attr("protocol")+"://"+G.attr("host")+"/"+G.attr("directory")+"/../"+P;M="action=verifytotp&code="+H+"&user="+J+"&password="+O+"&remote="+K;L=$.post(I,M,"json");console.log("CHecking",I+"?"+M);L.done(function(Q){var S,R;if(Q.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");R=0;return $.each(Q.cookies.raw_cookie,function(U,X){var V;try{$.cookie(U,X,Q.cookies.expires)}catch(W){V=W;console.error("Couldn't set cookies",Q.cookies.raw_cookie)}R++;if(R===Object.size(Q.cookies.raw_cookie)){if(N==null){N=G.attr("protocol")+"://"+G.attr("host")+"/"}f();console.log(Q.cookies);return F(500,function(){return window.location.href=N})}})}catch(T){S=T;return console.error("Unexpected error while validating",S.message)}}else{$("#totp_message").text(Q.human_error);$("#totp_code").val("");$("#totp_code").focus();C();return console.error("Invalid code error",Q.error,Q)}});return L.fail(function(Q,R){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",I+"?"+M,Q,R);return C()})};b=function(){return x()};y=function(){var O,L,J,M,N,K,G,H,I;x();t();I=$("#username").val();N=$("#password").val();J=$("#hash").val();M=$("#secret").val();G=$.url();O="async_login_handler.php";H=G.attr("protocol")+"://"+G.attr("host")+"/"+G.attr("directory")+"/../"+O;L="action=maketotp&password="+N+"&user="+I;K=$.post(H,L,"json");K.done(function(P){var T,S,R,U,V,Q;if(P.status===true){Q=P.svg;R=P.raw;V="show_secret";U="showAltBarcode";T="secretBarcode";S="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+V+"'>click here to manually input your key.</a></p> <div id='"+T+"'> "+P.svg+" <p>Don't see the barcode? <a href='#' id='"+U+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+I+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(S);$("#"+V).click(function(){return a(P.human_secret)});$("#"+U).click(function(){var W;W="<img src='"+P.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(W)});$("#verify_totp_button").click(function(){x();return s(M,J)});$("#totp_verify").submit(function(){x();return s(M,J)});return f()}else{console.error("Couldn't generate TOTP code",H+"?"+L);$("#totp_message").text("There was an error generating your code. Please try again.");return C()}});K.fail(function(P,Q){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",H+"?"+L,P,Q);return C()});return false};s=function(N,K){var O,M,H,L,G,I,J;x();H=$("#code").val();J=$("#username").val();G=$.url();O="async_login_handler.php";I=G.attr("protocol")+"://"+G.attr("host")+"/"+G.attr("directory")+"/../"+O;M="action=savetotp&secret="+N+"&user="+J+"&hash="+K+"&code="+H;console.log("Checking",I+"?"+M);L=$.post(I,M,"json");L.done(function(P){var Q;if(P.status===true){Q="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+P.backup+"</pre>";$("#totp_add").html(Q);console.log("Success!");return f()}else{Q="<p class='error' id='temp_error'>"+P.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(Q)}else{$("#temp_error").html(Q)}console.error(P.error);return C()}});return L.fail(function(P,Q){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",P,Q);return C()})};a=function(G){var H;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:D.popStylesheetPath}).appendTo("head");H="<div id='secret_id_panel' class='"+D.popClass+"'><p class='close-popup'>X</p><h2>"+G+"</h2></div>";$("#totp_add").after(H);return $(".close-popup").click(function(){return $("#secret_id_panel").remove()})};x=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password").keyup(function(){return d()}).change(function(){return d()});$("#password2").change(function(){return k()}).keyup(function(){return k()});$("#totp_submit").submit(function(){return r()});$("#verify_totp_button").click(function(){return r()});$("#totp_start").submit(function(){return y()});$("#add_totp_button").click(function(){return y()});$("#totp_remove").submit(function(){return b()});$("#remove_totp_button").click(function(){return b()});return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:D.mainStylesheetPath}).appendTo("head")})}).call(this);