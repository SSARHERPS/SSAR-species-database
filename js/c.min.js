(function(){var q,f,G,D,z,H,g,e,B,y,x,v,k,l,C,I,n,s,E,r,o,a,u,F,p,c,b,i,j,d,J,m,h,t=[].slice;o=typeof exports!=="undefined"&&exports!==null?exports:this;v=function(K){return K===true||K===false};k=function(K){return !K||K.length===0};x=function(K){return !K||/^\s*$/.test(K)};C=function(L){try{if(k(L)||x(L)||(L==null)){if(!(L===false||L===0)){return true}}}catch(K){}return false};l=function(L){if(typeof L==="object"){return true}try{JSON.parse(L);return true}catch(K){}return false};I=function(K){return !isNaN(parseFloat(K))&&isFinite(K)};b=function(K){if(!I(K)||C(K)){return 0}return parseFloat(K)};i=function(K){if(!I(K)||C(K)){return 0}return parseInt(K)};function w(K){var M={};for(var L=0;L<K.length;++L){if(K[L]!==undefined){M[L]=K[L]}}return M}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(M){var L,K;K=0;for(L in M){if(M.hasOwnProperty(L)){K++}}return K};z=function(K,L){return setTimeout(L,K)};a=function(L,M){var K;if(M==null){M=0}K=Math.pow(10,M);return Math.round(L*K)/K};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};f=(function(K){return function(L){return encodeURI(L).split(/%..|./).length-1}})(this);function A(N){for(var L,K,M=N.length;M;L=Math.floor(Math.random()*M),K=N[--M],N[M]=N[L],N[L]=K){}return N}window.debounce_timer=null;({debounce:function(M,K,L){if(K==null){K=300}if(L==null){L=false}return function(){var O,N,P;O=1<=arguments.length?t.call(arguments,0):[];P=this;N=function(){if(!L){return M.apply(P,O)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(L){M.apply(P,O)}}return window.debounce_timer=setTimeout(N,K)}}});Function.prototype.debounce=function(){var N,M,Q,L,O,K,P;K=arguments[0],L=arguments[1],P=arguments[2],N=4<=arguments.length?t.call(arguments,3):[];if(K==null){K=300}if(L==null){L=false}if(P==null){P=window.debounce_timer}O=this;M=function(){if(!L){O.apply(O,N)}return console.log("Debounce applied")};if(P!=null){try{clearTimeout(P)}catch(R){Q=R}}else{if(L){O.apply(obj,N);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(M,K)};s=function(){return $(".newwindow").each(function(){var K,L;K=$(this).attr("href");L=function(M){if(M==null){return false}window.open(M);return false};$(this).click(function(){return L(K)});return $(this).keypress(function(){return L(K)})})};q=function(R,P){var M,Q,N,K,L,O;if(R==null){R=50}if(P==null){P="#status-container"}try{if($(P).exists()){L=a(R*0.5);M=$(P).find(".ball");O=$(P).find(".ball1");M.removeClass("stop hide");M.css({width:""+R+"px",height:""+R+"px"});N=a(R/2+L/2+9);K=a((R+10)/2-(L+6)/2);O.removeClass("stop hide");O.css({width:""+L+"px",height:""+L+"px",top:"-"+N+"px","margin-left":""+K+"px"});return true}return false}catch(S){Q=S;return console.log("Could not animate loader",Q.message)}};p=function(L){var K,N,M;if(L==null){L="#status-container"}try{if($(L).exists()){K=$(L).find(".ball");M=$(L).find(".ball1");K.addClass("bballgood ballgood");M.addClass("bballgood ball1good");return z(250,function(){K.addClass("stop hide");K.removeClass("bballgood ballgood");M.addClass("stop hide");return M.removeClass("bballgood ballgood")})}}catch(O){N=O;return console.log("Could not stop load animation",N.message)}};c=function(L){var K,N,M;if(L==null){L="#status-container"}try{if($(L).exists()){K=$(L).find(".ball");M=$(L).find(".ball1");K.addClass("bballerror ballerror");M.addClass("bballerror ball1error");return z(1500,function(){K.addClass("stop hide");K.removeClass("bballerror ballerror");M.addClass("stop hide");return M.removeClass("bballerror ballerror")})}}catch(O){N=O;return console.log("Could not stop load error animation",N.message)}};$(function(){var K;try{window.picturefill()}catch(L){K=L;console.log("Could not execute picturefill.")}return s()});if(typeof window.passwords!=="object"){window.passwords=new Object()}window.passwords.goodbg="#cae682";window.passwords.badbg="#e5786d";if((m=window.passwords).minLength==null){m.minLength=8}if((h=window.passwords).overrideLength==null){h.overrideLength=21}if(typeof window.totpParams!=="object"){window.totpParams=new Object()}window.totpParams.mainStylesheetPath="css/otp_styles.css";window.totpParams.popStylesheetPath="css/otp_panels.css";window.totpParams.popClass="pop-panel";if(window.totpParams.home==null){d=$.url();window.totpParams.home=d.attr("protocol")+"://"+d.attr("host")+"/"}if(window.totpParams.relative==null){window.totpParams.relative=""}D=function(){var K;K=$("#password").val();if(K.length>window.passwords.overrideLength||K.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",window.passwords.goodbg);window.passwords.basepwgood=true}else{$("#password").css("background",window.passwords.badbg);window.passwords.basepwgood=false}B();if(!C($("#password2").val())){G();j()}return false};G=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",window.passwords.goodbg);window.passwords.passmatch=true}else{$("#password2").css("background",window.passwords.badbg);window.passwords.passmatch=false}j();return false};j=function(){var L,K;try{L=!(window.passwords.passmatch&&window.passwords.basepwgood);return $("#createUser_submit").attr("disabled",L)}catch(M){K=M;window.passwords.passmatch=false;return window.passwords.basepwgood=false}};B=function(){var K,L,M;if(!$("#strength-meter").exists()){K="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(K)}L=$("#password").val();M=zxcvbn(L);$(".strength-eval").css("background",window.passwords.badbg);if(L.length>20){$(".strength-eval").css("background",window.passwords.goodbg)}else{if(L.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",window.passwords.goodbg)}if(L.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",window.passwords.goodbg)}if(L.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",window.passwords.goodbg)}}return $("#password-strength").attr("value",M.score+1)};H=function(){};e=function(Q){var S,P,K,N,R,O,L,M;if(Q==null){Q=window.totpParams.home}E();q();K=$("#totp_code").val();M=$("#username").val();R=$("#password").val();N=$("#remote").val();d=$.url();S="async_login_handler.php";L=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+S;P="action=verifytotp&code="+K+"&user="+M+"&password="+R+"&remote="+N;O=$.post(L,P,"json");O.done(function(T){var V,U;if(T.status===true){try{$("#totp_message").text("Correct!").removeClass("error").addClass("good");U=0;return $.each(T.cookies.raw_cookie,function(X,aa){var Y;try{$.cookie(X,aa,T.cookies.expires)}catch(Z){Y=Z;console.error("Couldn't set cookies",T.cookies.raw_cookie)}U++;if(U===Object.size(T.cookies.raw_cookie)){if(Q==null){Q=d.attr("protocol")+"://"+d.attr("host")+"/"}p();return z(500,function(){return window.location.href=Q})}})}catch(W){V=W;return console.error("Unexpected error while validating",V.message)}}else{$("#totp_message").text(T.human_error);$("#totp_code").val("");$("#totp_code").focus();c();return console.error("Invalid code error",T.error,T)}});return O.fail(function(T,U){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",L+"?"+P,T,U);return c()})};g=function(){var K,M,L,N;E();q();d=$.url();K="async_login_handler.php";N=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;M="action=removetotp&code="+code+"&username="+user+"&password="+pass;L=$.get(N,M,"json");L.done(function(O){if(O.status!==true){$("#totp_message").text(O.human_error);console.error(O.error);c();return false}$("#totp_message").removeClass("error").addClass("good").text("Two-factor authentication removed for "+O.username+".");$("#totp_remove").remove();p();return false});return L.fail(function(O,P){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",N+"?"+M,O,P);return c()})};n=function(){var K,N,Q,O,M,R,P,L;E();q();L=$("#username").val();M=$("#password").val();Q=$("#hash").val();O=$("#secret").val();d=$.url();K="async_login_handler.php";P=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;N="action=maketotp&password="+M+"&user="+L;R=$.post(P,N,"json");R.done(function(S){var W,V,U,X,Y,T;if(S.status===true){T=S.svg;U=S.raw;Y="show_secret";X="showAltBarcode";W="secretBarcode";V="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone authenticator application. <small><a href='#' id='alt_totp_help'>Don't have the app?</a></small></p> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+Y+"'>click here to manually input your key.</a></p> <div id='"+W+"'> "+S.svg+" <p>Don't see the barcode? <a href='#' id='"+X+"'>Click here</a></p> </div> <p>Once you've done so, enter the code generated by your app in the field below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+L+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(V);$("#alt_totp_help").click(function(){return F()});$("#"+Y).click(function(){return r(S.human_secret)});$("#"+X).click(function(){var Z;Z="<img src='"+S.raw+"' alt='TOTP barcode'/>";$(""+barcode_div).html(Z);return $("#"+X).remove()});$("#verify_totp_button").click(function(){E();return u(O,Q)});$("#totp_verify").submit(function(){E();return u(O,Q)});return p()}else{console.error("Couldn't generate TOTP code",P+"?"+N);$("#totp_message").text("There was an error generating your code. Please try again.");return c()}});R.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",P+"?"+N,S,T);return c()});return false};u=function(N,Q){var K,M,O,R,P,L;E();q();O=$("#code").val();L=$("#username").val();d=$.url();K="async_login_handler.php";P=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;M="action=savetotp&secret="+N+"&user="+L+"&hash="+Q+"&code="+O;R=$.post(P,M,"json");R.done(function(S){var T;if(S.status===true){T="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre id='backup_code'>"+S.backup+"</pre><br/><button id='to_home'>Home &#187;</a>";$("#totp_add").html(T);$("#to_home").click(function(){return window.location.href=window.totpParams.home});return p()}else{T="<p class='error' id='temp_error'>"+S.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(T)}else{$("#temp_error").html(T)}console.error(S.error);return c()}});return R.fail(function(S,T){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",S,T);return c()})};r=function(K){var L;$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.popStylesheetPath}).appendTo("head");L="<div id='cover_wrapper'><div id='secret_id_panel' class='"+window.totpParams.popClass+" cover_content'><p class='close-popup'>X</p><h2>"+K+"</h2></div></div>";$("article").after(L);$("article").addClass("blur");return $(".close-popup").click(function(){$("#cover_wrapper").remove();return $("article").removeClass("blur")})};y=function(){var T,R,O,M,S,P,K,Q,L,N;d=$.url();T="async_login_handler.php";L=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+T;N=$("#username").val();R="action=cansms&user="+N;P="remove_totp_link";Q="send_totp_sms";M="alt_auth_pane";S="alt_auth_messages";O=new Object();O.remove="<a href='#' id='"+P+"'>Remove two-factor authentication</a>";K=$.get(L,R,"json");K.done(function(U){var V,W;if(U[0]===true){O.sms="<a href='#' id='"+Q+"'>Send SMS</a>"}else{console.warn("Couldn't get a valid result",U,L+"?"+R)}W="";$.each(O,function(Y,X){return W+=X});V="<div id='"+M+"'><p>"+W+"</p><p id='"+S+"'></p></div>";$("#totp_submit").after(V);return $("#"+Q).click(function(){var X;R="action=sendtotptext&user="+N;X=$.get(L,R,"json");console.log("Sending message ...",L+"?"+R);X.done(function(Y){if(Y.status===true){$("#"+M).remove();return $("#totp_message").text(Y.message)}else{$("#"+S).addClass("error").text(Y.human_error);return console.error(Y.error)}});return X.fail(function(Y,Z){console.error("AJAX failure trying to send TOTP text",L+"?"+R);return console.error("Returns:",Y,Z)})})});K.fail(function(U,V){return console.error("Could not check SMS-ability",U,V)});return K.always(function(){return $("#"+P).click(function(){var U;if((U=window.totpParams).home==null){U.home=d.attr("protocol")+"://"+d.attr("host")+"/login.php"}return window.location.href=window.totpParams.home+"?2fa=t"})})};J=function(){var K,M,O,P,L,N;E();d=$.url();K="async_login_handler.php";P=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../"+K;O=$("#phone_auth").val()!=null?$("#phone_auth").val():null;L=$("#username").val();M="action=verifyphone&username="+L+"&auth="+O;N=$.get(P,M,"json");N.done(function(Q){var R,S;if(Q.status===false){if(!$("#phone_verify_message").exists()){$("#phone").before("<p id='phone_verify_message'></p>")}if(Q.is_good===true){$("#verify_phone_button").remove();R="You've already verified your phone number, thanks!";S="good"}else{R=Q.human_error;S="error";console.error(Q.error)}$("#phone_verify_message").text(R).addClass(S);if(Q.fatal===true){$("#verify_phone_button").attr("disabled",true);$("#verify_phone").unbind("submit").attr("onsubmit","")}return false}if(Q.status===true){if(!$("#phone_auth").exists()){$("#username").after("<br/><input type='text' length='8' name='phone_auth' id='phone_auth' placeholder='Authorization Code'/>")}if(!$("#phone_verify_message").exists()){$("#phone").before("<p id='phone_verify_message'></p>")}$("#phone_verify_message").text(Q.message);if(Q.is_good!==true){return $("#verify_phone_button").text("Confirm")}else{$("#phone_auth").remove();$("#verify_later").remove();return $("#verify_phone_button").html("Continue &#187; ").unbind("click").click(function(){return window.location.href=window.totpParams.home})}}else{console.warn("Unexpected condition encountered verifying the phone number",P);console.log(Q);return false}});return N.fail(function(Q,R){console.error("AJAX failure trying to send phone verification text",P+"?"+M);return console.error("Returns:",Q,R)})};F=function(K){if(K==null){K="help/instructions_pop.html"}$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.popStylesheetPath}).appendTo("head");return $.get(window.totpParams.relative+K).done(function(M){var L,N;$("article").after(M);$("article").addClass("blur");d=$.url();N=d.attr("protocol")+"://"+d.attr("host")+"/"+d.attr("directory")+"/../";L=""+N+"assets/";$(".android").html("<img src='"+L+"playstore.png' alt='Google Play Store'/>");$(".ios").html("<img src='"+L+"appstore.png' alt='iOS App Store'/>");$(".wp8").html("<img src='"+L+"wpstore.png' alt='Windows Phone Store'/>");$(".app_link_container a").addClass("newwindow");s();return $(".close-popup").click(function(){$("article").removeClass("blur");return $("#cover_wrapper").remove()})}).fail(function(L,M){return console.error("Failed to load instructions @ "+K,L,M)})};E=function(){event.preventDefault();return event.returnValue=false};$(function(){$("#password.create").keyup(function(){return D()}).change(function(){return D()});$("#password2").change(function(){return G()}).keyup(function(){return G()});$("#totp_submit").submit(function(){return e()});$("#verify_totp_button").click(function(){return e()});$("#totp_start").submit(function(){return n()});$("#add_totp_button").click(function(){return n()});$("#totp_remove").submit(function(){return g()});$("#remove_totp_button").click(function(){return g()});$("#alternate_verification_prompt").click(function(){return y()});$("#verify_phone").submit(function(){return J()});$("#verify_phone_button").click(function(){return J()});$("#verify_later").click(function(){return window.location.href=window.totpParams.home});$("#totp_help").click(function(){return F()});if($.url().param("showhelp")!=null){F()}return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.mainStylesheetPath}).appendTo("head")})}).call(this);