(function(){var t,l,k,d,E,z,b,r,i,m,o,q,D,u,p,y,h,x,c,a,A,n,s,f,C,g,j,B,v=[].slice;A=typeof exports!=="undefined"&&exports!==null?exports:this;o=function(F){return F===true||F===false};q=function(F){return !F||F.length===0};m=function(F){return !F||/^\s*$/.test(F)};u=function(G){try{if(q(G)||m(G)||(G==null)){if(!(G===false||G===0)){return true}}}catch(F){}return false};D=function(G){if(typeof G==="object"){return true}try{JSON.parse(G);return true}catch(F){}return false};p=function(F){return !isNaN(parseFloat(F))&&isFinite(F)};g=function(F){if(!p(F)||u(F)){return 0}return parseFloat(F)};j=function(F){if(!p(F)||u(F)){return 0}return parseInt(F)};function w(F){var H={};for(var G=0;G<F.length;++G){if(F[G]!==undefined){H[G]=F[G]}}return H}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Object.size=function(H){var G,F;F=0;for(G in H){if(H.hasOwnProperty(G)){F++}}return F};E=function(F,G){return setTimeout(G,F)};n=function(G,H){var F;if(H==null){H=0}F=Math.pow(10,H);return Math.round(G*F)/F};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};l=(function(F){return function(G){return encodeURI(G).split(/%..|./).length-1}})(this);function e(I){for(var G,F,H=I.length;H;G=Math.floor(Math.random()*H),F=I[--H],I[H]=I[G],I[G]=F){}return I}window.debounce_timer=null;({debounce:function(H,F,G){if(F==null){F=300}if(G==null){G=false}return function(){var J,I,K;J=1<=arguments.length?v.call(arguments,0):[];K=this;I=function(){if(!G){return H.apply(K,J)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(G){H.apply(K,J)}}return window.debounce_timer=setTimeout(I,F)}}});Function.prototype.debounce=function(){var I,H,L,G,J,F,K;F=arguments[0],G=arguments[1],K=arguments[2],I=4<=arguments.length?v.call(arguments,3):[];if(F==null){F=300}if(G==null){G=false}if(K==null){K=window.debounce_timer}J=this;H=function(){if(!G){J.apply(J,I)}return console.log("Debounce applied")};if(K!=null){try{clearTimeout(K)}catch(M){L=M}}else{if(G){J.apply(obj,I);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(H,F)};h=function(){return $(".newwindow").each(function(){var F,G;F=$(this).attr("href");G=function(H){if(H==null){return false}window.open(H);return false};$(this).click(function(){return G(F)});return $(this).keypress(function(){return G(F)})})};t=function(M,K){var H,L,I,F,G,J;if(M==null){M=50}if(K==null){K="#status-container"}try{if($(K).exists()){G=n(M*0.5);H=$(K).find(".ball");J=$(K).find(".ball1");H.removeClass("stop hide");H.css({width:""+M+"px",height:""+M+"px"});I=n(M/2+G/2+9);F=n((M+10)/2-(G+6)/2);J.removeClass("stop hide");J.css({width:""+G+"px",height:""+G+"px",top:"-"+I+"px","margin-left":""+F+"px"});return true}return false}catch(N){L=N;return console.log("Could not animate loader",L.message)}};f=function(G){var F,I,H;if(G==null){G="#status-container"}try{if($(G).exists()){F=$(G).find(".ball");H=$(G).find(".ball1");F.addClass("bballgood ballgood");H.addClass("bballgood ball1good");return E(250,function(){F.addClass("stop hide");F.removeClass("bballgood ballgood");H.addClass("stop hide");return H.removeClass("bballgood ballgood")})}}catch(J){I=J;return console.log("Could not stop load animation",I.message)}};C=function(G){var F,I,H;if(G==null){G="#status-container"}try{if($(G).exists()){F=$(G).find(".ball");H=$(G).find(".ball1");F.addClass("bballerror ballerror");H.addClass("bballerror ball1error");return E(1500,function(){F.addClass("stop hide");F.removeClass("bballerror ballerror");H.addClass("stop hide");return H.removeClass("bballerror ballerror")})}}catch(J){I=J;return console.log("Could not stop load error animation",I.message)}};$(function(){var F;try{window.picturefill()}catch(G){F=G;console.log("Could not execute picturefill.")}return h()});c=new Object();c.goodbg="#cae682";c.badbg="#e5786d";if(c.minLength==null){c.minLength=8}if(c.overrideLength==null){c.overrideLength=21}d=function(){var F;F=$("#password").val();if(F.length>c.overrideLength||F.match(/^(?:(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$)$/)){$("#password").css("background",c.goodbg);c.basepwgood=true}else{$("#password").css("background",c.badbg);c.basepwgood=false}i();if(!u($("#password2").val())){k();B()}return false};k=function(){if($("#password").val()===$("#password2").val()){$("#password2").css("background",c.goodbg);c.passmatch=true}else{$("#password2").css("background",c.badbg);c.passmatch=false}B();return false};B=function(){var G,F;try{G=!(c.passmatch&&c.basepwgood);return $("#createUser_submit").attr("disabled",G)}catch(H){F=H;c.passmatch=false;return c.basepwgood=false}};i=function(){var F,G,H;if(!$("#strength-meter").exists()){F="<div id='strength-meter'><div id='strength-requirements'><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress></div></div>";$("#login .right").prepend(F)}G=$("#password").val();H=zxcvbn(G);$(".strength-eval").css("background",c.badbg);if(G.length>20){$(".strength-eval").css("background",c.goodbg)}else{if(G.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)){$("#strength-numspecial .strength-eval").css("background",c.goodbg)}if(G.match(/^(?=.*[a-z]).*$/)){$("#strength-alpha .strength-eval").css("background",c.goodbg)}if(G.match(/^(?=.*[A-Z]).*$/)){$("#strength-alphacap .strength-eval").css("background",c.goodbg)}}return $("#password-strength").attr("value",H.score+1)};z=function(){};r=function(){var F,I,J,L,H,K,G;x();t();J=$("#totp_code").val();G=$("#username").val();H=$.url();F="async_login_handler.php";K=H.attr("protocol")+"://"+H.attr("host")+"/"+H.attr("directory")+"/../"+F;I="action=verifytotp&code="+J+"&user="+G;L=$.post(K,I,"json");L.done(function(M){var N,O;if(M.status===true){$("#totp_message").text("Correct!").removeClass("error").addClass("good");N=M.expires;O=0;return $.each(M.raw_cookie(function(P,R){var Q;$.cookie(P,R,N);O++;if(O===Object.size(M.raw_cookie)){Q=H.attr("protocol")+"://"+H.attr("host")+"/";f();return window.location(Q)}}))}else{$("#totp_message").text(M.human_error);$("#totp_code").val("");$("#totp_code").focus();C();return console.error(M.error,M)}});return L.fail(function(M,N){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",K+"?"+I,M,N);return C()})};b=function(){return x()};y=function(){var N,K,I,L,M,J,F,G,H;x();t();H=$("#username").val();M=$("#password").val();I=$("#hash").val();L=$("#secret").val();F=$.url();N="async_login_handler.php";G=F.attr("protocol")+"://"+F.attr("host")+"/"+F.attr("directory")+"/../"+N;K="action=maketotp&password="+M+"&user="+H;J=$.post(G,K,"json");J.done(function(O){var S,R,Q,T,U,P;if(O.status===true){P=O.svg;Q=O.raw;U="show_secret";T="showAltBarcode";S="secretBarcode";R="<form id='totp_verify'> <p>To continue, scan this barcode with your smartphone application.</p> <p>If you're unable to do so, <a href='#' id='"+U+"'>click here</a></p> <div id='"+S+"'> "+O.svg+" <p>Don't see the barcode? <a href='#' id='"+T+"'>Click here</a></p> </div> <p>Once you've done so, enter your code below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+H+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>";$("#totp_add").html(R);$("#"+U).click(function(){return a(O.secret)});$("#"+T).click(function(){var V;V="<img src='"+O.raw+"' alt='TOTP barcode'/>";return $(""+barcode_div).html(V)});$("#verify_totp_button").click(function(){x();return s(L,I)});$("#totp_verify").submit(function(){x();return s(L,I)});return f()}else{console.error("Couldn't generate TOTP code",G+"?"+K);$("#totp_message").text("There was an error generating your code. Please try again.");return C()}});J.fail(function(O,P){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",G+"?"+K,O,P);return C()});return false};s=function(M,J){var N,L,G,K,F,H,I;x();G=$("#code").val();I=$("#username").val();F=$.url();N="async_login_handler.php";H=F.attr("protocol")+"://"+F.attr("host")+"/"+F.attr("directory")+"/../"+N;L="action=savetotp&secret="+M+"&user="+I+"&hash="+J+"&code="+G;console.log("Checking",H+"?"+L);K=$.post(H,L,"json");K.done(function(O){var P;if(O.status===true){P="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre>"+O.backup+"</pre>";$("#totp_add").html(P);console.log("Success!");return f()}else{P="<p class='error' id='temp_error'>"+O.human_error+"</p>";if(!$("#temp_error").exists()){$("#verify_totp_button").after(P)}else{$("#temp_error").html(P)}console.error(O.error);return C()}});return K.fail(function(O,P){$("#totp_message").text("Failed to contact server. Please try again.");console.error("AJAX failure",O,P);return C()})};a=function(F){};x=function(){event.preventDefault();return event.returnValue=false};$(function(){loadScript("js/zxcvbn.js");$("#password").keyup(function(){return d()}).change(function(){return d()});$("#password2").change(function(){return k()}).keyup(function(){return k()});$("#totp_submit").submit(function(){return r()});$("#verify_totp_button").click(function(){return r()});$("#totp_start").submit(function(){return y()});$("#add_totp_button").click(function(){return y()});$("#totp_remove").submit(function(){return b()});return $("#remove_totp_button").click(function(){return b()})})}).call(this);