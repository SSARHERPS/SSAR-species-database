function toObject(a){for(var b={},c=0;c<a.length;++c)void 0!==a[c]&&(b[c]=a[c]);return b}function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function loadJS(a,b){console.log("Entering loadjs for",a);var c=document.createElement("script");c.setAttribute("src",a),c.setAttribute("async","async"),c.setAttribute("type","text/javascript"),c.src=a,c.async=!0;var d=function(){console.log("Entering readystate function");var d=c.readyState;try{console.log("Loaded",a),b.done||d&&!/loaded|complete/.test(d)||(b.done=!0,b())}catch(e){console.log("Callback error")}},e=function(){try{console.warn("There may have been a problem loading",a),b.done||(b.done=!0,b())}catch(c){console.log("Error and error")}};c.setAttribute("onload",d),c.setAttribute("onreadystate",d),c.setAttribute("onerror",e),c.onload=c.onreadystate=d,c.onerror=e,document.getElementsByTagName("head")[0].appendChild(c),console.log("Exiting with",c)}var activityIndicatorOff,activityIndicatorOn,adminParams,animateLoad,bindClickTargets,browserBeware,byteCount,checkTaxonNear,clearSearch,createDuplicateTaxon,createNewTaxon,d$,deepJQuery,deferCalPhotos,delay,deleteTaxon,doCORSget,foo,formatScientificNames,formatSearchResults,getFilters,getLocation,goTo,handleDragDropImage,insertModalImage,isBlank,isBool,isEmpty,isJson,isNull,isNumber,lightboxImages,loadAdminUi,loadModalTaxonEditor,lookupEditorSpecies,mapNewWindows,modalTaxon,openLink,openTab,overlayOff,overlayOn,parseTaxonYear,performSearch,prepURI,randomInt,renderAdminSearchResults,root,roundNumber,saveEditorEntry,searchParams,setHistory,sortResults,ssar,stopLoad,stopLoadError,toFloat,toInt,toastStatusMessage,uri,verifyLoginCredentials,__slice=[].slice;adminParams=new Object,adminParams.apiTarget="admin_api.php",adminParams.adminPageUrl="http://ssarherps.org/cndb/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=""+adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b,c;return b="<h3>\n  Welcome, "+$.cookie("ssarherps_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'settings-applications\' class=\'click\' data-url=\''+a.login_url+'\'></paper-icon-button>\n  </span>\n  <span id="pib-wrapper-exit-to-app" class="pib-wrapper" data-toggle="tooltip" title="Go to CNDB app" data-placement="bottom">\n    <paper-icon-button icon=\'exit-to-app\' class=\'click\' data-url=\''+uri.urlString+"' id=\"app-linkout\"></paper-icon-button>\n  </span>\n</h3>\n<div id='admin-actions-block'>\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</div>",$("article").html(b),$(".pib-wrapper").tooltip(),c='<form id="admin-search-form" onsubmit="event.preventDefault()" class="row">\n  <div>\n    <paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel class="col-xs-7 col-sm-8"></paper-input>\n    <paper-fab id="do-admin-search" icon="search" raisedButton class="materialblue"></paper-fab>\n    <paper-fab id="do-admin-add" icon="add" raisedButton class="materialblue"></paper-fab>\n  </div>\n</form>\n<div id=\'search-results\' class="row"></div>',$("#admin-actions-block").html(c),$("#admin-search-form").submit(function(a){return a.preventDefault()}),$("#admin-search").keypress(function(a){return 13===a.which?renderAdminSearchResults():void 0}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),$("#do-admin-add").click(function(){return createNewTaxon()}),bindClickTargets(),!1})}catch(b){a=b,$("article").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie("ssarherps_auth"),e=$.cookie("ssarherps_secret"),d=$.cookie("ssarherps_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("article").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p>'</div>"),console.log(a,b),!1}),!1},renderAdminSearchResults=function(a){var b,c,d,e;return null==a&&(a="#search-results"),e=$("#admin-search").val(),isNull(e)?(toastStatusMessage("Please enter a search term"),!1):(animateLoad(),$("#admin-search").blur(),e=e.replace(/\./g,""),e=prepURI(e.toLowerCase()),b="q="+e+"&loose=true",c=Base64.encodeURI(e),d=""+uri.urlString+"#"+c,$("#app-linkout").attr("data-url",d),$.get(searchParams.targetApi,b,"json").done(function(b){var c,d,e,f,g,h,i;return b.status!==!0||0===b.count?(stopLoadError(),toastStatusMessage(isNull(b.human_error)?"Your search returned no results. Please try again.":b.human_error),!1):(e=b.result,f="",h="<table id='cndb-result-list' class='table table-striped table-hover'>\n	<tr class='cndb-row-headers'>",g="</table>",i=toInt(b.count)-1,d=null,c=0,$.each(e,function(b,e){var j,k,l,m;return 0===toInt(b)&&(k=0,h+="\n<!-- Table Headers - "+Object.size(e)+" entries -->",$.each(e,function(a,b){var f,g;return g=a.replace(/_/g," "),("genus"===a||"species"===a||"subspecies"===a)&&(h+="\n		<th class='text-center'>"+g+"</th>",c++),k++,k===Object.size(e)?(h+="\n		<th class='text-center'>Edit</th>",c++,h+="\n		<th class='text-center'>Delete</th>\n	</tr>",c++,h+="\n<!-- End Table Headers -->",console.log("Got "+c+" display columns."),f=roundNumber(12/c,0),d="col-md-"+f):void 0})),m=""+e.genus.trim()+"+"+e.species.trim(),isNull(e.subspecies)||(m=""+m+"+"+e.subspecies.trim()),j="\n	<tr id='cndb-row"+b+"' class='cndb-result-entry' data-taxon=\""+m+'">',l=0,$.each(e,function(a,c){return isNull(e.genus)?!0:(("genus"===a||"species"===a||"subspecies"===a)&&(j+="\n		<td id='"+a+"-"+b+"' class='"+a+" "+d+"'>"+c+"</td>"),l++,l===Object.size(e)?(j+="\n		<td id='edit-"+b+"' class='edit-taxon "+d+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+m+"'></paper-icon-button></td>",j+="\n		<td id='delete-"+b+"' class='delete-taxon "+d+" text-center'><paper-icon-button icon='delete' class='delete-taxon-button fadebg' data-taxon='"+m+"' data-database-id='"+e.id+"'></paper-icon-button></td>",j+="\n	</tr>",f+=j):void 0)}),toInt(b)===i?(f=h+f+g,$(a).html(f),console.log("Processed "+(toInt(b)+1)+" rows"),$(".edit").click(function(){var a;return a=$(this).attr("data-taxon"),lookupEditorSpecies(a)}),$(".delete-taxon-button").click(function(){var a,b;return b=$(this).attr("data-taxon"),a=$(this).attr("data-database-id"),deleteTaxon(a)}),stopLoad()):void 0}))}).fail(function(a,b){var c;return console.error("There was an error performing the search"),console.warn(a,c,a.statusText),c=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't execute the search - "+c),$("#search-status")[0].show(),stopLoadError()}))},loadModalTaxonEditor=function(a,b){var c,d,e,f;null==a&&(a=""),null==b&&(b="Save"),d='<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input>\n<paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input>\n<paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input>\n<paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input>\n<paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp"></paper-input>\n  <span class="help-block" id="deprecatedHelp">List names here in the form <span class="code">"Genus species":"Authority: year",...</span>. If not, it may not save correctly.</span>\n<paper-input label="Clade" id="edit-major-type" name="edit-major-type" floatingLabel></paper-input>\n<paper-input label="Subtype" id="edit-major-subtype" name="edit-major-subtype" floatingLabel></paper-input>\n<paper-input label="Minor clade / \'Family\'" id="edit-minor-type" name="edit-minor-type" floatingLabel></paper-input>\n<paper-input label="Linnean Order" id="edit-linnean-order" name="edit-linnean-order" class="linnean_order" floatingLabel></paper-input>\n<paper-input label="Common Type (eg., \'lizard\')" id="edit-major-common-type" name="edit-major-common-type" class="major_common_type" floatingLabel></paper-input>\n<paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input>\n<paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input>\n<paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input>\n<paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input>\n<br/><br/>\n<paper-autogrow-textarea id="edit-notes-autogrow" rows="5">\n  <textarea placeholder="Notes" id="edit-notes" name="edit-notes" aria-describedby="notes-help" rows="5"></textarea>\n</paper-autogrow-textarea>\n<span class="help-block" id="notes-help">You can write your notes in Markdown. (<a href="https://daringfireball.net/projects/markdown/syntax" "onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'">Official Full Syntax Guide</a>)</span>\n<paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input>\n  <span class="help-block" id="imagehelp">The image path here should be relative to the <span class="code">public_html/cndb/</span> directory.</span>\n<paper-input label="Taxon Credit" id="edit-taxon-credit" name="edit-taxon-credit" floatingLabel aria-describedby="taxon-credit-help"></paper-input>\n  <span class="help-block" id="taxon-credit-help">This will be displayed as "Taxon information by [your entry]."</span>\n'+a+'\n<input type="hidden" name="edit-taxon-author" id="edit-taxon-author" value="" />',e="<paper-action-dialog backdrop layered autoCloseDisabled closeSelector=\"#close-editor\" id='modal-taxon-edit'>\n  <div id='modal-taxon-editor'>\n    "+d+"\n  </div>\n  <paper-button id='close-editor' dismissive>Cancel</paper-button>\n  <paper-button id='duplicate-taxon' dismissive>Duplicate</paper-button>\n  <paper-button id='save-editor' affirmative>"+b+"</paper-button></paper-action-dialog>",$("#modal-taxon-edit").exists()&&$("#modal-taxon-edit").remove(),$("#search-results").after(e);try{f=$("html /deep/ #edit-notes").get(0),$("html /deep/ #edit-notes-autogrow").attr("target",f)}catch(g){c=g;try{f=$("html >>> #edit-notes").get(0),$("html >>> #edit-notes-autogrow").attr("target",f)}catch(g){c=g;try{f=$("#edit-notes").get(0),$("#edit-notes-autogrow").attr("target",f)}catch(g){c=g,console.error("Couldn't bind autogrow")}}}$("#modal-taxon-edit").unbind();try{return $("html /deep/ #save-editor").unbind(),$("html /deep/ #duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})}catch(g){return c=g,$("html >>> #save-editor").unbind(),$("html >>> #duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})}},createNewTaxon=function(){var a,b;animateLoad(),loadModalTaxonEditor("","Create");try{$("html /deep/ #duplicate-taxon").remove()}catch(c){a=c,$("html >>> #duplicate-taxon").remove()}b=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname");try{$("html /deep/ #edit-taxon-author").attr("value",b)}catch(c){a=c,$("html >>> #edit-taxon-author").attr("value",b)}try{$("html /deep/ #save-editor").click(function(){return saveEditorEntry("new")})}catch(c){a=c,$("html >>> #save-editor").click(function(){return saveEditorEntry("new")})}return $("#modal-taxon-edit")[0].open(),stopLoad()},createDuplicateTaxon=function(){var a;animateLoad();try{try{$("html /deep/ #taxon-id").remove(),$("html /deep/ #last-edited-by").remove(),$("html /deep/ #duplicate-taxon").remove()}catch(b){a=b,$("html >>> #taxon-id").remove(),$("html >>> #last-edited-by").remove(),$("html >>> #duplicate-taxon").remove()}try{$("html /deep/ #save-editor").text("Create").unbind().click(function(){return saveEditorEntry("new")})}catch(b){a=b,$("html >>> #save-editor").text("Create").unbind().click(function(){return saveEditorEntry("new")})}delay(250,function(){return stopLoad()})}catch(b){a=b,stopLoadError("Unable to duplicate taxon"),console.error("Couldn't duplicate taxon! "+a.message);try{$("html /deep/ #modal-taxon-edit").get(0).close()}catch(b){a=b,$("html >>> #modal-taxon-edit").get(0).close()}}return!1},lookupEditorSpecies=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=void 0),null==a)return!1;if(animateLoad(),f="<p id=\"last-edited-by\">\n  Last edited by <span id=\"taxon-author-last\" class=\"capitalize\"></span>\n</p>\n<input type='hidden' name='taxon-id' id='taxon-id'/>",loadModalTaxonEditor(f),d$("#save-editor").click(function(){return saveEditorEntry()}),c=d$("#last-edited-by").exists(),c||d$("#axon-credit-help").after(f),h=void 0,g=void 0,b="q="+a,-1!==a.search(/\(/)){for(g={genus:"",species:"",subspecies:""},h={genus:"",species:"",subspecies:""},k=a.split("+"),e=0;e<k.length;){switch(l=k[e],console.log("Checking '"+l+"'"),toInt(e)){case 0:d=l.split("("),console.log("Looking at genus array",d),g.genus=d[0].trim(),h.genus=null!=d[1]?d[1].trim().slice(0,-1):d[0];break;case 1:i=l.split("("),console.log("Looking at species array",i),g.species=i[0].trim(),h.species=null!=i[1]?i[1].trim().slice(0,-1):i[0];break;case 2:j=l.split("("),console.log("Looking at ssp array",j),g.subspecies=j[0].trim(),h.subspecies=null!=j[1]?j[1].trim().slice(0,-1):j[0];break;default:console.error("K value of '"+e+"' didn't match 0,1,2!")}k[e]=l.trim(),e++}a=""+g.genus+"+"+g.species,isNull(g.subspecies)||(a+=g.subspecies),b="q="+a+"&loose=true",console.warn("Bad name! Calculated out:"),console.warn("Should be currently",h),console.warn("Was previously",g),console.warn("Pinging with",""+uri.urlString+searchParams.targetApi+"?q="+a)}return $.get(searchParams.targetApi,b,"json").done(function(b){var c,d,e,f;try{if(c=b.result[0],null==c)return stopLoadError("Sorry, there was a problem parsing the information for this taxon. If it persists, you may have to fix it manually."),console.error("No data returned for",""+searchParams.targetApi+"?q="+a),!1;try{c.deprecated_scientific=JSON.parse(c.deprecated_scientific)}catch(i){d=i}null!=g&&(toastStatusMessage("Bad information found. Please review and resave."),c.genus=h.genus,c.species=h.species,c.subspecies=h.subspecies,"object"!=typeof c.deprecated_scientific&&(c.deprecated_scientific=new Object),f=g.species,isNull(g.subspecies)||(f+=g.subspecies),c.deprecated_scientific[""+g.genus+" "+f]="AUTHORITY: YEAR"),$.each(c,function(a,b){var c,e,f;try{"string"==typeof b&&(b=b.trim())}catch(g){d=g}if("id"===a&&$("#taxon-id").attr("value",b),"authority_year"===a)return f=parseTaxonYear(b),$("#edit-gauthyear").attr("value",f.genus),$("#edit-sauthyear").attr("value",f.species);if("taxon_author"!==a)return c="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a&&(b=JSON.stringify(b).trim().replace(/\\/g,""),b=b.replace(/{/,""),b=b.replace(/}/,""),'""'===b&&(b="")),"notes"!==a?d$(c).attr("value",b):d$(c).text(b);"null"===b||isNull(b)?($("#last-edited-by").remove(),console.warn("Removed #last-edited-by! Didn't have an author provided for column '"+a+"', giving '"+b+"'. It's probably the first edit to this taxon.")):d$("#taxon-author-last").text(b),e=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname");try{return $("html /deep/ #edit-taxon-author").attr("value",e)}catch(g){return d=g,$("html >>> #edit-taxon-author").attr("value",e)}});try{e=d$("#edit-notes").get(0),d$("#edit-notes-autogrow").get(0).update(e)}catch(i){d=i,console.error("Couldn't update autogrow size. Possibly related to","https://github.com/Polymer/paper-input/issues/182")}return $("#modal-taxon-edit")[0].open(),stopLoad()}catch(i){return d=i,stopLoadError(),toastStatusMessage("Unable to populate the editor for this taxon - "+d.message)}}).fail(function(a,b){return stopLoadError(),toastStatusMessage("There was a server error populating this taxon. Please try again.")}),!1},saveEditorEntry=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;null==a&&(a="save"),m=["genus","species","subspecies","common-name","major-type","major-common-type","major-subtype","minor-type","linnean-order","genus-authority","species-authority","notes","image","taxon-author","taxon-credit"],u=new Object,l=!1;try{$("html /deep/ paper-input /deep/ paper-input-decorator").removeAttr("isinvalid")}catch(y){j=y,$("html >>> paper-input-button >>> paper-input-decorator").removeAttr("isinvalid")}try{q=1707,e=new Date,r=e.getUTCFullYear()+1;try{n=$("html /deep/ #edit-gauthyear").val(),t=$("html /deep/ #edit-sauthyear").val()}catch(y){j=y,n=$("html >>> #edit-gauthyear").val(),t=$("html >>> #edit-sauthyear").val()}if(k="This must be a valid year between "+q+" and "+r,!(isNumber(n)&&n>q&&r>n)){l=!0;try{$("html /deep/ #edit-gauthyear /deep/ paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}catch(y){j=y,$("html >>> #edit-gauthyear >>> paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}}if(!(isNumber(t)&&t>q&&r>t)){l=!0;try{$("html /deep/ #edit-sauthyear /deep/ paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}catch(y){j=y,$("html >>> #edit-sauthyear >>> paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}}c=new Object,c[n]=t,d=JSON.stringify(c)}catch(y){j=y,console.log("Failed to parase the authority year"),d=""}u.authority_year=d;try{f=new Object;try{h=$("html /deep/ #edit-deprecated-scientific").val()}catch(y){j=y;try{h=$("html >>> #edit-deprecated-scientific").val()}catch(y){j=y,h=$("#edit-deprecated-scientific").val()}}g=h.split(","),$.each(g,function(a,b){var c;return c=b.split('":"'),f[c[0].replace(/"/g,"")]=c[1].replace(/"/g,"")}),i=JSON.stringify(f)}catch(y){j=y,console.log("Failed to parse the deprecated scientifics"),i=""}return u.deprecated_scientific=i,$.each(m,function(a,b){var c,d,e,f;console.log(a,b);try{if(e="html /deep/ #edit-"+b,isNull($(e)))throw"Invalid Selector"}catch(g){j=g,e="html >>> #edit-"+b}switch(c=b.replace(/-/g,"_"),f=$(e).val().trim(),"notes"!==c&&"taxon_credit"!==c&&"image"!==c&&(f=f.toLowerCase()),b){case"genus":case"species":case"subspecies":if(k="This required field must have only letters",d="genus"===b||"species"===b?isNull(f):!1,/[^A-Za-z]/m.test(f)||d){try{$("html /deep/ #edit-"+b+" /deep/ paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}catch(g){j=g,$("html >>> #edit-"+b+" >>> paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}l=!0}break;case"common-name":case"major-type":case"linnean-order":case"genus-authority":case"species-authority":if(k="This cannot be empty",isNull(f)){try{$("html /deep/ #edit-"+b+" /deep/ paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}catch(g){j=g,$("html >>> #edit-"+b+" >>> paper-input-decorator").attr("error",k).attr("isinvalid","isinvalid")}l=!0}}return u[c]=f}),l?(animateLoad(),stopLoadError("There was a problem with your entry. Please correct your entry and try again."),console.error("Bad characters in entry. Stopping ..."),!1):(u.id=d$("#taxon-id").val(),"save"!==a||isNumber(u.id)?(v=JSON.stringify(u),s=Base64.encodeURI(v),isNull(v)||isNull(s)?(animateLoad(),stopLoadError("The system was unable to parse this entry for the server. Please see the console for more details."),console.error("Unable to stringify the JSON!."),console.warn("The total save object so far is:",u),console.warn("Got the output string",saveSring),console.warn("Sending b64 string",s),!1):(o=$.cookie("ssarherps_auth"),w=$.cookie("ssarherps_secret"),p=$.cookie("ssarherps_link"),x="hash="+o+"&secret="+w+"&dblink="+p,b="perform="+a+"&"+x+"&data="+s,console.log("Going to save",u),console.log("Using mode '"+a+"'"),animateLoad(),$.post(adminParams.apiTarget,b,"json").done(function(a){if(a.status===!0){if(console.log("Server returned",a),l)return console.error("Warning! The item saved, even though it wasn't supposed to."),!1;try{$("html /deep/ #modal-taxon-edit")[0].close()}catch(c){j=c,$("html >>> #modal-taxon-edit")[0].close()}return isNull($("#admin-search").val())||renderAdminSearchResults(),!1}return stopLoadError(),toastStatusMessage(a.human_error),console.error(a.error),console.warn("Server returned",a),console.warn("We sent",""+uri.urlString+adminParams.apiTarget+"?"+b),!1}).fail(function(a,c){return stopLoadError("Failed to send the data to the server."),console.error("Server error! We sent",""+uri.urlString+adminParams.apiTarget+"?"+b),!1}))):(animateLoad(),stopLoadError("The system was unable to generate a valid taxon ID for this entry. Please see the console for more details."),console.error("Unable to get a valid, numeric taxon id! We got '"+u.id+"'."),console.warn("The total save object so far is:",u),!1))},deleteTaxon=function(a){var b,c,d,e,f;return c=$(".delete-taxon .delete-taxon-button[data-database-id='"+a+"']"),f=c.attr("data-taxon").replace(/\+/g," "),e=f.substr(0,1).toUpperCase()+f.substr(1),c.hasClass("extreme-danger")?null!=window.deleteWatchTimer?(d=Date.now()-window.deleteWatchTimer,console.warn("The taxon was asked to be deleted "+d+"ms after the confirmation was prompted. Rejecting ..."),!1):(animateLoad(),b="perform=delete&id="+a,$.post(adminParams.apiTarget,b,"json").done(function(b){return b.status===!0?(c.parents("tr").remove(),toastStatusMessage(""+e+" with ID "+a+" has been removed from the database."),stopLoad()):(stopLoadError(),toastStatusMessage(b.human_error),console.error(b.error),console.warn(b)),!1}).fail(function(a,b){return stopLoadError(),toastStatusMessage("Failed to communicate with the server."),!1})):(window.deleteWatchTimer=Date.now(),delay(300,function(){return delete window.deleteWatchTimer}),c.addClass("extreme-danger"),delay(7500,function(){return c.removeClass("extreme-danger")}),toastStatusMessage("Click again to confirm deletion of "+e),!1)},handleDragDropImage=function(){return foo()},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},$(function(){return $("#next").exists()?$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}):void 0}),root="undefined"!=typeof exports&&null!==exports?exports:this,uri=new Object,uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment"),window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,isBool=function(a){return a===!0||a===!1},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){}return!1},isJson=function(a){if("object"==typeof a)return!0;try{return JSON.parse(a),!0}catch(b){}return!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){return!isNumber(a)||isNull(a)?0:parseInt(a)},String.prototype.toBool=function(){return"true"===this.toString()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Number.prototype.toBool=function(){return 1===this},Object.size=function(a){var b,c;c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(a){var b,c,d,e,f,g;if(null==a&&(a=void 0),null==a){g=void 0;try{b=$(this).find("[valueattr]"),isNull(b)&&(b=$(this)),f=b.attr("valueattr"),g=$(this).find(".core-selected").attr(f)}catch(h){return c=h,!1}return("null"===g||null==g)&&(g=void 0),g}if(isBool(a)){if(console.log("setSelected "+a+" is boolean"),$(this).parent().children().removeAttribute("selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("core-selected"),$(this).prop("selected",a),$(this).prop("active",a),a===!0)return $(this).addClass("core-selected")}else try{return b=$(this).find("[valueattr]"),isNull(b)&&(b=$(this)),f=b.attr("valueattr"),e=$(this).find("["+f+"="+a+"]"),d=e.index(),e.parent().prop("selected",d)}catch(h){return c=h,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,("null"===b||null==b)&&(b=void 0),b)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(a){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),c=Math.random(),null==a&&(d=[0,a],a=d[0],b=d[1]),a>b&&(e=[b,a],a=e[0],b=e[1]),Math.floor(c*(b-a+1)+a)},window.debounce_timer=null,Function.prototype.debounce=function(){var a,b,c,d,e,f,g;if(f=arguments[0],d=arguments[1],g=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[],null==f&&(f=300),null==d&&(d=!1),null==g&&(g=window.debounce_timer),e=this,b=function(){return d||e.apply(e,a),console.log("Debounce applied")},null!=g)try{clearTimeout(g)}catch(h){c=h}else d&&(e.apply(obj,a),console.log("Executed immediately"));return window.debounce_timer=setTimeout(b,f)},mapNewWindows=function(a){return null==a&&(a=!0),$(".newwindow").each(function(){var b,c;return b=$(this).attr("href"),null==b&&(b=$(this).attr("data-href")),c=function(a){return null==a?!1:(window.open(a),!1)},$(this).click(function(d){return a&&(d.preventDefault(),d.stopPropagation()),c(b)}),$(this).keypress(function(){return c(b)})})},toastStatusMessage=function(a,b,c,d){var e;return null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#search-status"),isNumber(c)||(c=3e3),d.slice(0,1)===!1&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a),$(d).addClass(b),$(d)[0].show(),delay(c+500,function(){return $(d).empty(),$(d).removeClass(b),$(d).attr("text","")})},openLink=function(a){return null==a?!1:(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null==a?!1:(window.location.href=a,!1)},animateLoad=function(a){var b,c;null==a&&(a="loader"),isNumber(a)&&(a="loader"),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{return $(c).exists()?$(c).attr("active",!0):$("body").append('<paper-spinner id="'+a+'" active></paper-spinner'),!1}catch(d){return b=d,console.log("Could not animate loader",b.message)}},stopLoad=function(a,b){var c,d;null==a&&(a="loader"),null==b&&(b=1e3),"#"===a.slice(0,1)?(d=a,a=a.slice(1)):d="#"+a;try{if($(d).exists())return $(d).addClass("good"),delay(b,function(){return $(d).removeClass("good"),$(d).attr("active",!1)})}catch(e){return c=e,console.log("Could not stop load animation",c.message)}},stopLoadError=function(a,b,c){var d,e;null==b&&(b="loader"),null==c&&(c=7500),"#"===b.slice(0,1)?(e=b,b=b.slice(1)):e="#"+b;try{if($(e).exists())return $(e).addClass("bad"),null!=a&&toastStatusMessage(a,"",c),delay(c,function(){return $(e).removeClass("bad"),$(e).attr("active",!1)})}catch(f){return d=f,console.log("Could not stop load error animation",d.message)}},doCORSget=function(a,b,c,d){var e,f,g,h,i;null==c&&(c=void 0),null==d&&(d=void 0),e=function(){if("function"==typeof d)return d();throw new Error("There was an error performing the CORS request")},h={url:a,data:b,type:"get",crossDomain:!0};try{$.ajax(h).done(function(a){return"function"==typeof c?(c(),!1):console.log(response)}).fail(function(a,b){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(j){g=j,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(a=""+a+"?"+b,f=function(a,b){var c;return null==a&&(a="get"),c=new XMLHttpRequest,"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},i=f("get",a),!i)throw new Error("CORS not supported");return i.onload=function(){var a;return a=i.responseText,"function"==typeof c&&c(a),console.log(a),!1},i.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),e()},i.send(),!1},deepJQuery=function(a){var b;try{if(!$("html /deep/ "+a).exists())throw"Bad /deep/ selector";return $("html /deep/ "+a)}catch(c){b=c;try{if(!$("html >>> "+a).exists())throw"Bad >>> selector";return $("html >>> "+a)}catch(c){return b=c,$(a)}}},d$=function(a){return deepJQuery(a)},lightboxImages=function(a,b){var c,d;return null==a&&(a=".lightboximage"),null==b&&(b=!1),d={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},c=b?d$(a):$(a),c.click(function(a){try{return $(this).imageLightbox(d).startImageLightbox(),a.preventDefault(),a.stopPropagation(),console.warn("Event propagation was stopped when clicking on this.")}catch(b){return a=b,console.error("Unable to lightbox this image!")}}).each(function(){var b,c,d;console.log("Using selectors '"+a+"' / '"+this+"' for lightboximages");try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return d=$(this).removeClass("lightboximage").prop("outerHTML"),c=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+c+"' class='lightboximage'>"+d+"</a>")}catch(e){return b=e,console.log("Couldn't parse through the elements")}})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},getLocation=function(a){var b,c;return null==a&&(a=void 0),c=function(a,b){return window.locationData.lat=a.coords.latitude,window.locationData.lng=a.coords.longitude,window.locationData.acc=a.coords.accuracy,window.locationData.last=Date.now(),null!=b&&b(window.locationData),!1},b=function(a,b){var c;return c=function(){switch(a.code){case 0:return"There was an error while retrieving your location: "+a.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+a.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),null!=b&&b(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(c,b,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},bindClickTargets=function(){return $(".click").unbind().click(function(){
return openTab($(this).attr("data-url"))})},browserBeware=function(){var a,b,c;null==window.hasCheckedBrowser&&(window.hasCheckedBrowser=0);try{if(a=new WhichBrowser,a.isBrowser("Firefox")&&(c='<div id="firefox-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Warning!</strong> Firefox has buggy support for <a href="http://webcomponents.org/" class="alert-link">webcomponents</a> and the <a href="https://www.polymer-project.org" class="alert-link">Polymer project</a>. If you encounter bugs, try using Chrome (reccommended), Opera, Safari, Internet Explorer, or your phone instead &#8212; they\'ll all be faster, too.\n</div>',$("#title").after(c),$(".alert").alert(),console.warn("We've noticed you're using Firefox. Firefox has problems with this site, we recommend trying Google Chrome instead:","https://www.google.com/chrome/"),console.warn("Firefox took "+250*window.hasCheckedBrowser+"ms after page load to render this error message.")),a.isBrowser("Internet Explorer"))return $("#collapse-button").click(function(){return $(".collapse").collapse("toggle")})}catch(d){return b=d,100===window.hasCheckedBrowser?(console.warn("We can't check your browser! If you're using Firefox, beware of bugs!"),!1):delay(250,function(){return window.hasCheckedBrowser++,browserBeware()})}},$(function(){var a;bindClickTargets(),formatScientificNames();try{$('[data-toggle="tooltip"]').tooltip()}catch(b){a=b,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),adminParams.loadAdminUi===!0&&loadAdminUi()}catch(b){a=b,getLocation()}return browserBeware()}),searchParams=new Object,searchParams.targetApi="commonnames_api.php",searchParams.targetContainer="#result_container",searchParams.apiPath=uri.urlString+searchParams.targetApi,ssar=new Object,performSearch=function(a){var b,c,d,e;if(null==a&&(a=void 0),null==a){if(d=$("#search").val(),e=d,d=d.toLowerCase(),c=getFilters(),(isNull(d)||null==d)&&isNull(c))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;$("#search").blur(),d=d.replace(/\./g,""),d=prepURI(d),$("#loose").polymerChecked()&&(d=""+d+"&loose=true"),$("#fuzzy").polymerChecked()&&(d=""+d+"&fuzzy=true"),isNull(c)||(console.log("Got filters - "+c),d=""+d+"&filter="+c),b="q="+d}else a===!0?(b="q=",e="(all items)"):(b="q="+a,e=a.split("&")[0]),console.log("Searching on "+a);return"#"===d||isNull(d)&&isNull(b)||"q="===b&&a!==!0?!1:(animateLoad(),console.log("Got search value "+d+", hitting",""+searchParams.apiPath+"?"+b),$.get(searchParams.targetApi,b,"json").done(function(a){var b,c,d;return console.log("Search executed by "+a.method+" with "+a.count+" results."),0===toInt(a.count)?(a.status===!0?a.query_params.filter.had_filter===!0?(b="",c=0,$.each(a.query_params.filter.filter_params,function(d,e){return"BOOLEAN_TYPE"!==d?(0!==c&&(b=""+filter_text+" "+a.filter.filter_params.BOOLEAN_TYPE),b=""+b+" "+d.replace(/_/g," ")+" is "+e):void 0}),d='"'+e+'" where '+b+" returned no results."):d='"'+e+'" returned no results.':d=a.human_error,clearSearch(!0),$("#search-status").attr("text",d),$("#search-status")[0].show(),stopLoadError(),!1):a.status===!0?(formatSearchResults(a),!1):(clearSearch(!0),$("#search-status").attr("text",a.human_error),$("#search-status")[0].show(),console.error(a.error),console.warn(a),stopLoadError())}).fail(function(a,b){return console.error("There was an error performing the search"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't execute the search - "+b),$("#search-status")[0].show(),stopLoadError()}).always(function(){var a;return a=Base64.encodeURI(d),null!=d&&setHistory(""+uri.urlString+"#"+a),!1}))},getFilters=function(a,b){var c,d,e,f;if(null==a&&(a=".cndb-filter"),null==b&&(b="AND"),e=new Object,$(a).each(function(){var a,b;return a=$(this).attr("data-column"),null==a?!0:(b=$(this).polymerSelected(),"any"===b||"all"===b||"*"===b?!0:(isNull(b)||b===!1)&&(b=$(this).val(),isNull(b))?!0:e[a]=b.toLowerCase())}),0===Object.size(e))return console.log("Got back an empty filter list."),"";try{return e.BOOLEAN_TYPE=b,f=JSON.stringify(e),d=Base64.encodeURI(f),console.log("Returning "+d+" from",e),d}catch(g){return c=g,!1}},formatSearchResults=function(a,b){var c,d,e,f,g,h,i,j;return null==b&&(b=searchParams.targetContainer),e=a.result,searchParams.result=e,f=new Array,g="",i="<table id='cndb-result-list' class='table table-striped table-hover'>\n	<tr class='cndb-row-headers'>",h="</table>",j=toInt(a.count)-1,d=null,c=0,$.each(e,function(e,f){var k,l,m,n;return 0===toInt(e)&&(l=0,i+="\n<!-- Table Headers - "+Object.size(f)+" entries -->",$.each(f,function(a,b){var e,g,h;return h=a.replace(/_/g," "),"id"!==a&&"minor_type"!==a&&"notes"!==a&&"major_type"!==a&&"taxon_author"!==a&&"taxon_credit"!==a&&(e=$("#show-deprecated").polymerSelected()!==!0?"deprecated_scientific":"",a!==e&&(h=function(){switch(h){case"common name":return"english name";case"major subtype":return"english subtype";default:return h}}(),i+="\n		<th class='text-center'>"+h+"</th>",c++)),l++,l===Object.size(f)?(i+="\n	</tr>",i+="\n<!-- End Table Headers -->",console.log("Got "+c+" display columns."),g=roundNumber(12/c,0),d="col-md-"+g):void 0})),n=""+f.genus+"+"+f.species,isNull(f.subspecies)||(n=""+n+"+"+f.subspecies),k="\n	<tr id='cndb-row"+e+"' class='cndb-result-entry' data-taxon=\""+n+'">',m=0,$.each(f,function(a,b){var c,h,i,j,l,o,p,q;if("id"!==a&&"minor_type"!==a&&"notes"!==a&&"major_type"!==a&&"taxon_author"!==a&&"taxon_credit"!==a){if("authority_year"===a)try{try{h=JSON.parse(b)}catch(r){i=r,console.warn("There was an error parsing '"+b+"', attempting to fix - ",i.message),p=b.split(":"),q=p[1].slice(p[1].search('"')+1,-2),console.log("Examining "+q),q=q.replace(/"/g,"'"),p[1]='"'+q+'"}',b=p.join(":"),console.log("Reconstructed "+b),h=JSON.parse(b)}j=Object.keys(h)[0],o=h[j],b="G: "+j+"<br/>S: "+o}catch(r){i=r,console.error("There was an error parsing '"+b+"'",i.message),h=b}c=$("#show-deprecated").polymerSelected()!==!0?"deprecated_scientific":"",a!==c&&("image"===a&&(b=isNull(b)?"<paper-icon-button icon='launch' data-href='http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+n+"' class='newwindow calphoto click' data-taxon=\""+n+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+uri.urlString+b+"' class='lightboximage'></paper-icon-button>"),l="genus"!==a&&"species"!==a&&"subspecies"!==a?""+a+" text-center":a,k+="\n		<td id='"+a+"-"+e+"' class='"+l+" "+d+"'>"+b+"</td>")}return m++,m===Object.size(f)?(k+="\n	</tr>",g+=k):void 0}),toInt(e)===j?(g=i+g+h,console.log("Processed "+(toInt(e)+1)+" rows"),$(b).html(g),mapNewWindows(),lightboxImages(),modalTaxon(),$("#result-count").text(" - "+a.count+" entries"),stopLoad()):void 0})},parseTaxonYear=function(a,b){var c,d,e,f,g,h;null==b&&(b=!0);try{c=JSON.parse(a)}catch(i){d=i,console.warn("There was an error parsing '"+a+"', attempting to fix - ",d.message),g=a.split(":"),h=g[1].slice(g[1].search('"')+1,-2),console.log("Examining "+h),h=h.replace(/"/g,"'"),g[1]='"'+h+'"}',a=g.join(":"),console.log("Reconstructed "+a);try{c=JSON.parse(a)}catch(i){return d=i,b?!1:a}}return e=Object.keys(c)[0],f=c[e],h=new Object,h.genus=e,h.species=f,h},checkTaxonNear=function(a,b,c){var d,e,f,g,h,i;return null==a&&(a=void 0),null==b&&(b=void 0),null==c&&(c="#near-me-container"),null==a?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),g=(Date.now()-locationData.last)/1e3,g>900&&getLocation(),d="http://www.inaturalist.org/places.json",e="taxon="+a+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",h="",f="",i="",$.get(d,e,"json").done(function(a){return Object.size(a)>0?(h="communication:location-on",f="good-location",i="This species occurs in your county"):(h="communication:location-off",f="bad-location",i="This species does not occur in your county")}).fail(function(a,b){return f="bad-location",h="warning",i="We couldn't determine your location"}).always(function(){var a,d;d='<div class="tooltip fade top in right" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-location-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">'+i+"</div>\n</div>";try{$("html /deep/ "+c).html("<core-icon icon='"+h+"' class='small-icon "+f+" near-me' data-toggle='tooltip' id='near-me-icon'></core-icon>"),$("html /deep/ #near-me-container").after(d).mouseenter(function(){return $("html /deep/ #manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return $("html /deep/ #manual-location-tooltip").css("display","none"),!1})}catch(e){a=e,$("html >>> "+c).html("<core-icon icon='"+h+"' class='small-icon "+f+" near-me' data-toggle='tooltip' id='near-me-icon'></core-icon>"),$("html >>> #near-me-container").after(d).mouseenter(function(){return $("html >>> #manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return $("html >>> #manual-location-tooltip").css("display","none"),!1});try{$(c).html("<core-icon icon='"+h+"' class='small-icon "+f+"' data-toggle='tooltip' id='near-me-icon'></core-icon>"),$("#near-me-container").after(d).mouseenter(function(){return $("#manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return $("#manual-location-tooltip").css("display","none"),!1})}catch(e){a=e,console.warn("Fallback failed to draw contents on the <paper-action-dialog>")}}return null!=b?b():void 0}),!1)},deferCalPhotos=function(a){var b,c,d;return null==a&&(a=".calphoto"),b=$(a).length,c="http://calphotos.berkeley.edu/cgi-bin/img_query",d=0,$(a).each(function(){var a,e,f;return d++,f=$(this),e=f.attr("data-taxon"),a="getthumbinfo=1&num=all&cconly=1&taxon="+e+"&format=xml",$.get(c,a).done(function(a){var b,c,d,g,h,i;return h=xmlToJSON.parseString(a),b=h.xml.calphotos,i=b.thumb_url,d=b.enlarge_jpeg_url,g=b.enlarge_url,c="<a href='"+d+"' class='calphoto-img-anchor'><img src='"+i+"' data-href='"+g+"' class='calphoto-img-thumb' data-taxon='"+e+"'/></a>",f.replaceWith(c),!1}).fail(function(a,b){return!1}).always(function(){return d===b?lightboxImages(".calphoto-image-anchor"):void 0})}),!1},insertModalImage=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(null==a&&(a=ssar.taxonImage),null==b&&(b=ssar.activeTaxon),null==c&&(c=void 0),null==b)return console.error("Tried to insert a modal image, but no taxon was provided!"),!1;if("object"!=typeof b)return console.error("Invalid taxon data type (expecting object), got "+typeof b),q={taxon:b,imageUrl:a,defaultTaxon:ssar.activeTaxon,defaultImage:ssar.taxonImage},console.warn(q),!1;if(m=function(a,b,d,e,f){var g,h;null==f&&(f="calphoto"),h='<a href="'+b+'" class="'+f+'-img-anchor" style="float:right; margin-top:-1em;">\n  <img src="'+a+'"\n    data-href="'+d+'"\n    class="'+f+'-img-thumb"\n    data-taxon="'+e+'" />\n</a>',d$("#meta-taxon-info").before(h);try{lightboxImages("."+f+"-img-anchor",!0)}catch(i){g=i,console.error("Error lightboxing images")}return"function"==typeof c&&c(),!1},n=[b.genus,b.species],null!=b.subspecies&&n.push(b.subspecies),o=n.join("+"),null!=a)return k=a.split("."),h=k.pop(),l=k.join("."),p=""+uri.urlString+l+"-thumb."+h,j=""+uri.urlString+l+"."+h,m(p,j,j,o,"ssarimg"),!1;e="http://calphotos.berkeley.edu/cgi-bin/img_query",d="getthumbinfo=1&num=all&cconly=1&taxon="+o+"&format=xml",console.log("Looking at",""+e+"?"+d),f=function(a){var b,c,d,e,f;return e=xmlToJSON.parseString(a),b=e.xml.calphotos,null==b?(console.warn("CalPhotos didn't return any valid images for this search!"),!1):(f=b.thumb_url,null==f?(console.warn("CalPhotos didn't return any valid images for this search!"),!1):(c=b.enlarge_jpeg_url,d=b.enlarge_url,m(f,d,c,taxonSring),!1))},i=function(a,b){return console.log(a,b),console.error("Couldn't load an image to insert!"),!1};try{doCORSget(e,d,f,i)}catch(r){g=r,console.error(g.message)}return!1},modalTaxon=function(a){var b;return null==a&&(a=void 0),null==a?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(b="<paper-action-dialog backdrop layered closeSelector=\"[affirmative]\" id='modal-taxon'>\n  <div id='modal-taxon-content'></div>\n  <paper-button dismissive id='modal-inat-linkout'>iNaturalist</paper-button>\n  <paper-button dismissive id='modal-calphotos-linkout'>CalPhotos</paper-button>\n  <paper-button affirmative autofocus>Close</paper-button>\n</paper-action-dialog>",$("#result_container").after(b)),$.get(searchParams.targetApi,"q="+a,"json").done(function(c){var d,e,f,g,h,i,j,k,l,m,n,o;if(e=c.result[0],null==e)return toastStatusMessage("There was an error fetching the entry details. Please try again later."),stopLoadError(),!1;if(console.log("Got",e),n=parseTaxonYear(e.authority_year),o="",n!==!1&&(o="<div id='near-me-container' data-toggle='tooltip' data-placement='top' title='' class='near-me'></div><p><span class='genus'>"+e.genus+"</span>, <span class='genus_authority'>"+e.genus_authority+"</span> "+n.genus+"; <span class='species'>"+e.species+"</span>, <span class='species_authority'>"+e.species_authority+"</span> "+n.species+"</p>"),f="",!isNull(e.deprecated_scientific)){f="<p>Deprecated names:";try{l=JSON.parse(e.deprecated_scientific),i=0,$.each(l,function(a,b){return i++,1!==i&&(f+="; "),f+="<span class='sciname'>"+a+"</span>, "+b,i===Object.size(l)?f+="</p>":void 0})}catch(p){g=p,f="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}j="",isNull(e.minor_type)||(j=" <core-icon icon='arrow-forward'></core-icon> <span id='taxon-minor-type'>"+e.minor_type+"</span>"),isNull(e.notes)?(e.notes="Sorry, we have no notes on this taxon yet.",e.taxon_credit=""):isNull(e.taxon_credit)||"null"===e.taxon_credit?e.taxon_credit="This taxon information is uncredited.":e.taxon_credit="Taxon information by "+e.taxon_credit+".";try{k=markdown.toHTML(e.notes)}catch(p){g=p,k=e.notes,console.warn("Couldn't parse markdown!! "+g.message)}return d=isNull(e.major_common_type)?"":" (<span id='taxon-common-type'>"+e.major_common_type+"</span>) ",b="<div id='meta-taxon-info'>\n  "+o+"\n  <p>\n    English name: <span id='taxon-common-name' class='common_name'>"+e.common_name+"</span>\n  </p>\n  <p>\n    Type: <span id='taxon-type'>"+e.major_type+"</span>\n    "+d+"\n    <core-icon icon='arrow-forward'></core-icon>\n    <span id='taxon-subtype'>"+e.major_subtype+"</span>"+j+"\n  </p>\n  "+f+"\n</div>\n<h3>Taxon Notes</h3>\n<p id='taxon-notes'>"+k+'</p>\n<p class="text-right small text-muted">'+e.taxon_credit+"</p>",$("#modal-taxon-content").html(b),$("#modal-inat-linkout").unbind().click(function(){return openTab("http://www.inaturalist.org/taxa/search?q="+a)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab("http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+a)}),formatScientificNames(),h=a.charAt(0).toUpperCase()+a.slice(1),h=h.replace(/\+/g," "),$("#modal-taxon").attr("heading",h),m=a.split("+"),ssar.activeTaxon={genus:m[0],species:m[1],subspecies:m[2]},isNull(e.image)&&(e.image=void 0),ssar.taxonImage=e.image,insertModalImage(),checkTaxonNear(a,function(){return stopLoad(),$("#modal-taxon")[0].open()})}).fail(function(a,b){return stopLoadError()}),!1)},sortResults=function(a){var b;return b=searchParams.result},setHistory=function(a,b,c){return null==a&&(a="#"),null==b&&(b=null),null==c&&(c=null),history.pushState(b,c,a),uri.query=$.url(a).attr("fragment"),!1},clearSearch=function(a){var b;return null==a&&(a=!1),$("#result-count").text(""),b='<div class="bs-callout bs-callout-info center-block col-xs-12 col-sm-8 col-md-5"> Search for a common or scientific name above to begin. </div>',$("#result_container").html(b),a===!0?!1:(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean-order").polymerSelected("any"),!1)},$(function(){var a,b,c,d,e,f,g,h,i;if(console.log("Doing onloads ..."),animateLoad(),window.addEventListener("popstate",function(a){var b,c;uri.query=$.url().attr("fragment");try{b=Base64.decode(uri.query)}catch(d){a=d,b=""}return console.log("Popping state to "+b),performSearch(b),c=b.split("&")[0],$("#search").attr("value",c)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(a){return a.preventDefault(),performSearch()}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","unfold-less")}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","unfold-more")}),$("#search_form").keypress(function(a){return 13===a.which?performSearch():void 0}),$("#do-search").click(function(){return performSearch()}),$("#do-search-all").click(function(){return performSearch(!0)}),$("#linnean-order").on("core-select",function(){return isNull($("#search").val())?void 0:performSearch()}),isNull(uri.query))e="";else try{e=Base64.decode(uri.query),h=$.url(""+searchParams.apiPath+"?q="+e);try{f=h.param("loose").toBool()}catch(j){a=j,f=!1}try{d=h.param("fuzzy").toBool()}catch(j){a=j,d=!1}$("#loose").prop("checked",f),$("#fuzzy").prop("checked",d),i=e.split("&")[0],i=i.replace(/\+/g," ").trim(),$("#search").attr("value",i);try{b=h.param("filter"),c=JSON.parse(Base64.decode(b)),g=!1,$.each(c,function(a,b){var c;return a=a.replace(/_/g,"-"),c="#"+a+"-filter","type"!==a?($(c).attr("value",b),g=!0):$("#linnean-order").polymerSelected(b)}),g&&$("#collapse-advanced").collapse("show")}catch(j){a=j,b=!1}}catch(j){a=j,console.error("Bad argument "+uri.query+" => "+e+", looseState, fuzzyState",f,d,""+searchParams.apiPath+"?q="+e),console.warn(a.message),e=""}return isNull(e)||"#"===e?(stopLoad(),$("#search").attr("disabled",!1),$("#loose").prop("checked",!0)):(console.log("Doing initial search with '"+e+"', hitting",""+searchParams.apiPath+"?q="+e),$.get(searchParams.targetApi,"q="+e,"json").done(function(a){return a.status===!0&&a.count>0?(console.log("Got a valid result, formatting "+a.count+" results."),formatSearchResults(a),!1):(0===a.count&&(a.human_error='No results for "'+e.split("&")[0]+'"'),$("#search-status").attr("text",a.human_error),$("#search-status")[0].show(),console.error(a.error),console.warn(a),stopLoadError())}).fail(function(a,b){return console.error("There was an error loading the generic table"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't load table - "+b),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1}))});
//# sourceMappingURL=maps/c.map