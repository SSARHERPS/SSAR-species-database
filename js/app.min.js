function shuffle(e){for(var t,a,n=e.length;n;t=Math.floor(Math.random()*n),a=e[--n],e[n]=e[t],e[t]=a);return e}var _metaStatus,activityIndicatorOff,activityIndicatorOn,animateLoad,bindClickTargets,bindClicks,bindDismissalRemoval,bindPaperMenuButton,browserBeware,byteCount,checkFileVersion,checkTaxonNear,clearSearch,d$,deepJQuery,delay,doCORSget,doFontExceptions,downloadCSVList,downloadHTMLList,foo,formatAlien,formatScientificNames,formatSearchResults,getFilters,getLocation,getMaxZ,goTo,insertCORSWorkaround,insertModalImage,isBlank,isBool,isEmpty,isJson,isNull,isNumber,isNumeric,lightboxImages,loadJS,mapNewWindows,modalTaxon,openLink,openTab,overlayOff,overlayOn,parseTaxonYear,performSearch,prepURI,randomInt,roundNumber,safariDialogHelper,safariSearchArgHelper,searchParams,setHistory,setupServiceWorker,showBadSearchErrorMessage,showDownloadChooser,smartCalPhotosLink,smartReptileDatabaseLink,smartUpperCasing,sortResults,ssar,stopLoad,stopLoadError,toFloat,toInt,toObject,toastStatusMessage,uri,slice=[].slice,indexOf=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(uri=new Object).o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment"),_metaStatus=new Object,window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,isBool=function(e){return!0===e||!1===e},isEmpty=function(e){return!e||0===e.length},isBlank=function(e){return!e||/^\s*$/.test(e)},isNull=function(e){try{if((isEmpty(e)||isBlank(e)||null==e)&&!1!==e&&0!==e)return!0}catch(e){}return!1},isJson=function(e){if("object"==typeof e)return!0;try{return JSON.parse(e),!0}catch(e){}return!1},isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isNumeric=function(e){return isNumber(e)},toFloat=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseFloat(e)},toInt=function(e,t){return null==t&&(t=!1),!isNumber(e)||isNull(e)?t?NaN:0:parseInt(e)},toObject=function(e){var t,a,n;n=new Object;for(a in e)void 0!==(t=e[a])&&(n[a]=t);return n},String.prototype.toBool=function(){return"true"===this.toString()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Number.prototype.toBool=function(){return"1"===this.toString()},Object.size=function(e){var t,a;a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a},delay=function(e,t){return setTimeout(t,e)},roundNumber=function(e,t){var a;return null==t&&(t=0),a=Math.pow(10,t),Math.round(e*a)/a},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(e,t){var a,n,r;if(null==e&&(e=void 0),null==t&&(t="attrForSelected"),a=!0===t||$(this).attr(t),null==e){r=void 0;try{r=$(this).get(0).selected,isNumber(r)&&!isNull(a)&&(n=$(this).find("paper-item")[toInt(r)],r=!0!==a?$(n).attr(a):$(n).text())}catch(e){return e,!1}return"null"!==r&&null!=r||(r=void 0),r}if(isBool(e)){if($(this).parent().children().removeAttribute("aria-selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("iron-selected"),$(this).prop("selected",e),$(this).prop("active",e),$(this).prop("aria-selected",e),!0===e)return $(this).addClass("iron-selected")}else try{return $(this).get(0).select(e)}catch(e){return e,!1}},jQuery.fn.polymerChecked=function(e){var t;return null==e&&(e=void 0),null!=e?jQuery(this).prop("checked",e):("null"!==(t=jQuery(this)[0].checked)&&null!=t||(t=void 0),t)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(e){return encodeURI(e).split(/%..|./).length-1},randomInt=function(e,t){var a,n,r;return null==e&&(e=0),null==t&&(t=1),r=Math.random(),null==e&&(e=(a=[0,e])[0],t=a[1]),e>t&&(e=(n=[t,e])[0],t=n[1]),Math.floor(r*(t-e+1)+e)},window.debounce_timer=null,Function.prototype.debounce=function(){var e,t,a,n,r,o;if(r=arguments[0],a=arguments[1],o=arguments[2],e=4<=arguments.length?slice.call(arguments,3):[],null==r&&(r=300),null==a&&(a=!1),null==o&&(o=window.debounce_timer),n=this,t=function(){if(!a)return n.apply(n,e)},null!=o)try{clearTimeout(o)}catch(e){e}else a&&n.apply(obj,e);return window.debounce_timer=setTimeout(t,r)},loadJS=function(e,t,a){var n,r,o,i;if(null==t&&(t=new Object),null==a&&(a=!0),$("script[src='"+e+"']").exists()){if("function"==typeof t)try{t()}catch(e){n=e,console.error("Script is already loaded, but there was an error executing the callback function - "+n.message)}return!0}return(i=document.createElement("script")).setAttribute("src",e),i.setAttribute("async","async"),i.setAttribute("type","text/javascript"),i.src=e,i.async=!0,o=function(){var e;e=i.readyState;try{if(!t.done&&(!e||/loaded|complete/.test(e))&&(t.done=!0,"function"==typeof t))try{return t()}catch(e){return n=e,console.error("Postload callback error - "+n.message)}}catch(e){return n=e,console.error("Onload error - "+n.message)}},r=function(){console.warn("There may have been a problem loading "+e);try{if(!t.done&&(t.done=!0,"function"==typeof t&&a))try{return t()}catch(e){return n=e,console.error("Post error callback error - "+n.message)}}catch(e){return n=e,console.error("There was an error in the error handler! "+n.message)}},i.setAttribute("onload",o),i.setAttribute("onreadystate",o),i.setAttribute("onerror",r),i.onload=i.onreadystate=o,i.onerror=r,document.getElementsByTagName("head")[0].appendChild(i),!0},String.prototype.toTitleCase=function(){var e,t,a,n,r,o,i,s,l,c,d;for(s=this.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),o=0,e=(r=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"]).length;o<e;o++)a=r[o],n=new RegExp("\\s"+a+"\\s","g"),s=s.replace(n,function(e){return e.toLowerCase()});for(i=0,t=(d=["Id","Tv"]).length;i<t;i++)l=d[i],c=new RegExp("\\b"+l+"\\b","g"),s=s.replace(c,l.toUpperCase());return s},smartUpperCasing=function(e){var t,a,n,r,o,i,s,l,c,d,u;o=function(e){return e.replace(e,e.toUpperCase())},c=e.replace(/((?=((?!-)[\W\s\r\n]))\s[A-Za-z]|^[A-Za-z])/g,o),d=["a","an","and","at","but","by","for","in","nor","of","on","or","out","so","to","the","up","yet"];try{for(a=0,t=d.length;a<t;a++)i=(u=d[a]).toTitleCase(),r=u.toLowerCase(),n=new RegExp(" "+i+" ","g"),c=c.replace(n," "+r+" ")}catch(e){}try{c.match(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/m)&&(l=(s=c.replace(/([a-zA-Z]+ )*[a-zA-Z]+-([a-z]+)( [a-zA-Z]+)*/gm,"$2")).toTitleCase(),c=c.replace(s,l))}catch(e){}return c},mapNewWindows=function(e){return null==e&&(e=!0),$(".newwindow").each(function(){var t,a;return null==(t=$(this).attr("href"))&&(t=$(this).attr("data-href")),a=function(e){return null!=e&&(window.open(e),!1)},$(this).click(function(n){return e&&(n.preventDefault(),n.stopPropagation()),a(t)}),$(this).keypress(function(){return a(t)})})},toastStatusMessage=function(e,t,a,n){var r,o;return null==t&&(t=""),null==a&&(a=3e3),null==n&&(n="#search-status"),null==(null!=(o=window.metaTracker)?o.isToasting:void 0)&&null==window.metaTracker&&(window.metaTracker=new Object,window.metaTracker.isToasting=!1),window.metaTracker.isToasting?(delay(250,function(){return toastStatusMessage(e,t,a,n)}),!1):(window.metaTracker.isToasting=!0,isNumber(a)||(a=3e3),!1===n.slice(0,1)&&(n="#"+n),$(n).exists()||(r='<paper-toast id="'+n.slice(1)+'" duration="'+a+'"></paper-toast>',$(r).appendTo("body")),$(n).attr("text",e).text(e).addClass(t),$(n).get(0).show(),delay(a+500,function(){return $(n).empty(),$(n).removeClass(t),$(n).attr("text",""),window.metaTracker.isToasting=!1}))},openLink=function(e){return null!=e&&(window.open(e),!1)},openTab=function(e){return openLink(e)},goTo=function(e){return null!=e&&(window.location.href=e,!1)},null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(window._metaStatus=new Object),_metaStatus.isLoading=!1),animateLoad=function(e,t){var a,n;null==e&&(e="loader"),null==t&&(t=0),isNumber(e)&&(e="loader"),"#"===e.slice(0,1)?(n=e,e=e.slice(1)):n="#"+e,$(n).removeAttr("hidden"),null==(null!=_metaStatus?_metaStatus.isLoading:void 0)&&(null==_metaStatus&&(_metaStatus=new Object),_metaStatus.isLoading=!1);try{return _metaStatus.isLoading?t<100?(t++,delay(100,function(){return animateLoad(e,t)}),!1):(console.warn("Loader timed out waiting for load completion"),!1):($(n).exists()?$(n).attr("active",!0):$("body").append('<paper-spinner id="'+e+'" active></paper-spinner'),_metaStatus.isLoading=!0,!1)}catch(e){return a=e,console.warn("Could not animate loader",a.message)}},stopLoad=function(e,t,a){var n,r;null==e&&(e="loader"),null==t&&(t=1e3),null==a&&(a=0),"#"===e.slice(0,1)?(r=e,e=e.slice(1)):r="#"+e;try{return _metaStatus.isLoading?($(r).exists()&&($(r).addClass("good"),function(){return delay(t,function(){return $(r).removeClass("good").attr("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(r).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(r).remove(),_metaStatus.isLoading=!1):($(r).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(r).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):a<100&&(a++,delay(100,function(){return stopLoad(e,t,a)}),!1)}catch(e){return n=e,console.warn("Could not stop load animation",n.message)}},stopLoadError=function(e,t,a,n){var r,o;null==t&&(t="loader"),null==a&&(a=7500),"#"===t.slice(0,1)?(o=t,t=t.slice(1)):o="#"+t;try{return _metaStatus.isLoading?($(o).exists()&&($(o).addClass("bad"),null!=e&&toastStatusMessage(e,"",a),function(){return delay(a,function(){return $(o).removeClass("bad").prop("active",!1).removeAttr("active"),delay(1,function(){var e,t;return $(o).prop("hidden",!0),null!=("undefined"!=typeof Browsers&&null!==Browsers?Browsers.browser:void 0)?(e=["Spartan","Project Spartan","Edge","Microsoft Edge","MS Edge"],t=Browsers.browser.browser.name,indexOf.call(e,t)>=0||"EdgeHTML"===Browsers.browser.engine.name?($(o).remove(),_metaStatus.isLoading=!1):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))):($(o).removeAttr("hidden"),delay(50,function(){return _metaStatus.isLoading=!1}))})})}()),!1):n<100&&(n++,delay(100,function(){return stopLoadError(e,t,a,n)}),!1)}catch(e){return r=e,console.warn("Could not stop load error animation",r.message)}},doCORSget=function(e,t,a,n){var r,o,i,s;null==a&&(a=void 0),null==n&&(n=void 0),r=function(){if("function"==typeof n)return n();throw new Error("There was an error performing the CORS request")},i={url:e,data:t,type:"get",crossDomain:!0};try{$.ajax(i).done(function(e){if("function"==typeof a)return a(),!1}).fail(function(e,t){return console.warn("Couldn't perform jQuery AJAX CORS. Attempting manually.")})}catch(e){e,console.warn("There was an error using jQuery to perform the CORS request. Attemping manually.")}if(e=e+"?"+t,o=function(e,t){var a;return null==e&&(e="get"),"withCredentials"in(a=new XMLHttpRequest)?a.open(e,t,!0):"undefined"!=typeof XDomainRequest?(a=new XDomainRequest).open(e,t):a=null,a},!(s=o("get",e)))throw new Error("CORS not supported");return s.onload=function(){var e;return e=s.responseText,"function"==typeof a&&a(e),!1},s.onerror=function(){return console.warn("Couldn't do manual XMLHttp CORS request"),r()},s.send(),!1},deepJQuery=function(e){try{if(!$("html /deep/ "+e).exists())throw"Bad /deep/ selector";return $("html /deep/ "+e)}catch(t){t;try{if(!$("html >>> "+e).exists())throw"Bad >>> selector";return $("html >>> "+e)}catch(t){return t,$(e)}}},d$=function(e){return deepJQuery(e)},lightboxImages=function(e,t){var a;return null==e&&(e=".lightboximage"),null==t&&(t=!1),a={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif|bmp|webp",quitOnDocClick:!0,quitOnImgClick:!0},(t?d$(e):$(e)).click(function(e){try{return $(this).imageLightbox(a).startImageLightbox(),e.preventDefault(),e.stopPropagation(),console.warn("Event propagation was stopped when clicking on this.")}catch(t){return e=t,console.error("Unable to lightbox this image!")}}).each(function(){var e,t;try{if("img"===$(this).prop("tagName").toLowerCase()&&"a"!==$(this).parent().prop("tagName").toLowerCase())return t=$(this).removeClass("lightboximage").prop("outerHTML"),e=function(){switch(!1){case!!isNull($(this).attr("data-layzr-retina")):return $(this).attr("data-layzr-retina");case!!isNull($(this).attr("data-layzr")):return $(this).attr("data-layzr");default:return $(this).attr("src")}}.call(this),$(this).replaceWith("<a href='"+e+"' class='lightboximage'>"+t+"</a>")}catch(e){return e,console.warn("Couldn't parse through the elements")}})},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove(),$("#imagelightbox-overlay").click(function(){return $("#imagelightbox").click()})},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(e){return null==e&&(e=".sciname"),$(".sciname").each(function(){var e;return e="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",e)})},prepURI=function(e){return(e=encodeURIComponent(e)).replace(/%20/g,"+")},getLocation=function(e){var t,a;return null==e&&(e=void 0),a=function(e,t){return window.locationData.lat=e.coords.latitude,window.locationData.lng=e.coords.longitude,window.locationData.acc=e.coords.accuracy,window.locationData.last=Date.now(),null!=t&&t(window.locationData),!1},t=function(e,t){var a;return a=function(){switch(e.code){case 0:return"There was an error while retrieving your location: "+e.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+e.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(a),null!=t&&t(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(a,t,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=e?e(!1):void 0)},bindClickTargets=function(){return bindClicks(),!1},bindClicks=function(e){return null==e&&(e=".click"),$(e).each(function(){var e,t,a;try{if(a=$(this).attr("data-href"),isNull(a)&&null!=(a=$(this).attr("data-url"))&&$(this).attr("data-newtab","true"),!isNull(a)){$(this).unbind();try{a===uri.o.attr("path")&&"paper-tab"===$(this).prop("tagName").toLowerCase()&&$(this).parent().prop("selected",$(this).index())}catch(e){t=e,console.warn("tagname lower case error")}return $(this).click(function(){var e,t,n;return a=$(this).attr("data-href"),isNull(a)&&(a=$(this).attr("data-url")),(null!=(e=$(this).attr("newTab"))?e.toBool():void 0)||(null!=(t=$(this).attr("newtab"))?t.toBool():void 0)||(null!=(n=$(this).attr("data-newtab"))?n.toBool():void 0)?openTab(a):goTo(a)}),a}if(null!=(e=$(this).attr("data-function")))return $(this).unbind(),$(this).click(function(){try{return window[e]()}catch(a){return t=a,console.error("'"+e+"()' is a bad function - "+t.message)}})}catch(e){return t=e,console.error("There was a problem binding to #"+$(this).attr("id")+" - "+t.message)}}),!1},getMaxZ=function(){var e;return e=function(){return $.map($("body *"),function(e,t){if("static"!==$(e).css("position"))return parseInt($(e).css("z-index")||1)})},Math.max.apply(null,e())},browserBeware=function(){var e,t;null==("undefined"!=typeof Browsers&&null!==Browsers?Browsers.hasCheckedBrowser:void 0)&&("undefined"!=typeof Browsers&&null!==Browsers||(window.Browsers=new Object),Browsers.hasCheckedBrowser=0);try{if(e=new WhichBrowser,Browsers.browser=e,e.isBrowser("Firefox")&&(t='<div id="firefox-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Warning!</strong> Firefox has buggy support for <a href="http://webcomponents.org/" class="alert-link">webcomponents</a> and the <a href="https://www.polymer-project.org" class="alert-link">Polymer project</a>. If you encounter bugs, try using <a href="https://www.google.com/chrome/" class="alert-link">Chrome</a> (recommended), <a href="www.opera.com/computer" class="alert-link">Opera</a>, Safari, <a href="https://www.microsoft.com/en-us/windows/microsoft-edge" class="alert-link">Edge</a>, or your phone instead &#8212; they\'ll all be faster, too.\n</div>',$("#title").after(t),$(".alert").alert(),console.warn("We've noticed you're using Firefox. Firefox has problems with this site, we recommend trying Google Chrome instead:","https://www.google.com/chrome/"),console.warn("Firefox took "+250*Browsers.hasCheckedBrowser+"ms after page load to render this error message.")),e.isBrowser("Internet Explorer")||e.isBrowser("Safari"))return $("#collapse-button").click(function(){return $(".collapse").collapse("toggle")})}catch(e){return e,100===Browsers.hasCheckedBrowser?(console.warn("We can't check your browser!"),console.warn("Known issues:"),console.warn("Firefox: Some VERY buggy behaviour"),console.warn("IE & Safari: The advanced options may not open"),!1):delay(250,function(){return Browsers.hasCheckedBrowser++,browserBeware()})}},checkFileVersion=function(e){var t;return null==e&&(e=!1),t=function(){return $.get(uri.urlString+"meta.php","do=get_last_mod","json").done(function(t){var a;return e&&console.log("Forced version check:",t),!!isNumber(t.last_mod)&&(null==ssar.lastMod&&(ssar.lastMod=t.last_mod),t.last_mod>ssar.lastMod?(a='<div id="outdated-warning" class="alert alert-warning alert-dismissible fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>We have page updates!</strong> This page has been updated since you last refreshed. <a class="alert-link" id="refresh-page" style="cursor:pointer">Click here to refresh now</a> and get bugfixes and updates.\n</div>',$("#outdated-warning").exists()||($("body").append(a),$("#refresh-page").click(function(){return document.location.reload(!0)})),console.warn("Your current version is out of date! Please refresh the page.")):e?console.info("Your version is up to date: have "+ssar.lastMod+", got "+t.last_mod):void 0)}).fail(function(){return console.warn("Couldn't check file version!!")}).always(function(){return delay(3e5,function(){return t()})})},!(!e&&null!=ssar.lastMod)&&(t(),!0)},window.checkFileVersion=checkFileVersion,setupServiceWorker=function(){return"serviceworker"in navigator&&navigator.serviceWorker.register("js/serviceWorker.min.js").then(function(e){return console.log("ServiceWorker registered with scope",e.scope)}).catch(function(e){return console.warn("ServiceWorker registration failed:",e)}),!1},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},$(function(){formatScientificNames(),bindClicks(),mapNewWindows();try{$("body").tooltip({selector:"[data-toggle='tooltip']"})}catch(e){e,console.warn("Tooltips were attempted to be set up, but do not exist")}try{checkAdmin(),!0===(void 0!==adminParams&&null!==adminParams?adminParams.loadAdminUi:void 0)&&loadJS("js/admin.min.js",function(){return loadAdminUi()})}catch(e){e,getLocation(),loadJS("js/jquery.cookie.min.js",function(){var e;return null!=$.cookie("ssarherps_user")&&(e='<paper-icon-button icon="create" class="click" data-href="'+uri.urlString+'admin/" data-toggle="tooltip" title="Go to administration" id="goto-admin"></paper-icon-button>',$("#bug-footer").append(e),bindClicks("#goto-admin")),!1})}return browserBeware(),checkFileVersion()}),(searchParams=new Object).targetApi="commonnames_api.php",searchParams.targetContainer="#result_container",searchParams.apiPath=uri.urlString+searchParams.targetApi,(ssar=new Object).affiliateQueryUrl={amphibiaWeb:"http://amphibiaweb.org/cgi/amphib_query",reptileDatabase:"http://reptile-database.reptarium.cz/species",calPhotos:"http://calphotos.berkeley.edu/cgi/img_query",iNaturalist:"https://www.inaturalist.org/taxa/search"},performSearch=function(e){var t,a,n;if(null==e&&(e=void 0),null==e){if(n=$("#search").val(),n,n=n.toLowerCase(),a=getFilters(),(isNull(n)||null==n)&&isNull(a))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;$("#search").blur(),n=n.replace(/\./g,""),n=prepURI(n),$("#loose").polymerChecked()&&(n+="&loose=true"),$("#fuzzy").polymerChecked()&&(n+="&fuzzy=true"),isNull(a)||(n=n+"&filter="+a),t="q="+n}else!0===e?(t="q=","(all items)"):(t="q="+e,e.split("&")[0]);return!("#"===n||isNull(n)&&isNull(t)||"q="===t&&!0!==e)&&(animateLoad(),$.get(searchParams.targetApi,t,"json").done(function(e){return 0===toInt(e.count)?(showBadSearchErrorMessage(e),clearSearch(!0),!1):!0===e.status?(formatSearchResults(e),!1):(clearSearch(!0),$("#search-status").attr("text",e.human_error),$("#search-status")[0].show(),console.error(e.error),console.warn(e),stopLoadError())}).fail(function(e,t){return console.error("There was an error performing the search"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){var e;return e=Base64.encodeURI(n),null!=n&&setHistory(uri.urlString+"#"+e),!1}))},getFilters=function(e,t){var a,n,r;if(null==e&&(e=".cndb-filter"),null==t&&(t="AND"),n=new Object,$(e).each(function(){var e,t;return null==(e=$(this).attr("data-column"))||("any"===(t=$(this).polymerSelected())||"all"===t||"*"===t||!(!isNull(t)&&!1!==t||(t=$(this).val(),!isNull(t)))||(n[e]=t.toLowerCase()))}),"both"!==(a=$("#alien-filter").get(0).selected)&&(n.is_alien="alien-only"===a?1:0),0===Object.size(n))return"";try{return n.BOOLEAN_TYPE=t,r=JSON.stringify(n),Base64.encodeURI(r)}catch(e){return e,!1}},formatSearchResults=function(e,t){var a,n,r,o,i,s,l,c,d,u,p,h,m,f,g,b,y,w,x,v,k,_,S,T,C,L;null==t&&(t=searchParams.targetContainer),i=e.result,searchParams.result=i,new Array,u="",p="<table id='cndb-result-list' class='table table-striped table-hover col-md-12'>\n\t<tr class='cndb-row-headers'>",T=toInt(e.count)-1,r=null,a=0,s=["id","minor_type","notes","major_type","taxon_author","taxon_credit","image_license","image_credit","taxon_credit_date","parens_auth_genus","parens_auth_species","is_alien"],c=0,v=delay(5e3,function(){return stopLoadError("There was a problem parsing the search results."),console.error("Couldn't finish parsing the results! Expecting "+T+" elements, timed out on "+c+"."),console.warn(i),!1});for(m in i){if(k=i[m],c=m,0===toInt(m)){f=0,p+="\n\x3c!-- Table Headers - "+Object.size(k)+" entries --\x3e";for(g in k)k[g],w=g.replace(/_/g," "),indexOf.call(s,g)<0&&g!==(!0!==$("#show-deprecated").polymerSelected()?"deprecated_scientific":"")&&(p+="\n\t\t<th class='text-center'>"+(w=function(){switch(w){case"common name":return"english name";case"major subtype":return"english genus name";default:return w}}())+"</th>",a++),++f===Object.size(k)&&(p+="\n\t</tr>",p+="\n\x3c!-- End Table Headers --\x3e",r="col-md-"+roundNumber(12/a,0))}C=k.genus+"+"+k.species,isNull(k.subspecies)||(C=C+"+"+k.subspecies),h="\n\t<tr id='cndb-row"+m+"' class='cndb-result-entry' data-taxon=\""+C+'">',y=0;for(g in k){if(n=k[g],indexOf.call(s,g)<0){if("authority_year"===g)try{try{o=JSON.parse(n)}catch(e){l=e,console.warn("There was an error parsing '"+n+"', attempting to fix - ",l.message),S=n.split(":"),L=S[1].slice(S[1].search('"')+1,-2),L=L.replace(/"/g,"'"),S[1]='"'+L+'"}',n=S.join(":"),o=JSON.parse(n)}d=Object.keys(o)[0],_=o[d],toInt(k.parens_auth_genus).toBool()&&(d="("+d+")"),toInt(k.parens_auth_species).toBool()&&(_="("+_+")"),n="G: "+d+"<br/>S: "+_}catch(e){l=e,console.error("There was an error parsing '"+n+"'",l.message),o=n}g!==(!0!==$("#show-deprecated").polymerSelected()?"deprecated_scientific":"")&&("image"===g&&(n=isNull(n)?"<paper-icon-button icon='launch' data-href='"+ssar.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+C+"' class='newwindow calphoto click' data-taxon=\""+C+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+uri.urlString+n+"' class='lightboximage'></paper-icon-button>"),b="genus"!==g&&"species"!==g&&"subspecies"!==g?g+" text-center":g,"genus_authority"!==g&&"species_authority"!==g||(b+=" authority"),"common_name"===g&&(n=smartUpperCasing(n),b+=" no-cap"),h+="\n\t\t<td id='"+g+"-"+m+"' class='"+b+" "+r+"'>"+n+"</td>")}++y===Object.size(k)&&(u+=h+="\n\t</tr>")}toInt(m)===T&&(u=p+u+"</table>",$(t).html(u),clearTimeout(v),mapNewWindows(),lightboxImages(),modalTaxon(),doFontExceptions(),$("#result-count").text(" - "+e.count+" entries"),stopLoad())}return"space_common_fallback"!==e.method||$("#space-fallback-info").exists()?$("#space-fallback-info").exists()?$("#space-fallback-info").prop("hidden",!0):void 0:(x='<div id="space-fallback-info" class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Don\'t see what you want?</strong> We might use a slightly different name. Try <a href="" class="alert-link" id="do-instant-fuzzy">checking the "fuzzy" toggle and searching again</a>, or use a shorter search term.\n</div>',$("#result_container").before(x),$("#do-instant-fuzzy").click(function(e){return e.preventDefault(),function(){return $("#fuzzy").get(0).checked=!0,performSearch()}.debounce()}))},parseTaxonYear=function(e,t){var a,n,r,o,i,s;null==t&&(t=!0);try{a=JSON.parse(e)}catch(r){n=r,console.warn("There was an error parsing '"+e+"', attempting to fix - ",n.message),i=e.split(":"),s=i[1].slice(i[1].search('"')+1,-2),s=s.replace(/"/g,"'"),i[1]='"'+s+'"}',e=i.join(":");try{a=JSON.parse(e)}catch(a){return n=a,!t&&e}}return r=Object.keys(a)[0],o=a[r],s=new Object,s.genus=r,s.species=o,s},formatAlien=function(e,t){var a,n,r;if(null==t&&(t="#is-alien-container"),"boolean"==typeof e)n=e;else{if("object"!=typeof e)throw Error("Invalid data given to formatAlien()");n=toInt(e.is_alien).toBool()}return n?(a='<iron-icon icon="maps:flight" class="small-icon alien-speices" id="modal-alien-species" data-toggle="tooltip"></iron-icon>',d$(t).html(a),"This species is not native",r='<div class="tooltip fade top in right manual-placement-tooltip" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-alien-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">This species is not native</div>\n</div>',d$(t).after(r).mouseenter(function(){return d$("#manual-alien-tooltip").css("display","block"),!1}).mouseleave(function(){return d$("#manual-alien-tooltip").css("display","none"),!1}),d$("#manual-location-tooltip").css("left","6em"),!1):(d$(t).css("display","none"),!1)},checkTaxonNear=function(e,t,a){var n,r,o,i,s;return null==e&&(e=void 0),null==t&&(t=void 0),null==a&&(a="#near-me-container"),null==e?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),(Date.now()-locationData.last)/1e3>900&&getLocation(),n="https://www.inaturalist.org/places.json",r="taxon="+e+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",i="",o="",s="",$.get(n,r,"json").done(function(e){return Object.size(e)>0?(i="communication:location-on",o="good-location",s="This species occurs in your county"):(i="communication:location-off",o="bad-location",s="This species does not occur in your county")}).fail(function(e,t){return o="bad-location",i="warning",s="We couldn't determine your location"}).always(function(){var e;if(e='<div class="tooltip fade top in right manual-placement-tooltip" role="tooltip" style="top: 6.5em; left: 4em; right:initial; display:none" id="manual-location-tooltip">\n  <div class="tooltip-arrow" style="top:50%;left:5px"></div>\n  <div class="tooltip-inner">'+s+"</div>\n</div>",d$(a).html("<iron-icon icon='"+i+"' class='small-icon "+o+" near-me' data-toggle='tooltip' id='near-me-icon'></iron-icon>"),$(a).after(e).mouseenter(function(){return d$("#manual-location-tooltip").css("display","block"),!1}).mouseleave(function(){return d$("#manual-location-tooltip").css("display","none"),!1}),null!=t)return t()}),!1)},insertModalImage=function(e,t,a){var n,r,o,i,s,l,c,d,u,p,h,m;if(null==e&&(e=ssar.taxonImage),null==t&&(t=ssar.activeTaxon),null==a&&(a=void 0),null==t)return console.error("Tried to insert a modal image, but no taxon was provided!"),!1;if("object"!=typeof t)return console.error("Invalid taxon data type (expecting object), got "+typeof t),m={taxon:t,imageUrl:l,defaultTaxon:ssar.activeTaxon,defaultImage:ssar.taxonImage},console.warn(m),!1;if(u=function(e,t,n){var r,o,i,s,l,c;null==n&&(n="calphoto"),c=e.thumbUri,i=e.imageUri,s="function"==typeof e.imageLinkUri?e.imageLinkUri(e.imageUri):void 0,o=e.imageLicense,r='<div class="modal-img-container">\n  <a href="'+i+'" class="'+n+'-img-anchor center-block text-center">\n    <img src="'+c+'"\n      data-href="'+s+'"\n      class="'+n+'-img-thumb"\n      data-taxon="'+t+'" />\n  </a>\n  <p class="small text-muted text-center">\n    Image by '+e.imageCredit+" under "+o+"\n  </p>\n</div>",d$("#meta-taxon-info").before(r),(l=function(e){try{return d$("#modal-taxon").get(0).fit(),delay(250,function(){return d$("#modal-taxon").get(0).fit(),delay(750,function(){return d$("#modal-taxon").get(0).fit()})})}catch(t){return t,e<10?(e++,delay(100,function(){return l(e)})):console.warn("Couldn't execute fit!")}})(0);try{lightboxImages("."+n+"-img-anchor",!0)}catch(e){e,console.error("Error lightboxing images")}return"function"==typeof a&&a(),!1},p=[t.genus,t.species],null!=t.subspecies&&p.push(t.subspecies),h=p.join("+"),null!=e.imageUri)return"string"==typeof e&&(l=e,(e=new Object).imageUri=l),c=e.imageUri.split("."),i=c.pop(),d=c.join("."),e.thumbUri=""+uri.urlString+d+"-thumb."+i,e.imageUri=""+uri.urlString+d+"."+i,u(e,h,"ssarimg"),!1;n="getthumbinfo=1&num=all&cconly=1&taxon="+h+"&format=xml",r=function(t){var a,r;r=xmlToJSON.parseString(t),window.testData=r;try{a=r.calphotos[0]}catch(e){e,a=void 0}if(null==a)return!1;e=new Object;try{if(e.thumbUri=a.thumb_url[0]._text,null==e.thumbUri)return console.warn("CalPhotos didn't return any valid images for this search!"),!1;e.imageUri=a.enlarge_jpeg_url[0]._text,e.imageLinkUri=a.enlarge_url[0]._text,e.imageLicense=a.license[0]._text,e.imageCredit=a.copyright[0]._text+" (via CalPhotos)"}catch(e){return e,console.warn("CalPhotos didn't return any valid images for this search!",ssar.affiliateQueryUrl.calPhotos+"?"+n),!1}return u(e,h),!1},s=function(e,t){return insertCORSWorkaround(),console.error("Couldn't load a CalPhotos image to insert!"),!1};try{doCORSget(ssar.affiliateQueryUrl.calPhotos,n,r,s)}catch(e){o=e,console.error(o.message)}return!1},smartReptileDatabaseLink=function(){var e,t,a,n,r,o;return o="http://reptile-database.reptarium.cz/interfaces/services/check-taxon",a=ssar.activeTaxon,n=[a.genus,a.species],null!=a.subspecies&&n.push(a.subspecies),r=n.join("+"),t=n.join(" "),t=t.slice(0,1).toUpperCase()+t.slice(1),e="taxon="+r,$.get(o,e,"json").done(function(e){var a,n,r,o,i,s;return"VALID"===e.response?(console.info("_"+t+"_ is the consensus taxon with Reptile Database"),!0):"SYNONYM"===e.response?(a=e.VALID[0],a.toLowerCase().replace(/\s/gm,"+"),n=a.split(/\s/),i={genus:n[0],species:n[1]},o="Reptile Database",r="<paper-button id='modal-alt-linkout' class=\"hidden-xs\">"+o+"</paper-button>",null!=(s=ssar.affiliateQueryUrl.reptileDatabase+"?genus="+i.genus+"&species="+i.species)&&($("#modal-alt-linkout").replaceWith(r),$("#modal-alt-linkout").click(function(){return openTab(s)})),console.info("Reptile Database uses recognizes _"+t+"_ as _"+a+"_"),smartCalPhotosLink(i)):(d$("#modal-alt-linkout").remove(),console.warn("Reptile Database couldn't find this taxon at all!"))}).fail(function(){return console.warn("Unable to check the taxon on Reptile Database!"),!1}),!1},smartCalPhotosLink=function(e){var t,a,n;return t={genus:e.genus,species:e.species,subspecies:ssar.activeTaxon.species},n=[t.genus,t.species],null!=t.subspecies&&n.push(t.subspecies),d$(".modal-img-container").exists()?(console.info("CalPhotos agrees with SSAR"),!0):(a=function(){var e;return e=n.join(" "),e=e.slice(0,1).toUpperCase()+e.slice(1),console.info("CalPhotos agrees with Reptile Database, so we're linking to _"+e+"_ for CalPhotos"),$("#modal-calphotos-linkout").unbind().click(function(){return openTab(ssar.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+n.join("+"))}),!1},insertModalImage(ssar.taxonImage,t,a),!1)},modalTaxon=function(e){var t;return null==e&&(e=void 0),null==e?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(t='<paper-dialog modal id=\'modal-taxon\' entry-animation="scale-up-animation" exit-animation="scale-down-animation">\n  <h2 id="modal-heading"></h2>\n  <paper-dialog-scrollable id=\'modal-taxon-content\'></paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button id=\'modal-inat-linkout\'>iNaturalist</paper-button>\n    <paper-button id=\'modal-calphotos-linkout\' class="hidden-xs">CalPhotos</paper-button>\n    <paper-button id=\'modal-alt-linkout\' class="hidden-xs"></paper-button>\n    <paper-button dialog-dismiss autofocus>Close</paper-button>\n  </div>\n</paper-dialog>',$("body").append(t)),$.get(searchParams.targetApi,"q="+e,"json").done(function(a){var n,r,o,i,s,l,c,d,u,p,h,m,f,g,b,y,w,x;if(null==(o=a.result[0]))return toastStatusMessage("There was an error fetching the entry details. Please try again later."),stopLoadError(),!1;if(w=parseTaxonYear(o.authority_year),x="",!1!==w&&(l="<span class='genus_authority authority'>"+o.genus_authority+"</span> "+w.genus,g="<span class='species_authority authority'>"+o.species_authority+"</span> "+w.species,toInt(o.parens_auth_genus).toBool()&&(l="("+l+")"),toInt(o.parens_auth_species).toBool()&&(g="("+g+")"),x="<div id=\"is-alien-container\" class=\"tooltip-container\"></div>\n<div id='near-me-container' data-toggle='tooltip' data-placement='top' title='' class='near-me tooltip-container'></div>\n<p>\n  <span class='genus'>"+o.genus+"</span>,\n  "+l+";\n  <span class='species'>"+o.species+"</span>,\n  "+g+"\n</p>"),i="",!isNull(o.deprecated_scientific)){i="<p>Deprecated names: ";try{f=JSON.parse(o.deprecated_scientific),d=0,$.each(f,function(e,t){if(1!==++d&&(i+="; "),i+="<span class='sciname'>"+e+"</span>, "+t,d===Object.size(f))return i+="</p>"})}catch(e){s=e,i="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}u="",isNull(o.minor_type)||(u=" <iron-icon icon='arrow-forward'></iron-icon> <span id='taxon-minor-type'>"+o.minor_type+"</span>"),isNull(o.notes)?(o.notes="Sorry, we have no notes on this taxon yet.",o.taxon_credit=""):isNull(o.taxon_credit)||"null"===o.taxon_credit?o.taxon_credit="This taxon information is uncredited.":(y=isNull(o.taxon_credit_date)||"null"===o.taxon_credit_date?"":" ("+o.taxon_credit_date+")",o.taxon_credit="Taxon information by "+o.taxon_credit+"."+y);try{p=markdown.toHTML(o.notes)}catch(e){s=e,p=o.notes,console.warn("Couldn't parse markdown!! "+s.message)}p=p.replace(/\&amp;(([a-z]+|[0-9]+);)/gm,"&$1"),r=isNull(o.major_common_type)?"":" (<span id='taxon-common-type'>"+o.major_common_type+"</span>) ",t="<div id='meta-taxon-info'>\n  "+x+"\n  <p>\n    English name: <span id='taxon-common-name' class='common_name no-cap'>"+smartUpperCasing(o.common_name)+"</span>\n  </p>\n  <p>\n    Type: <span id='taxon-type' class=\"major_type\">"+o.major_type+"</span>\n    "+r+"\n    <iron-icon icon='arrow-forward'></iron-icon>\n    <span id='taxon-subtype' class=\"major_subtype\">"+o.major_subtype+"</span>"+u+"\n  </p>\n  "+i+"\n</div>\n<h3>Taxon Notes</h3>\n<p id='taxon-notes'>"+p+'</p>\n<p class="text-right small text-muted">'+o.taxon_credit+"</p>",$("#modal-taxon-content").html(t),$("#modal-inat-linkout").unbind().click(function(){return openTab(ssar.affiliateQueryUrl.iNaturalist+"?q="+e)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab(ssar.affiliateQueryUrl.calPhotos+"?rel-taxon=contains&where-taxon="+e)}),h=null,b=e.split("+"),ssar.activeTaxon={genus:b[0],species:b[1],subspecies:b[2]},"caudata"===(m=o.linnean_order.toLowerCase())||"anura"===m||"gymnophiona"===m?("AmphibiaWeb",h=ssar.affiliateQueryUrl.amphibiaWeb+"?where-genus="+o.genus+"&where-species="+o.species):isNull(o.linnean_order)||(n="<paper-button id='modal-alt-linkout' class=\"hidden-xs\">"+"Reptile Database"+"</paper-button>",h=ssar.affiliateQueryUrl.reptileDatabase+"?genus="+o.genus+"&species="+o.species,smartReptileDatabaseLink()),null!=h?($("#modal-alt-linkout").replaceWith(n),$("#modal-alt-linkout").click(function(){return openTab(h)})):$("#modal-alt-linkout").addClass("hidden").unbind(),formatScientificNames(),doFontExceptions(),c=(c=e.charAt(0).toUpperCase()+e.slice(1)).replace(/\+/g," "),d$("#modal-heading").text(c),isNull(o.image)&&(o.image=void 0),ssar.taxonImage={imageUri:o.image,imageCredit:o.image_credit,imageLicense:o.image_license};try{insertModalImage()}catch(e){s=e,console.info("Unable to insert modal image! ")}return checkTaxonNear(e,function(){var e;return formatAlien(o),stopLoad(),e=d$("#modal-taxon")[0],d$("#modal-taxon").on("iron-overlay-opened",function(){return e.fit(),e.scrollTop=0,toFloat($(e).css("top").slice(0,-2))>$(window).height()&&$(e).css("top","12.5vh"),delay(250,function(){return e.fit()})}),e.sizingTarget=d$("#modal-taxon-content")[0],safariDialogHelper("#modal-taxon")}),bindDismissalRemoval()}).fail(function(e,t){return stopLoadError()}),!1)},bindDismissalRemoval=function(){return $("[dialog-dismiss]").unbind().click(function(){return $(this).parents("paper-dialog").remove()})},doFontExceptions=function(){var e,t;return e=["de","and"],t=function(t){return $.each(e,function(e,a){var n;if(n=" "+a+" ",null!=t)return t=t.replace(n," <span class='force-lower'>"+a+"</span> ")}),t},d$(".authority").each(function(){var e;if(e=$(this).text(),!isNull(e))return $(this).html(t(e))}),!1},sortResults=function(e){return searchParams.result},setHistory=function(e,t,a){return null==e&&(e="#"),null==t&&(t=null),null==a&&(a=null),history.pushState(t,a,e),uri.query=$.url(e).attr("fragment"),!1},clearSearch=function(e){var t;return null==e&&(e=!1),$("#result-count").text(""),t='<div class="bs-callout bs-callout-info center-block col-xs-12 col-sm-8 col-md-5">\n  Search for a common or scientific name above to begin, eg, "California slender salamander" or "<span class="sciname">Batrachoseps attenuatus</span>"\n</div>',$("#result_container").html(t),!0!==e&&(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean-order").polymerSelected("any"),formatScientificNames(),!1)},downloadCSVList=function(){var e,t,a,n,r;return animateLoad(),"q=*",t=new Date,e=t.getMonth()+1,r=1===e.toString().length?"0"+e:e,n=1===t.getDate().toString().length?"0"+t.getDate().toString():t.getDate(),a=t.getUTCFullYear()+"-"+r+"-"+n,$.get(""+searchParams.apiPath,"q=*","json").done(function(e){var t,n,r,o,i,s,l,c,d,u,p,h,m,f,g,b,y,w,x,v,k,_;try{if(!0!==e.status)throw Error("Invalid Result");i="      ",s=new Array,x=["genus","species","subspecies","common_name","image","image_credit","image_license","major_type","major_common_type","major_subtype","minor_type","linnean_order","genus_authority","species_authority","deprecated_scientific","notes","taxon_credit","taxon_credit_date"],b=["genus","common_name","taxon_author","major_subtype","linnean_order"],f=0,y=e.result;for(g in y)if(w=y[g],l=new Array,!isNull(w.genus)){for(c in w)if(d=w[c],n=c.replace(/"/g,'""'),r=d.replace(/"/g,'""').replace(/&#39;/g,"'"),0===f&&indexOf.call(x,n)>=0&&s.push(n.replace(/_/g," ").toTitleCase()),indexOf.call(x,n)>=0){if(/[a-z]+_authority/.test(n))try{t=JSON.parse(w.authority_year),h="",v="";for(g in t)_=t[g],h=g.replace(/"/g,'""').replace(/&#39;/g,"'"),v=_.replace(/"/g,'""').replace(/&#39;/g,"'");switch(n.split("_")[0]){case"genus":k=r.toTitleCase()+" "+h,toInt(w.parens_auth_genus).toBool()&&(k="("+k+")");break;case"species":k=r.toTitleCase()+" "+v,toInt(w.parens_auth_species).toBool()&&(k="("+k+")")}r=k}catch(e){p=e}indexOf.call(b,n)>=0&&(r=r.toTitleCase()),"image"!==n||isNull(r)||(r="http://ssarherps.org/cndb/"+r),l.push('"'+r+'"')}f++,i+="\n"+l.join(",")}return o=s.join(",")+"\n"+i,u="data:text/csv;charset=utf-8,"+encodeURIComponent(o),m='<paper-dialog class="download-file" id="download-csv-file" modal>\n  <h2>Your file is ready</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <p>\n      Please note that some special characters in names may be decoded incorrectly by Microsoft Excel. If this is a problem, following the steps in <a href="https://github.com/SSARHERPS/SSAR-species-database/blob/master/meta/excel_unicode_readme.md"  onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'>this README <iron-icon icon="launch"></iron-icon></a> to force Excel to format it correctly.\n    </p>\n    <p class="text-center">\n      <a href="'+u+'" download="ssar-common-names-'+a+'.csv" class="btn btn-default"><iron-icon icon="file-download"></iron-icon> Download Now</a>\n    </p>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("#download-csv-file").exists()?$("#download-csv-file").replaceWith(m):$("body").append(m),$("#download-chooser").get(0).close(),safariDialogHelper("#download-csv-file")}catch(t){return p=t,stopLoadError("There was a problem creating the CSV file. Please try again later."),console.error("Exception in downloadCSVList() - "+p.message),console.warn("Got",e,"from",searchParams.apiPath+"?q=*",e.status)}}).fail(function(){return stopLoadError("There was a problem communicating with the server. Please try again later.")}),!1},downloadHTMLList=function(){var e,t,a,n,r,o,i;return animateLoad(),a=new Date,e=a.getMonth()+1,i=1===e.toString().length?"0"+e:e,r=1===a.getDate().toString().length?"0"+a.getDate().toString():a.getDate(),n=a.getUTCFullYear()+"-"+i+"-"+r,o='     <!doctype html>\n     <html lang="en">\n       <head>\n         <title>SSAR Common Names Checklist ver. '+n+'</title>\n         <meta http-equiv="X-UA-Compatible" content="IE=edge">\n         <meta charset="UTF-8"/>\n         <meta name="theme-color" content="#445e14"/>\n         <meta name="viewport" content="width=device-width, initial-scale=1" />\n         <link href=\'http://fonts.googleapis.com/css?family=Droid+Serif:400,700,700italic,400italic|Roboto+Slab:400,700\' rel=\'stylesheet\' type=\'text/css\' />\n         <style type="text/css" id="ssar-checklist-inline-stylesheet">\n/*!\n* Bootstrap v3.3.5 (http://getbootstrap.com)\n* Copyright 2011-2015 Twitter, Inc.\n* Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n*/\n\n/*!\n* Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=e14c62a4d4eee8f40b6b)\n* Config saved to config.json and https://gist.github.com/e14c62a4d4eee8f40b6b\n*//*!\n* Bootstrap v3.3.5 (http://getbootstrap.com)\n* Copyright 2011-2015 Twitter, Inc.\n* Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n*//*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */@media print{*,*:before,*:after{background:transparent !important;color:#000 !important;-webkit-box-shadow:none !important;box-shadow:none !important;text-shadow:none !important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="#"]:after,a[href^="javascript:"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}p,h2,h3{orphans:3;widows:3}h2,h3{page-break-after:avoid}.navbar{display:none}.btn>.caret,.dropup>.btn>.caret{border-top-color:#000 !important}.label{border:1px solid #000}.table{border-collapse:collapse !important}.table td,.table th{background-color:#fff !important}.table-bordered th,.table-bordered td{border:1px solid #ddd !important}}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Roboto Slab","Droid Serif",Cambria,Georgia,"Times New Roman",Times,serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}input,button,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:hover,a:focus{color:#23527c;text-decoration:underline}a:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role="button"]{cursor:pointer}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}h1 small,h2 small,h3 small,h4 small,h5 small,h6 small,.h1 small,.h2 small,.h3 small,.h4 small,.h5 small,.h6 small,h1 .small,h2 .small,h3 .small,h4 .small,h5 .small,h6 .small,.h1 .small,.h2 .small,.h3 .small,.h4 .small,.h5 .small,.h6 .small{font-weight:normal;line-height:1;color:#777}h1,.h1,h2,.h2,h3,.h3{margin-top:20px;margin-bottom:10px}h1 small,.h1 small,h2 small,.h2 small,h3 small,.h3 small,h1 .small,.h1 .small,h2 .small,.h2 .small,h3 .small,.h3 .small{font-size:65%}h4,.h4,h5,.h5,h6,.h6{margin-top:10px;margin-bottom:10px}h4 small,.h4 small,h5 small,.h5 small,h6 small,.h6 small,h4 .small,.h4 .small,h5 .small,.h5 .small,h6 .small,.h6 .small{font-size:75%}h1,.h1{font-size:36px}h2,.h2{font-size:30px}h3,.h3{font-size:24px}h4,.h4{font-size:18px}h5,.h5{font-size:14px}h6,.h6{font-size:12px}p{margin:0 0 10px}.lead{margin-bottom:20px;font-size:16px;font-weight:300;line-height:1.4}@media (min-width:768px){.lead{font-size:21px}}small,.small{font-size:85%}mark,.mark{background-color:#fcf8e3;padding:.2em}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.text-nowrap{white-space:nowrap}.text-lowercase{text-transform:lowercase}.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.text-muted{color:#777}.text-primary{color:#337ab7}a.text-primary:hover,a.text-primary:focus{color:#286090}.text-success{color:#3c763d}a.text-success:hover,a.text-success:focus{color:#2b542c}.text-info{color:#31708f}a.text-info:hover,a.text-info:focus{color:#245269}.text-warning{color:#8a6d3b}a.text-warning:hover,a.text-warning:focus{color:#66512c}.text-danger{color:#a94442}a.text-danger:hover,a.text-danger:focus{color:#843534}.bg-primary{color:#fff;background-color:#337ab7}a.bg-primary:hover,a.bg-primary:focus{background-color:#286090}.bg-success{background-color:#dff0d8}a.bg-success:hover,a.bg-success:focus{background-color:#c1e2b3}.bg-info{background-color:#d9edf7}a.bg-info:hover,a.bg-info:focus{background-color:#afd9ee}.bg-warning{background-color:#fcf8e3}a.bg-warning:hover,a.bg-warning:focus{background-color:#f7ecb5}.bg-danger{background-color:#f2dede}a.bg-danger:hover,a.bg-danger:focus{background-color:#e4b9b9}.page-header{padding-bottom:9px;margin:40px 0 20px;border-bottom:1px solid #eee}ul,ol{margin-top:0;margin-bottom:10px}ul ul,ol ul,ul ol,ol ol{margin-bottom:0}.list-unstyled{padding-left:0;list-style:none}.list-inline{padding-left:0;list-style:none;margin-left:-5px}.list-inline>li{display:inline-block;padding-left:5px;padding-right:5px}dl{margin-top:0;margin-bottom:20px}dt,dd{line-height:1.42857143}dt{font-weight:bold}dd{margin-left:0}@media (min-width:768px){.dl-horizontal dt{float:left;width:160px;clear:left;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dl-horizontal dd{margin-left:180px}}abbr[title],abbr[data-original-title]{cursor:help;border-bottom:1px dotted #777}.initialism{font-size:90%;text-transform:uppercase}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee}blockquote p:last-child,blockquote ul:last-child,blockquote ol:last-child{margin-bottom:0}blockquote footer,blockquote small,blockquote .small{display:block;font-size:80%;line-height:1.42857143;color:#777}blockquote footer:before,blockquote small:before,blockquote .small:before{content:\' 14 \0A0\'}.blockquote-reverse,blockquote.pull-right{padding-right:15px;padding-left:0;border-right:5px solid #eee;border-left:0;text-align:right}.blockquote-reverse footer:before,blockquote.pull-right footer:before,.blockquote-reverse small:before,blockquote.pull-right small:before,.blockquote-reverse .small:before,blockquote.pull-right .small:before{content:\'\'}.blockquote-reverse footer:after,blockquote.pull-right footer:after,.blockquote-reverse small:after,blockquote.pull-right small:after,.blockquote-reverse .small:after,blockquote.pull-right .small:after{content:\'\0A0  14\'}address{margin-bottom:20px;font-style:normal;line-height:1.42857143}.clearfix:before,.clearfix:after,.dl-horizontal dd:before,.dl-horizontal dd:after{content:" ";display:table}.clearfix:after,.dl-horizontal dd:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right !important}.pull-left{float:left !important}.hide{display:none !important}.show{display:block !important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none !important}.affix{position:fixed}\n          /* Manual Overrides */\n          .sciname {\n            font-style: italic;\n            }\n          .entry-sciname {\n            font-style: italic;\n            font-weight: bold;\n            }\n           body { padding: 1rem; }\n           .species-entry aside:first-child {\n             margin-top: 5rem;\n             }\n           section .entry-header {\n             text-indent: 2em;\n             }\n           .clade-declaration {\n             font-variant: small-caps;\n             border-top: 1px solid #000;\n             border-bottom: 1px solid #000;\n             page-break-before: always;\n             break-before: always;\n             }\n           .species-entry {\n             page-break-inside: avoid;\n             break-inside: avoid;\n             }\n           @media print {\n             body {\n               font-size:12px;\n               }\n             .h4 {\n               font-size: 13px;\n               }\n             @page {\n               counter-increment: page;\n               /*counter-reset: page 1;*/\n                @bottom-right {\n                 content: counter(page);\n                }\n                /* margin: 0px auto; */\n               }\n           }\n         </style>\n       </head>\n       <body>\n         <div class="container-fluid">\n           <article>\n             <h1 class="text-center">SSAR Common Names Checklist ver. '+n+"</h1>",t="q=*&order=linnean_order,genus,species,subspecies",$.get(""+searchParams.apiPath,t,"json").done(function(e){var a,r,i,s,l,c,d,u,p,h,m,f,g,b,y,w,x,v,k,_,S,T;try{if(!0!==e.status)throw Error("Invalid Result");h=new Array,p=new Array,y=e.result;for(g in y)if(v=y[g],!isNull(v.genus)&&!isNull(v.species)){try{a=JSON.parse(v.authority_year),u="",_="";for(r in a)T=a[r],u=r.replace(/&#39;/g,"'"),_=T.replace(/&#39;/g,"'");d=v.genus_authority.toTitleCase()+" "+u,toInt(v.parens_auth_genus).toBool()&&(d="("+d+")"),k=v.species_authority.toTitleCase()+" "+_,toInt(v.parens_auth_species).toBool()&&(k="("+k+")")}catch(e){l=e,console.warn("There was a problem parsing the authority information for _"+v.genus+" "+v.species+" "+v.subspecies+"_ - "+l.message),console.warn(l.stack),console.warn("We were working with",a,u,d,_,k)}try{f=markdown.toHTML(v.notes)}catch(e){l=e,console.warn("Unable to parse Markdown for _"+v.genus+" "+v.species+" "+v.subspecies+"_"),f=v.notes}m="",isNull(f)||isNull(v.taxon_credit)||(S="",isNull(v.taxon_credit_date)||(S=", "+v.taxon_credit_date),m='<p class="text-right small text-muted">\n  <cite>\n    '+v.taxon_credit+S+"\n  </cite>\n</p>"),b="",w=v.linnean_order.trim(),indexOf.call(p,w)<0&&(b+='<h2 class="clade-declaration text-capitalize text-center">'+v.linnean_order+" &#8212; "+v.major_common_type+"</h2>",p.push(v.linnean_order.trim())),x=v.genus,indexOf.call(h,x)<0&&(b+='<aside class="genus-declaration lead">\n  <span class="entry-sciname text-capitalize">'+v.genus+'</span>\n  <span class="entry-authority">'+d+"</span>\n</aside>",h.push(v.genus)),c='<section class="species-entry">\n  '+b+'\n  <p class="h4 entry-header">\n    <span class="entry-sciname">\n      <span class="text-capitalize">'+(v.genus.slice(0,1)+". ")+"</span> "+v.species+" "+v.subspecies+'\n    </span>\n    <span class="entry-authority">\n      '+k+'\n    </span>\n    &#8212;\n    <span class="common_name no-cap">\n      '+smartUpperCasing(v.common_name)+'\n    </span>\n  </p>\n  <div class="entry-content">\n    '+f+"\n    "+m+"\n  </div>\n</section>",o+=c}return o+="</article>\n</div>\n</body>\n</html>",s="data:text/html;charset=utf-8,"+encodeURIComponent(o),i='<paper-dialog  modal class="download-file" id="download-html-file">\n  <h2>Your file is ready</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <p class="text-center">\n      <a href="'+s+'" download="ssar-common-names-'+n+'.html" class="btn btn-default"><iron-icon icon="file-download"></iron-icon> Download Now</a>\n    </p>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Close</paper-button>\n  </div>\n</paper-dialog>',$("#download-html-file").exists()?$("#download-html-file").replaceWith(i):$("body").append(i),$("#download-chooser").get(0).close(),safariDialogHelper("#download-html-file"),$.post("pdf/pdfwrapper.php","html="+encodeURIComponent(o),"json").done(function(e){var t;return console.debug("PDF result",e),e.status?(t=""+uri.urlString+e.file,console.debug(t)):console.error("Couldn't make PDF file"),!1}).error(function(e,t){return console.error("Wasn't able to fetch PDF")})}catch(a){return l=a,stopLoadError("There was a problem creating your file. Please try again later."),console.error("Exception in downloadHTMLList() - "+l.message),console.warn("Got",e,"from",searchParams.apiPath+"?"+t,e.status),console.warn(l.stack)}}).fail(function(){return stopLoadError("There was a problem communicating with the server. Please try again later.")}),!1},showDownloadChooser=function(){var e;return e='<paper-dialog id="download-chooser" modal>\n  <h2>Select Download Type</h2>\n  <paper-dialog-scrollable class="dialog-content">\n    <p>\n      Once you select a file type, it will take a moment to prepare your download. Please be patient.\n    </p>\n  </paper-dialog-scrollable>\n  <div class="buttons">\n    <paper-button dialog-dismiss>Cancel</paper-button>\n    <paper-button dialog-confirm id="initiate-csv-download">CSV</paper-button>\n    <paper-button dialog-confirm id="initiate-html-download">HTML</paper-button>\n  </div>\n</paper-dialog>',$("#download-chooser").exists()||$("body").append(e),d$("#initiate-csv-download").click(function(){return downloadCSVList()}),d$("#initiate-html-download").click(function(){return downloadHTMLList()}),safariDialogHelper("#download-chooser"),!1},safariDialogHelper=function(e,t,a){var n,r;if(null==e&&(e="#download-chooser"),null==t&&(t=0),"function"!=typeof a&&(a=function(){return bindDismissalRemoval()}),!(t<10))return stopLoadError("Unable to show dialog. Please try again.");try{return d$(e).get(0).open(),"function"==typeof a&&a(),stopLoad()}catch(o){return o,r=t+1,n=250,delay(n,function(){return console.warn("Trying again to display dialog after "+r*n+"ms"),safariDialogHelper(e,r,a)})}},safariSearchArgHelper=function(e,t){var a,n;return null==t&&(t=!1),a=null!=e?e:$("#search").val(),n=!1,-1!==a.search(/\+/)&&(n=!0,a=a.replace(/\+/g," ").trim(),delay(100,function(){return safariSearchArgHelper()})),(n||null!=e)&&($("#search").attr("value",a),t||delay(5e3,function(){return safariSearchArgHelper(void 0,!0)})),!1},insertCORSWorkaround=function(){var e,t,a;if(null==ssar.hasShownWorkaround&&(ssar.hasShownWorkaround=!1),ssar.hasShownWorkaround)return!1;try{t=new WhichBrowser}catch(e){return e,!1}return t.isType("mobile")?(ssar.hasShownWorkaround=!0,!1):(e=function(){switch(t.browser.name){case"Chrome":return"Install the extension \"<a class='alert-link' href='https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi?utm_source=chrome-app-launcher-info-dialog'>Allow-Control-Allow-Origin: *</a>\", activate it on this domain, and you'll see them in your popups!";case"Firefox":return"Follow the instructions <a class='alert-link' href='http://www-jo.se/f.pfleger/forcecors-workaround'>for this ForceCORS add-on</a>, or try Chrome for a simpler extension. Once you've done so, you'll see photos in your popups!";case"Internet Explorer":return"Follow these <a class='alert-link' href='http://stackoverflow.com/a/20947828'>StackOverflow instructions</a> while on this site, and you'll see them in your popups!";default:return""}}(),a='<div class="alert alert-info alert-dismissible center-block fade in" role="alert">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Want CalPhotos images in your species dialogs?</strong> '+e+"\n  We're working with CalPhotos to enable this natively, but it's a server change on their side.\n</div>",$("#result_container").before(a),$(".alert").alert(),ssar.hasShownWorkaround=!0,!1)},showBadSearchErrorMessage=function(e){var t,a,n,r;return n=e.query.replace(/\+/g," "),!0===e.status?!0===e.query_params.filter.had_filter?(t="",a=0,$.each(e.query_params.filter.filter_params,function(n,r){if("BOOLEAN_TYPE"!==n)return 0!==a&&(t=filter_text+" "+e.filter.filter_params.BOOLEAN_TYPE),isNumber(toInt(r,!0))&&(r=1===toInt(r)?"true":"false"),t=t+" "+n.replace(/_/g," ")+" is "+r}),r='"'+n+'" where '+t+" returned no results."):r='"'+n+'" returned no results.':r=e.human_error,stopLoadError(r)},bindPaperMenuButton=function(e,t){var a,n,r,o,i,s;for(null==e&&(e="paper-menu-button"),null==t&&(t=!0),r=0,n=(i=$(e)).length;r<n;r++)a=i[r],o=$(a).find("paper-menu"),t&&$(o).unbind(),(s=function(e,t){var a,n;return n=$(e).polymerSelected(null,!0),a=$(t).find(".dropdown-label"),$(a).text(n),$(e).polymerSelected()})(o,a),$(o).on("iron-select",function(){return s(this,a)});return!1},$(function(){var e,t,a,n,r,o,i,s,l,c,d,u,p,h,m;if(t="****************************************************************************\nHello developer!\nIf you're looking for hints on our API information, this site is open-source\nand released under the GPL. Just click on the GitHub link on the bottom of\nthe page, or check out https://github.com/SSARHERPS\n****************************************************************************",console.log(t),animateLoad(),window.addEventListener("popstate",function(e){var t,a;uri.query=$.url().attr("fragment");try{t=Base64.decode(uri.query)}catch(e){e,t=""}return performSearch(t),a=t.split("&")[0],$("#search").attr("value",a)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(e){return e.preventDefault(),performSearch()}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-less")}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","icons:unfold-more")}),$("#search_form").keypress(function(e){if(13===e.which)return performSearch()}),$("#do-search").click(function(){return performSearch()}),$("#do-search-all").click(function(){return performSearch(!0)}),$("#linnean-order").on("iron-select",function(){if(!isNull($("#search").val()))return performSearch()}),bindPaperMenuButton(),isNull(uri.query))s="";else try{s=Base64.decode(uri.query),d=$.url(searchParams.apiPath+"?q="+s);try{l=d.param("loose").toBool()}catch(e){a=e,l=!1}try{i=d.param("fuzzy").toBool()}catch(e){a=e,i=!1}h=s.split("&")[0],safariSearchArgHelper(h),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return delay(250,function(){if(l&&d$("#loose").attr("checked","checked"),i)return d$("#fuzzy").attr("checked","checked")}),!1;if(null==ssar.stateIter&&(ssar.stateIter=0),++ssar.stateIter,ssar.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return delay(250,function(){return console.info("Doing a late Polymer.Base.ready call"),l&&d$("#loose").attr("checked","checked"),i&&d$("#fuzzy").attr("checked","checked"),safariSearchArgHelper()})})}catch(e){return delay(250,function(){return o()})}})();try{n=d.param("filter"),r=JSON.parse(Base64.decode(n)),c=!1;for(e in r)m=r[e],p="#"+(e=e.replace(/_/g,"-"))+"-filter","type"!==e?"is-alien"!==e?($(p).attr("value",m),c=!0):(u=1===toInt(m)?"alien-only":"native-only",console.log("Setting alien-filter to "+u),$("#alien-filter").get(0).selected=u,delay(750,function(){return $("#alien-filter").get(0).selected=u})):$("#linnean-order").polymerSelected(m);c&&$("#collapse-advanced").collapse("show")}catch(e){a=e,n=!1}}catch(e){a=e,console.error("Bad argument "+uri.query+" => "+s+", looseState, fuzzyState",l,i,searchParams.apiPath+"?q="+s),console.warn(a.message),s=""}return isNull(s)||"#"===s?(stopLoad(),$("#search").attr("disabled",!1),(o=function(){var e;if(null!=("undefined"!=typeof Polymer&&null!==Polymer&&null!=(e=Polymer.Base)?e.$$:void 0)&&!isNull(Polymer.Base.$$("#loose")))return delay(250,function(){return d$("#loose").attr("checked","checked")}),!1;if(null==ssar.stateIter&&(ssar.stateIter=0),++ssar.stateIter,ssar.stateIter>30)return console.warn("Couldn't attach Polymer.Base.ready"),!1;try{return Polymer.Base.ready(function(){return delay(250,function(){return d$("#loose").attr("checked","checked")})})}catch(e){return delay(250,function(){return o()})}})()):$.get(searchParams.targetApi,"q="+s,"json").done(function(e){return!0===e.status&&e.count>0?(formatSearchResults(e),!1):(showBadSearchErrorMessage(e),console.error(e.error),console.warn(e))}).fail(function(e,t){return console.error("There was an error loading the generic table"),console.warn(e,t,e.statusText),t=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't load table - "+t),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1})});var adminParams,createDuplicateTaxon,createNewTaxon,deleteTaxon,handleDragDropImage,loadAdminUi,loadModalTaxonEditor,lookupEditorSpecies,renderAdminSearchResults,saveEditorEntry,verifyLoginCredentials,indexOf=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(adminParams=new Object).apiTarget="admin_api.php",adminParams.adminPageUrl="https://ssarherps.org/cndb/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){try{verifyLoginCredentials(function(e){var t,a;return t="<h3>\n  Welcome, "+$.cookie("ssarherps_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'settings-applications\' class=\'click\' data-url=\''+e.login_url+'\'></paper-icon-button>\n  </span>\n  <span id="pib-wrapper-exit-to-app" class="pib-wrapper" data-toggle="tooltip" title="Go to CNDB app" data-placement="bottom">\n    <paper-icon-button icon=\'exit-to-app\' class=\'click\' data-url=\''+uri.urlString+"' id=\"app-linkout\"></paper-icon-button>\n  </span>\n</h3>\n<div id='admin-actions-block'>\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</div>",$("article #main-body").html(t),bindClicks(),a='<form id="admin-search-form" onsubmit="event.preventDefault()" class="row">\n  <div>\n    <paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel class="col-xs-7 col-sm-8"></paper-input>\n    <paper-fab id="do-admin-search" icon="search" raisedButton class="materialblue"></paper-fab>\n    <paper-fab id="do-admin-add" icon="add" raisedButton class="materialblue"></paper-fab>\n  </div>\n</form>\n<div id=\'search-results\' class="row"></div>',$("#admin-actions-block").html(a),$("#admin-search-form").submit(function(e){return e.preventDefault()}),$("#admin-search").keypress(function(e){if(13===e.which)return renderAdminSearchResults()}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),$("#do-admin-add").click(function(){return createNewTaxon()}),bindClickTargets(),!1})}catch(e){e,$("article #main-body").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(e){var t,a,n,r;return a=$.cookie("ssarherps_auth"),r=$.cookie("ssarherps_secret"),n=$.cookie("ssarherps_link"),t="hash="+a+"&secret="+r+"&dblink="+n,$.post(adminParams.loginApiTarget,t,"json").done(function(t){return!0===t.status?e(t):goTo(t.login_url)}).fail(function(e,t){return $("article #main-body").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p>'</div>"),console.log(e,t),!1}),!1},renderAdminSearchResults=function(e){var t,a,n,r;return null==e&&(e="#search-results"),r=$("#admin-search").val(),isNull(r)?(toastStatusMessage("Please enter a search term"),!1):(animateLoad(),$("#admin-search").blur(),r=r.replace(/\./g,""),r=prepURI(r.toLowerCase()),t="q="+r+"&loose=true",a=Base64.encodeURI(r),n=uri.urlString+"#"+a,$("#app-linkout").attr("data-url",n),$.get(searchParams.targetApi,t,"json").done(function(t){var a,n,r,o,i,s;return!0!==t.status||0===t.count?(stopLoadError(),toastStatusMessage(isNull(t.human_error)?"Your search returned no results. Please try again.":t.human_error),!1):(r=t.result,o="",i="<table id='cndb-result-list' class='table table-striped table-hover'>\n\t<tr class='cndb-row-headers'>","</table>",s=toInt(t.count)-1,n=null,a=0,$.each(r,function(t,r){var l,c,d,u;if(0===toInt(t)&&(c=0,i+="\n\x3c!-- Table Headers - "+Object.size(r)+" entries --\x3e",$.each(r,function(e,t){var o,s;if(s=e.replace(/_/g," "),"genus"!==e&&"species"!==e&&"subspecies"!==e||(i+="\n\t\t<th class='text-center'>"+s+"</th>",a++),++c===Object.size(r))return i+="\n\t\t<th class='text-center'>Edit</th>",a++,i+="\n\t\t<th class='text-center'>Delete</th>\n\t</tr>",a++,i+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+a+" display columns."),o=roundNumber(12/a,0),n="col-md-"+o})),u=r.genus.trim()+"+"+r.species.trim(),isNull(r.subspecies)||(u=u+"+"+r.subspecies.trim()),l="\n\t<tr id='cndb-row"+t+"' class='cndb-result-entry' data-taxon=\""+u+'">',d=0,$.each(r,function(e,a){return!!isNull(r.genus)||("genus"!==e&&"species"!==e&&"subspecies"!==e||(l+="\n\t\t<td id='"+e+"-"+t+"' class='"+e+" "+n+"'>"+a+"</td>"),++d===Object.size(r)?(l+="\n\t\t<td id='edit-"+t+"' class='edit-taxon "+n+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+u+"'></paper-icon-button></td>",l+="\n\t\t<td id='delete-"+t+"' class='delete-taxon "+n+" text-center'><paper-icon-button icon='delete' class='delete-taxon-button fadebg' data-taxon='"+u+"' data-database-id='"+r.id+"'></paper-icon-button></td>",l+="\n\t</tr>",o+=l):void 0)}),toInt(t)===s)return o=i+o+"</table>",$(e).html(o),console.log("Processed "+(toInt(t)+1)+" rows"),$(".edit").click(function(){var e;return e=$(this).attr("data-taxon"),lookupEditorSpecies(e)}),$(".delete-taxon-button").click(function(){var e;return $(this).attr("data-taxon"),e=$(this).attr("data-database-id"),deleteTaxon(e)}),stopLoad()}))}).fail(function(e,t){var a;return console.error("There was an error performing the search"),console.warn(e,a,e.statusText),a=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+a),$("#search-status")[0].show(),stopLoadError()}))},loadModalTaxonEditor=function(e,t){var a,n;return null==e&&(e=""),null==t&&(t="Save"),a='<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input>\n<paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input>\n<paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input>\n<iron-label>\n  Alien species?\n  <paper-toggle-button id="is-alien"  checked="false"></paper-toggle-button>\n</iron-label>\n<paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input>\n<paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp"></paper-input>\n  <span class="help-block" id="deprecatedHelp">List names here in the form <span class="code">"Genus species":"Authority: year","Genus species":"Authority: year",[...]</span>.<br/>There should be no spaces between the quotes and comma or colon. If there are, it may not save correctly.</span>\n<paper-input label="Clade" class="capitalize" id="edit-major-type" name="edit-major-type" floatingLabel></paper-input>\n<paper-input label="Subtype" class="capitalize" id="edit-major-subtype" name="edit-major-subtype" floatingLabel></paper-input>\n<paper-input label="Minor clade / \'Family\'" id="edit-minor-type" name="edit-minor-type" floatingLabel></paper-input>\n<paper-input label="Linnean Order" id="edit-linnean-order" name="edit-linnean-order" class="linnean_order" floatingLabel></paper-input>\n<paper-input label="Common Type (eg., \'lizard\')" id="edit-major-common-type" name="edit-major-common-type" class="major_common_type" floatingLabel></paper-input>\n<paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input>\n<paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Genus Authority\n  <paper-toggle-button id="genus-authority-parens"  checked="false"></paper-toggle-button>\n</iron-label>\n<paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input>\n<paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Species Authority\n  <paper-toggle-button id="species-authority-parens" checked="false"></paper-toggle-button>\n</iron-label>\n<br/><br/>\n<iron-autogrow-textarea id="edit-notes" rows="5" aria-describedby="notes-help" placeholder="Notes">\n  <textarea placeholder="Notes" id="edit-notes-textarea" name="edit-notes-textarea" aria-describedby="notes-help" rows="5"></textarea>\n</iron-autogrow-textarea>\n<span class="help-block" id="notes-help">You can write your notes in Markdown. (<a href="https://daringfireball.net/projects/markdown/syntax" "onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'">Official Full Syntax Guide</a>)</span>\n<div id="upload-image"></div>\n<span class="help-block" id="upload-image-help">You can drag and drop an image above, or enter its server path below.</span>\n<paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input>\n  <span class="help-block" id="imagehelp">The image path here should be relative to the <span class="code">public_html/cndb/</span> directory.</span>\n<paper-input label="Image Credit" id="edit-image-credit" name="edit-image-credit" floatingLabel></paper-input>\n<paper-input label="Image License" id="edit-image-license" name="edit-image-license" floatingLabel></paper-input>\n<paper-input label="Taxon Credit" id="edit-taxon-credit" name="edit-taxon-credit" floatingLabel aria-describedby="taxon-credit-help"></paper-input>\n  <span class="help-block" id="taxon-credit-help">This will be displayed as "Taxon information by [your entry]."</span>\n<paper-input label="Taxon Credit Date" id="edit-taxon-credit-date" name="edit-taxon-credit-date" floatingLabel></paper-input>\n'+e+'\n<input type="hidden" name="edit-taxon-author" id="edit-taxon-author" value="" />',n='<paper-dialog modal id=\'modal-taxon-edit\' entry-animation="scale-up-animation" exit-animation="fade-out-animation">\n  <h2 id="editor-title">Taxon Editor</h2>\n  <paper-dialog-scrollable id=\'modal-taxon-editor\'>\n    '+a+"\n  </paper-dialog-scrollable>\n  <div class=\"buttons\">\n    <paper-button id='close-editor' dialog-dismiss>Cancel</paper-button>\n    <paper-button id='duplicate-taxon'>Duplicate</paper-button>\n    <paper-button id='save-editor'>"+t+"</paper-button>\n  </div>\n</paper-dialog>",$("#modal-taxon-edit").exists()&&$("#modal-taxon-edit").remove(),$("#search-results").after(n),handleDragDropImage(),$("#modal-taxon-edit").unbind(),d$("#save-editor").unbind(),d$("#duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})},createNewTaxon=function(){var e,t;return animateLoad(),loadModalTaxonEditor("","Create"),d$("#editor-title").text("Create New Taxon"),t=.5*$(window).height(),d$("#modal-taxon-editor").css("min-height",t+"px"),d$("#modal-taxon-editor div.scrollable").css("max-height",""),d$("#modal-taxon-edit").addClass("create-new-taxon"),d$("#duplicate-taxon").remove(),e=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname"),d$("#edit-taxon-author").attr("value",e),d$("#save-editor").click(function(){return saveEditorEntry("new")}),$("#modal-taxon-edit").get(0).open(),stopLoad()},createDuplicateTaxon=function(){var e,t;animateLoad();try{d$("#taxon-id").remove(),d$("#last-edited-by").remove(),d$("#duplicate-taxon").remove(),d$("#editor-title").text("Create Duplicate Taxon"),t='<paper-button id="save-editor">Create</paper-button>',d$("#save-editor").replaceWith(t),d$("#save-editor").click(function(){return saveEditorEntry("new")}),delay(250,function(){return stopLoad()})}catch(t){e=t,stopLoadError("Unable to duplicate taxon"),console.error("Couldn't duplicate taxon! "+e.message),d$("#modal-taxon-edit").get(0).close()}return!0},lookupEditorSpecies=function(e){var t,a,n,r,o,i,s,l,c,d;if(null==e&&(e=void 0),null==e)return!1;if(animateLoad(),r="<p id=\"last-edited-by\">\n  Last edited by <span id=\"taxon-author-last\" class=\"capitalize\"></span>\n</p>\n<input type='hidden' name='taxon-id' id='taxon-id'/>",loadModalTaxonEditor(r),d$("#save-editor").click(function(){return saveEditorEntry()}),d$("#last-edited-by").exists()||d$("#taxon-credit-help").after(r),i=void 0,o=void 0,t="q="+e,-1!==e.search(/\(/)){for(o={genus:"",species:"",subspecies:""},i={genus:"",species:"",subspecies:""},c=e.split("+"),n=0;n<c.length;){switch(d=c[n],console.log("Checking '"+d+"'"),toInt(n)){case 0:a=d.split("("),console.log("Looking at genus array",a),o.genus=a[0].trim(),i.genus=null!=a[1]?a[1].trim().slice(0,-1):a[0];break;case 1:s=d.split("("),console.log("Looking at species array",s),o.species=s[0].trim(),i.species=null!=s[1]?s[1].trim().slice(0,-1):s[0];break;case 2:l=d.split("("),console.log("Looking at ssp array",l),o.subspecies=l[0].trim(),i.subspecies=null!=l[1]?l[1].trim().slice(0,-1):l[0];break;default:console.error("K value of '"+n+"' didn't match 0,1,2!")}c[n]=d.trim(),n++}e=o.genus+"+"+o.species,isNull(o.subspecies)||(e+=o.subspecies),t="q="+e+"&loose=true",console.warn("Bad name! Calculated out:"),console.warn("Should be currently",i),console.warn("Was previously",o),console.warn("Pinging with",""+uri.urlString+searchParams.targetApi+"?q="+e)}return $.get(searchParams.targetApi,t,"json").done(function(t){var a,n,r,s,l,c,d,u,p,h,m,f,g;try{if(null==(r=t.result[0]))return stopLoadError("Sorry, there was a problem parsing the information for this taxon. If it persists, you may have to fix it manually."),console.error("No data returned for",searchParams.targetApi+"?q="+e),!1;try{r.deprecated_scientific=JSON.parse(r.deprecated_scientific)}catch(e){s=e}null!=o&&(toastStatusMessage("Bad information found. Please review and resave."),r.genus=i.genus,r.species=i.species,r.subspecies=i.subspecies,"object"!=typeof r.deprecated_scientific&&(r.deprecated_scientific=new Object),d=o.species,isNull(o.subspecies)||(d+=" "+o.subspecies),r.deprecated_scientific[o.genus.toTitleCase()+" "+d]="AUTHORITY: YEAR"),h=["parens_auth_genus","parens_auth_species","is_alien"];for(a in r){n=r[a];try{"string"==typeof n&&(n=n.trim())}catch(e){s=e}if("id"===a&&$("#taxon-id").attr("value",n),"authority_year"===a)g=parseTaxonYear(n),$("#edit-gauthyear").attr("value",g.genus),$("#edit-sauthyear").attr("value",g.species);else if(indexOf.call(h,a)>=0)u="parens"===a.split("_")[0]?"#"+a.split("_").pop()+"-authority-parens":"#"+a.replace(/_/g,"-"),d$(u).polymerChecked(toInt(n).toBool());else if("taxon_author"===a)"null"===n||isNull(n)?($("#last-edited-by").remove(),console.warn("Removed #last-edited-by! Didn't have an author provided for column '"+a+"', giving '"+n+"'. It's probably the first edit to this taxon.")):d$("#taxon-author-last").text(n),m=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname"),d$("#edit-taxon-author").attr("value",m);else if(l="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a&&'""'===(n=(n=(n=JSON.stringify(n).trim().replace(/\\/g,"")).replace(/{/,"")).replace(/}/,""))&&(n=""),"notes"!==a)d$(l).attr("value",n);else{f=.9*$("#modal-taxon-edit").width(),d$(l).css("width",f+"px"),p=d$(l).get(0).textarea,$(p).text(n);try{d$(l).get(0)._update()}catch(e){s=e,console.warn("Couldn't update the textarea! See","https://github.com/PolymerElements/iron-autogrow-textarea/issues/24")}}}return c=$("#modal-taxon-edit")[0],$("#modal-taxon-edit").on("iron-overlay-opened",function(){return c.fit(),c.scrollTop=0,toFloat($(c).css("top").slice(0,-2))>$(window).height()&&$(c).css("top","12.5vh"),delay(250,function(){return c.fit()})}),c.sizingTarget=d$("#modal-taxon-editor")[0],safariDialogHelper("#modal-taxon-edit"),stopLoad()}catch(e){return s=e,stopLoadError("Unable to populate the editor for this taxon - "+s.message)}}).fail(function(e,t){return stopLoadError("There was a server error populating this taxon. Please try again.")}),!1},saveEditorEntry=function(e){var t,a,n,r,o,i,s,l,c,d,u,p,h,m,f,g,b,y,w,x,v,k,_,S,T,C,L,N,j,z,P,E,O,I,D,A,B,U,M,R;null==e&&(e="save"),g=["genus","species","subspecies","common-name","major-type","major-common-type","major-subtype","minor-type","linnean-order","genus-authority","species-authority","notes","image","image-credit","image-license","taxon-author","taxon-credit","taxon-credit-date"],z=new Object,f=!1,d$("paper-input").removeAttr("invalid");try{A=function(e,t){var a,n,r,o,i,s,l,c;if(null==t&&(t=!1),l=t?e:d$(e).val(),o=void 0,1707,r=new Date,i=r.getUTCFullYear()+1,n=/^[1-2][07-9]\d{2}$|^[1-2][07-9]\d{2} (\"|')[1-2][07-9]\d{2}\1$/,isNumber(l)&&1707<l&&l<i||(n.test(l)?-1===l.search(" ")?o="This must be a valid year between 1707 and "+i:(1707<(s=(c=l.split(" "))[0])&&s<i||(o="The first year must be a valid year between 1707 and "+i),1707<(a=c[1].replace(/(\"|')/g,""))&&a<i||(o="The second year must be a valid year between 1707 and "+i),l=l.replace(/'/g,'"')):o=-1===l.search(" ")?"This must be a valid year between 1707 and "+i:"Nonstandard years must be of the form: YYYY 'YYYY', eg, 1801 '1802'"),null!=o){if(f=!0,console.warn(e+" failed its validity checks for "+l+"!"),t)throw Error(o);d$(""+e).attr("error-message",o).attr("invalid","invalid")}return l};try{b=A("#edit-gauthyear"),j=A("#edit-sauthyear"),console.log("Escape Completion State:",f)}catch(e){h=e,console.error("Unable to parse authority year! "+h.message),n=""}(a=new Object)[b]=j,n=JSON.stringify(a)}catch(e){h=e,console.error("Failed to JSON parse the authority year - "+h.message),n=""}z.authority_year=n;try{if(c=new Object,u=d$("#edit-deprecated-scientific").val(),isNull(u))p="";else{for(T=0,_=(d=u.split('","')).length;T<_;T++)c[(x=(v=d[T]).split('":"'))[0].replace(/"/g,"")]=x[1].replace(/"/g,"");console.log("Validating",c);for(D in c){if(r=c[D],o=r.split(":"),console.log("Testing "+r,o),2!==o.length)throw Error("Authority string should have an authority and year seperated by a colon.");if(a=o[0].trim(),-1!==(B=o[1].trim()).search(","))throw Error("Looks like there may be an extra space, or forgotten \", near '"+B+"'");R=A(B,!0),console.log("Validated",a,R)}if((p=JSON.stringify(c)).replace(/[{}]/g,"")!==u)throw Error("Badly formatted entry - generated doesn't match read")}}catch(e){h=e,console.error("Failed to parse the deprecated scientifics - "+h.message+". They may be empty."),p="",m=h.message+". Check your formatting!",d$("#edit-deprecated-scientific").attr("error-message",m).attr("invalid",!0),f=!0,s="There was a problem with your formatting for the deprecated scientifics. Please check it and try again."}z.deprecated_scientific=p,k=["notes","taxon_credit","image","image_credit","image_license"],L=["common-name","major-type","linnean-order","genus-authority","species-authority"],isNull(d$("#edit-image").val())||(L.push("image-credit"),L.push("image-license")),isNull(d$("#edit-taxon-credit").val())||L.push("taxon-credit-date");for(v in g){switch(w=g[v],i=w.replace(/-/g,"_"),M="notes"!==i?d$("#edit-"+w).val().trim():d$("#edit-notes").get(0).textarea.value,indexOf.call(k,i)<0&&(M=M.toLowerCase()),w){case"genus":case"species":case"subspecies":m="This required field must have only letters",C=("genus"===w||"species"===w)&&isNull(M),(/[^A-Za-z]/m.test(M)||C)&&(d$("#edit-"+w).attr("error-message",m).attr("invalid","invalid"),f=!0);break;case"common-name":case"major-type":case"linnean-order":case"genus-authority":case"species-authority":m="This cannot be empty",isNull(M)&&($("#edit-"+w).attr("error-message",m).attr("invalid","invalid"),f=!0);break;default:indexOf.call(L,w)>=0&&(I="This must not be empty","#edit-image-credit"!==(O="#edit-"+w)&&"#edit-image-license"!==O||(I="This cannot be empty if an image is provided"),"#edit-taxon-credit-date"===O&&(I="If you have a taxon credit, it also needs a date"),isNull(M)&&(d$("#edit-"+w).attr("error-message",I).attr("invalid","invalid"),f=!0))}z[i]=M}return f?(animateLoad(),l=null!=s?s:"Bad characters in entry. Stopping ...",null==s&&(s="There was a problem with your entry. Please correct your entry and try again."),stopLoadError(s),console.error(l),!0):(z.id=d$("#taxon-id").val(),z.parens_auth_genus=d$("#genus-authority-parens").polymerChecked(),z.parens_auth_species=d$("#species-authority-parens").polymerChecked(),z.is_alien=d$("#is-alien").polymerChecked(),"save"!==e||isNumber(z.id)?(P=JSON.stringify(z),N=Base64.encodeURI(P),isNull(P)||isNull(N)?(animateLoad(),stopLoadError("The system was unable to parse this entry for the server. Please see the console for more details."),console.error("Unable to stringify the JSON!."),console.warn("The total save object so far is:",z),console.warn("Got the output string",saveSring),console.warn("Sending b64 string",N),!0):(y=$.cookie("ssarherps_auth"),E=$.cookie("ssarherps_secret"),S=$.cookie("ssarherps_link"),U="hash="+y+"&secret="+E+"&dblink="+S,t="perform="+e+"&"+U+"&data="+N,console.log("Going to save",z),console.log("Using mode '"+e+"'"),animateLoad(),$.post(adminParams.apiTarget,t,"json").done(function(e){return!0===e.status?(console.log("Server returned",e),f?(console.error("Warning! The item saved, even though it wasn't supposed to."),!1):(d$("#modal-taxon-edit").get(0).close(),isNull($("#admin-search").val())||renderAdminSearchResults(),!1)):(stopLoadError(),toastStatusMessage(e.human_error),console.error(e.error),console.warn("Server returned",e),console.warn("We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1)}).fail(function(e,a){return stopLoadError("Failed to send the data to the server."),console.error("Server error! We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1}))):(animateLoad(),stopLoadError("The system was unable to generate a valid taxon ID for this entry. Please see the console for more details."),console.error("Unable to get a valid, numeric taxon id! We got '"+z.id+"'."),console.warn("The total save object so far is:",z),!1))},deleteTaxon=function(e){var t,a,n,r,o;return a=$(".delete-taxon .delete-taxon-button[data-database-id='"+e+"']"),o=a.attr("data-taxon").replace(/\+/g," "),r=o.substr(0,1).toUpperCase()+o.substr(1),a.hasClass("extreme-danger")?null!=window.deleteWatchTimer?(n=Date.now()-window.deleteWatchTimer,console.warn("The taxon was asked to be deleted "+n+"ms after the confirmation was prompted. Rejecting ..."),!1):(animateLoad(),t="perform=delete&id="+e,$.post(adminParams.apiTarget,t,"json").done(function(t){return!0===t.status?(a.parents("tr").remove(),toastStatusMessage(r+" with ID "+e+" has been removed from the database."),stopLoad()):(stopLoadError(t.human_error),console.error(t.error),console.warn(t)),!1}).fail(function(e,t){return stopLoadError("Failed to communicate with the server."),!1})):(window.deleteWatchTimer=Date.now(),delay(300,function(){return delete window.deleteWatchTimer}),a.addClass("extreme-danger"),delay(7500,function(){return a.removeClass("extreme-danger")}),toastStatusMessage("Click again to confirm deletion of "+r),!1)},handleDragDropImage=function(e,t){return null==e&&(e="#upload-image"),"function"!=typeof t&&(t=function(e,t){var a,n,r,o;if(!0!==t.status)return null==t.human_error&&(t.human_error="There was a problem uploading your image."),toastStatusMessage(t.human_error),console.error("Error uploading!",t),!1;try{r=e.name,ssar.dropzone.disable(),n=r.split(".").pop(),o="species_photos/"+(md5(r)+"."+n),d$("#edit-image").attr("disabled","disabled").attr("value",o),toastStatusMessage("Upload complete")}catch(e){a=e,console.error("There was a problem with upload post-processing - "+a.message),console.warn("Using",r,t),toastStatusMessage("Your upload completed, but we couldn't post-process it.")}return!1}),loadJS("bower_components/JavaScript-MD5/js/md5.min.js"),loadJS("bower_components/dropzone/dist/min/dropzone.min.js",function(){var a,n,r,o,i;return(a=document.createElement("link")).setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","css/dropzone.min.css"),document.getElementsByTagName("head")[0].appendChild(a),Dropzone.autoDiscover=!1,n="Drop a high-resolution image for the taxon here.",r=function(){return d$(e).css("box-shadow","").css("border",""),d$(e+" .dz-message span").text(n)},o={url:uri.urlString+"meta.php?do=upload_image",acceptedFiles:"image/*",autoProcessQueue:!0,maxFiles:1,dictDefaultMessage:n,init:function(){return this.on("error",function(){return toastStatusMessage("An error occured sending your image to the server.")}),this.on("canceled",function(){return toastStatusMessage("Upload canceled.")}),this.on("dragover",function(){return d$(e+" .dz-message span").text("Drop here to upload the image"),d$(e).css("box-shadow","0px 0px 15px rgba(15,157,88,.8)").css("border","1px solid #0F9D58")}),this.on("dragleave",function(){return r()}),this.on("dragend",function(){return r()}),this.on("drop",function(){return r()}),this.on("success",function(e,a){return t(e,a)})}},d$(e).hasClass("dropzone")||d$(e).addClass("dropzone"),i=new Dropzone(d$(e).get(0),o),ssar.dropzone=i}),!1},$(function(){return $("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("https://ssarherps.org/cndb/bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("[data-toggle='tooltip']").tooltip()})});
//# sourceMappingURL=maps/combined.map