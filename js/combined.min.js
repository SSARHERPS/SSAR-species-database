function toObject(a){for(var b={},c=0;c<a.length;++c)void 0!==a[c]&&(b[c]=a[c]);return b}function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var activityIndicatorOff,activityIndicatorOn,adminParams,animateLoad,bindClickTargets,byteCount,checkTaxonNear,clearSearch,deferCalPhotos,delay,foo,formatScientificNames,formatSearchResults,getFilters,getLocation,goTo,handleDragDropImage,isBlank,isBool,isEmpty,isJson,isNull,isNumber,lightboxImages,loadAdminUi,lookupEditorSpecies,mapNewWindows,modalTaxon,openLink,openTab,overlayOff,overlayOn,parseTaxonYear,performSearch,prepURI,randomInt,renderAdminSearchResults,root,roundNumber,saveEditorEntry,searchParams,setHistory,sortResults,stopLoad,stopLoadError,toFloat,toInt,toastStatusMessage,uri,verifyLoginCredentials,__slice=[].slice;adminParams=new Object,adminParams.apiTarget="admin_api.php",adminParams.loginDir="admin/",adminParams.loginApiTarget=""+adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b;return $("article").html("<h3>Welcome, "+$.cookie("ssarherps_name")+" <paper-icon-button icon='settings-applications' class='click' data-url='"+a.login_url+"'></paper-icon-button></h3><div id='admin-actions-block'><div class='bs-callout bs-callout-info'><p>Please be patient while the administrative interface loads.</p></div></div>"),b='<form id="admin-search-form" onsubmit="event.preventDefault()">\n	<div>\n		<paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel class="col-xs-7 col-sm-8"></paper-input>\n		<paper-fab id="do-admin-search" icon="search" raisedButton class="materialblue"></paper-fab>\n	</div>\n</form><div id=\'search-results\'></div>',$("#admin-actions-block").html(b),$("#admin-search-form").submit(function(a){return a.preventDefault()}),$("#admin-search").keypress(function(a){return 13===a.which?renderAdminSearchResults():void 0}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),bindClickTargets(),!1})}catch(b){a=b,$("article").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie("ssarherps_auth"),e=$.cookie("ssarherps_secret"),d=$.cookie("ssarherps_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("article").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p>'</div>"),console.log(a,b),!1}),!1},renderAdminSearchResults=function(a){var b,c;return null==a&&(a="#search-results"),c=$("#admin-search").val(),isNull(c)?(toastStatusMessage("Please enter a search term"),!1):(animateLoad(),$("#admin-search").blur(),c=c.replace(/\./g,""),c=prepURI(c),b="q="+c+"&loose=true",$.get(searchParams.targetApi,b,"json").done(function(b){var c,d,e,f,g,h,i;return b.status!==!0?(toastStatusMessage(b.human_error),!1):(e=b.result,f="",h="<table id='cndb-result-list' class='table table-striped table-hover'>\n	<tr class='cndb-row-headers'>",g="</table>",i=toInt(b.count)-1,d=null,c=0,$.each(e,function(b,e){var j,k,l,m;return 0===toInt(b)&&(k=0,h+="\n<!-- Table Headers - "+Object.size(e)+" entries -->",$.each(e,function(a){var b,f;return f=a.replace(/_/g," "),("genus"===a||"species"===a||"subspecies"===a)&&(h+="\n		<th class='text-center'>"+f+"</th>",c++),k++,k===Object.size(e)?(h+="\n		<th class='text-center'>Edit</th>\n	</tr>",c++,h+="\n<!-- End Table Headers -->",console.log("Got "+c+" display columns."),b=roundNumber(12/c,0),d="col-md-"+b):void 0})),m=""+e.genus+"+"+e.species,isNull(e.subspecies)||(m=""+m+"+"+e.subspecies),j="\n	<tr id='cndb-row"+b+"' class='cndb-result-entry' data-taxon=\""+m+'">',l=0,$.each(e,function(a,c){return isNull(e.genus)?!0:(("genus"===a||"species"===a||"subspecies"===a)&&(j+="\n		<td id='"+a+"-"+b+"' class='"+a+" "+d+"'>"+c+"</td>"),l++,l===Object.size(e)?(j+="\n		<td id='"+a+"-"+b+"' class='edit-taxon "+d+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+m+"'></paper-icon-button></td>",j+="\n	</tr>",f+=j):void 0)}),toInt(b)===i?(f=h+f+g,$(a).html(f),console.log("Processed "+(toInt(b)+1)+" rows"),$(".edit").click(function(){var a;return a=$(this).attr("data-taxon"),lookupEditorSpecies(a)}),stopLoad()):void 0}))}).fail(function(a){var b;return console.error("There was an error performing the search"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't execute the search - "+b),$("#search-status")[0].show(),stopLoadError()}))},lookupEditorSpecies=function(a){var b,c;return null==a&&(a=void 0),null==a?!1:(animateLoad(),$("#modal-taxon-edit").exists()||(b='<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input> <paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input> <paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input> <paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input> <paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp"></paper-input> <span class="help-block" id="deprecatedHelp">List names here in the form <span class="code">"Genus species":"Authority: year","Genus species":"Authority: year",...</span></span> <paper-input label="Clade" id="edit-major-type" name="edit-major-type" floatingLabel></paper-input> <paper-input label="Subtype" id="edit-major-subtype" name="edit-major-subtype" floatingLabel></paper-input> <paper-input label="Minor clade / \'Family\'" id="edit-minor-type" name="edit-minor-type" floatingLabel></paper-input> <paper-input label="Linnean Order" id="edit-linnean-order" name="edit-linnean-order" class="linnean_order" floatingLabel></paper-input> <paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input> <paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input> <paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input> <paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input> <paper-autogrow-textarea target="edit-notes" id="edit-notes-autogrow"> <textarea placeholder="Notes" id="edit-notes" name="edit-notes"></textarea> </paper-autogrow-textarea> <paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input> <span class="help-block" id="imagehelp">The image path here should be relative to the <span class="code">public_html/cndb/</span> directory.</span><input type=\'hidden\' name=\'taxon-id\' id=\'taxon-id\'/>',c="<paper-action-dialog backdrop layered closeSelector=\"[dismissive]\" id='modal-taxon-edit'><div id='modal-taxon-editor'>"+b+"</div><paper-button id='close-editor' dismissive>Cancel</paper-button><paper-button id='save-editor' affirmative>Save</paper-button></paper-action-dialog>",$("#search-results").after(c),$("html /deep/ #save-editor").click(function(){return saveEditorEntry()})),$.get(searchParams.targetApi,"q="+a,"json").done(function(a){var b,c;try{return b=a.result[0],console.log("Populating from",b),$.each(b,function(a,b){var c,d;return"id"===a&&$("#taxon-id").attr("value",b),"authority_year"===a?(d=parseTaxonYear(b),$("#edit-gauthyear").attr("value",d.genus),$("#edit-sauthyear").attr("value",d.species)):(c="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a&&(b=JSON.stringify(b).slice(1,-1)),"notes"!==a?$(c).attr("value",b):$("html /deep/ "+c).text(b))}),$("#modal-taxon-edit")[0].open(),stopLoad()}catch(d){return c=d,toastStatusMessage("Unable to populate the editor for this taxon - "+c.message)}}).fail(function(){return toastStatusMessage("There was a server error populating this taxon. Please try again.")}),!1)},saveEditorEntry=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;i=["genus","species","subspecies","common-name","major-type","major-subtype","minor-type","linnean-order","genus-authority","species-authority","notes","image"],o=new Object;try{j=$("html /deep/ #edit-gauthyear").val(),n=$("html /deep/ #edit-sauthyear").val(),b=new Object,b[j]=n,c=JSON.stringify(b)}catch(s){h=s,console.log("Failed to parase the authority year"),c=""}o.authority_year=c;try{d=new Object,f=$("#edit-deprecated-scientific").val(),e=f.split(","),$.each(e,function(a){var b;return b=a.split(":"),d[b[0]]=b[1]}),g=JSON.stringify(d)}catch(s){h=s,console.log("Failed to parse the deprecated scientifics"),g=""}return o.deprecated_scientific=g,$.each(i,function(a,b){var c,d,e;return console.log(a,b),d="html /deep/ #edit-"+b,c=b.replace(/-/g,"_"),e=$(d).val(),"notes"!==c&&(e=e.toLowerCase()),o[c]=e}),o.id=$("html /deep/ #taxon-id").val(),p=JSON.stringify(o),m=Base64.encodeURI(p),k=$.cookie("ssarherps_auth"),q=$.cookie("ssarherps_secret"),l=$.cookie("ssarherps_link"),r="hash="+k+"&secret="+q+"&dblink="+l,a="perform=save&"+r+"&data="+m,console.log("Going to save",o),animateLoad(),$.post(adminParams.apiTarget,a,"json").done(function(a){return a.status===!0?($("html /deep/ #modal-taxon-edit")[0].close(),stopLoad(),!1):(toastStatusMessage(a.human_error),console.error(a.error),!1)}).fail(function(){return toastStatusMessage("Failed to send the data to the server."),!1})},handleDragDropImage=function(){return foo()},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},$(function(){}),root="undefined"!=typeof exports&&null!==exports?exports:this,uri=new Object,uri.o=$.url(),uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory"),uri.query=uri.o.attr("fragment"),window.locationData=new Object,locationData.params={enableHighAccuracy:!0},locationData.last=void 0,isBool=function(a){return a===!0||a===!1},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){}return!1},isJson=function(a){if("object"==typeof a)return!0;try{return JSON.parse(a),!0}catch(b){}return!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){return!isNumber(a)||isNull(a)?0:parseInt(a)},String.prototype.toBool=function(){return"true"===this.toString()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Number.prototype.toBool=function(){return 1===this},Object.size=function(a){var b,c;c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.polymerSelected=function(a){var b,c,d,e,f,g;if(null==a&&(a=void 0),null==a){g=void 0;try{b=$(this).find("[valueattr]"),isNull(b)&&(b=$(this)),f=b.attr("valueattr"),g=$(this).find(".core-selected").attr(f)}catch(h){return c=h,!1}return("null"===g||null==g)&&(g=void 0),g}if(isBool(a)){if(console.log("setSelected "+a+" is boolean"),$(this).parent().children().removeAttribute("selected"),$(this).parent().children().removeAttribute("active"),$(this).parent().children().removeClass("core-selected"),$(this).prop("selected",a),$(this).prop("active",a),a===!0)return $(this).addClass("core-selected")}else try{return b=$(this).find("[valueattr]"),isNull(b)&&(b=$(this)),f=b.attr("valueattr"),e=$(this).find("["+f+"="+a+"]"),d=e.index(),e.parent().prop("selected",d)}catch(h){return c=h,!1}},jQuery.fn.polymerChecked=function(a){var b;return null==a&&(a=void 0),null!=a?jQuery(this).prop("checked",a):(b=jQuery(this)[0].checked,("null"===b||null==b)&&(b=void 0),b)},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),randomInt=function(a,b){var c,d,e;return null==a&&(a=0),null==b&&(b=1),c=Math.random(),null==a&&(d=[0,a],a=d[0],b=d[1]),a>b&&(e=[b,a],a=e[0],b=e[1]),Math.floor(c*(b-a+1)+a)},window.debounce_timer=null,Function.prototype.debounce=function(){var a,b,c,d,e,f,g;if(f=arguments[0],d=arguments[1],g=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[],null==f&&(f=300),null==d&&(d=!1),null==g&&(g=window.debounce_timer),e=this,b=function(){return d||e.apply(e,a),console.log("Debounce applied")},null!=g)try{clearTimeout(g)}catch(h){c=h}else d&&(e.apply(obj,a),console.log("Executed immediately"));return window.debounce_timer=setTimeout(b,f)},mapNewWindows=function(){return $(".newwindow").each(function(){var a,b;return a=$(this).attr("href"),null==a&&(a=$(this).attr("data-href")),b=function(a){return null==a?!1:(window.open(a),!1)},$(this).click(function(){return b(a)}),$(this).keypress(function(){return b(a)})})},toastStatusMessage=function(a,b,c,d){var e;return null==b&&(b=""),null==c&&(c=3e3),null==d&&(d="#search-status"),isNumber(c)||(c=3e3),d.slice(0,1)===!1&&(d="#"+d),$(d).exists()||(e='<paper-toast id="'+d.slice(1)+'" duration="'+c+'"></paper-toast>',$(e).appendTo("body")),$(d).attr("text",a),$(d).addClass(b),$(d)[0].show(),delay(c+500,function(){return $(d).empty(),$(d).removeClass(b),$(d).attr("text","")})},openLink=function(a){return null==a?!1:(window.open(a),!1)},openTab=function(a){return openLink(a)},goTo=function(a){return null==a?!1:(window.location.href=a,!1)},animateLoad=function(a,b){var c,d;null==a&&(a=50),null==b&&(b="loader"),"#"===b.slice(0,1)?(d=b,b=b.slice(1)):d="#"+b;try{return $(d).exists()?$(d).attr("active",!0):$("body").append('<paper-spinner id="'+b+'" active></paper-spinner'),!1}catch(e){return c=e,console.log("Could not animate loader",c.message)}},stopLoad=function(a){var b,c;null==a&&(a="loader"),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{if($(c).exists())return $(c).addClass("good"),delay(1e3,function(){return $(c).removeClass("good"),$(c).attr("active",!1)})}catch(d){return b=d,console.log("Could not stop load animation",b.message)}},stopLoadError=function(a){var b,c;null==a&&(a="loader"),"#"===a.slice(0,1)?(c=a,a=a.slice(1)):c="#"+a;try{if($(c).exists())return $(c).addClass("bad"),delay(3e3,function(){return $(c).removeClass("bad"),$(c).attr("active",!1)})}catch(d){return b=d,console.log("Could not stop load error animation",b.message)}},lightboxImages=function(a){var b;return null==a&&(a=".lightboximage"),b={onStart:function(){return overlayOn()},onEnd:function(){return overlayOff(),activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif"},$(a).imageLightbox(b)},activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")},activityIndicatorOff=function(){return $("#imagelightbox-loading").remove()},overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")},overlayOff=function(){return $("#imagelightbox-overlay").remove()},formatScientificNames=function(a){return null==a&&(a=".sciname"),$(".sciname").each(function(){var a;return a="italic"===$(this).css("font-style")?"normal":"italic",$(this).css("font-style",a)})},prepURI=function(a){return a=encodeURIComponent(a),a.replace(/%20/g,"+")},getLocation=function(a){var b,c;return null==a&&(a=void 0),c=function(a,b){return window.locationData.lat=a.coords.latitude,window.locationData.lng=a.coords.longitude,window.locationData.acc=a.coords.accuracy,window.locationData.last=Date.now(),null!=b&&b(window.locationData),!1},b=function(a,b){var c;return c=function(){switch(a.code){case 0:return"There was an error while retrieving your location: "+a.message;case 1:return"The user prevented this page from retrieving a location";case 2:return"The browser was unable to determine your location: "+a.message;case 3:return"The browser timed out retrieving your location."}}(),console.error(c),null!=b&&b(!1),!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(c,b,window.locationData.params):(console.warn("This browser doesn't support geolocation!"),null!=a?a(!1):void 0)},bindClickTargets=function(){return $(".click").unbind().click(function(){return openTab($(this).attr("data-url"))})},$(function(){var a;bindClickTargets();try{$('[data-toggle="tooltip"]').tooltip()}catch(b){a=b,console.warn("Tooltips were attempted to be set up, but do not exist")}try{if(checkAdmin(),adminParams.loadAdminUi===!0)return loadAdminUi()}catch(b){return a=b,getLocation()}}),searchParams=new Object,searchParams.targetApi="commonnames_api.php",searchParams.targetContainer="#result_container",searchParams.apiPath=uri.urlString+searchParams.targetApi,performSearch=function(a){var b,c,d,e;if(null==a&&(a=void 0),null==a){if(d=$("#search").val(),e=d,d=d.toLowerCase(),c=getFilters(),(isNull(d)||null==d)&&isNull(c))return $("#search-status").attr("text","Please enter a search term."),$("#search-status")[0].show(),!1;$("#search").blur(),d=d.replace(/\./g,""),d=prepURI(d),$("#loose").polymerChecked()&&(d=""+d+"&loose=true"),$("#fuzzy").polymerChecked()&&(d=""+d+"&fuzzy=true"),isNull(c)||(console.log("Got filters - "+c),d=""+d+"&filter="+c),b="q="+d}else a===!0?(b="q=",e="(all items)"):(b="q="+a,e=a.split("&")[0]),console.log("Searching on "+a);return"#"===d||isNull(d)&&isNull(b)||"q="===b&&a!==!0?!1:(animateLoad(),console.log("Got search value "+d+", hitting",""+searchParams.apiPath+"?"+b),$.get(searchParams.targetApi,b,"json").done(function(a){var b,c,d;return console.log("Search executed by "+a.method+" with "+a.count+" results."),0===toInt(a.count)?(a.status===!0?a.query_params.filter.had_filter===!0?(b="",c=0,$.each(a.query_params.filter.filter_params,function(d,e){return"BOOLEAN_TYPE"!==d?(0!==c&&(b=""+filter_text+" "+a.filter.filter_params.BOOLEAN_TYPE),b=""+b+" "+d.replace(/_/g," ")+" is "+e):void 0}),d='"'+e+'" where '+b+" returned no results."):d='"'+e+'" returned no results.':d=a.human_error,clearSearch(!0),$("#search-status").attr("text",d),$("#search-status")[0].show(),stopLoadError(),!1):a.status===!0?(formatSearchResults(a),!1):(clearSearch(!0),$("#search-status").attr("text",a.human_error),$("#search-status")[0].show(),console.error(a.error),console.warn(a),stopLoadError())}).fail(function(a,b){return console.error("There was an error performing the search"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't execute the search - "+b),$("#search-status")[0].show(),stopLoadError()}).always(function(){var a;return a=Base64.encodeURI(d),null!=d&&setHistory(""+uri.urlString+"#"+a),!1}))},getFilters=function(a,b){var c,d,e,f;if(null==a&&(a=".cndb-filter"),null==b&&(b="AND"),e=new Object,$(a).each(function(){var a,b;return a=$(this).attr("data-column"),null==a?!0:(b=$(this).polymerSelected(),"any"===b||"all"===b||"*"===b?!0:(isNull(b)||b===!1)&&(b=$(this).val(),isNull(b))?!0:e[a]=b.toLowerCase())}),0===Object.size(e))return console.log("Got back an empty filter list."),"";try{return e.BOOLEAN_TYPE=b,f=JSON.stringify(e),d=Base64.encodeURI(f),console.log("Returning "+d+" from",e),d}catch(g){return c=g,!1}},formatSearchResults=function(a,b){var c,d,e,f,g,h,i,j;return null==b&&(b=searchParams.targetContainer),e=a.result,searchParams.result=e,f=new Array,g="",i="<table id='cndb-result-list' class='table table-striped table-hover'>\n	<tr class='cndb-row-headers'>",h="</table>",j=toInt(a.count)-1,d=null,c=0,$.each(e,function(e,f){var k,l,m,n;return 0===toInt(e)&&(l=0,i+="\n<!-- Table Headers - "+Object.size(f)+" entries -->",$.each(f,function(a){var b,e,g;return g=a.replace(/_/g," "),"id"!==a&&"minor_type"!==a&&"notes"!==a&&(b=$("#show-deprecated").polymerSelected()!==!0?"deprecated_scientific":"",a!==b&&(i+="\n		<th class='text-center'>"+g+"</th>",c++)),l++,l===Object.size(f)?(i+="\n	</tr>",i+="\n<!-- End Table Headers -->",console.log("Got "+c+" display columns."),e=roundNumber(12/c,0),d="col-md-"+e):void 0})),n=""+f.genus+"+"+f.species,isNull(f.subspecies)||(n=""+n+"+"+f.subspecies),k="\n	<tr id='cndb-row"+e+"' class='cndb-result-entry' data-taxon=\""+n+'">',m=0,$.each(f,function(a,b){var c,h,i,j,l,o,p,q;if("id"!==a&&"minor_type"!==a&&"notes"!==a){if("authority_year"===a)try{try{h=JSON.parse(b)}catch(r){i=r,console.warn("There was an error parsing '"+b+"', attempting to fix - ",i.message),p=b.split(":"),q=p[1].slice(p[1].search('"')+1,-2),console.log("Examining "+q),q=q.replace(/"/g,"'"),p[1]='"'+q+'"}',b=p.join(":"),console.log("Reconstructed "+b),h=JSON.parse(b)}j=Object.keys(h)[0],o=h[j],b="G: "+j+"<br/>S: "+o}catch(r){i=r,console.error("There was an error parsing '"+b+"'",i.message),h=b}c=$("#show-deprecated").polymerSelected()!==!0?"deprecated_scientific":"",a!==c&&("image"===a&&(b=isNull(b)?"<paper-icon-button icon='launch' data-href='http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+n+"' class='newwindow calphoto' data-taxon=\""+n+'"></paper-icon-button>':"<paper-icon-button icon='image:image' data-lightbox='"+b+"' class='lightboximage'></paper-icon-button>"),l="genus"!==a&&"species"!==a&&"subspecies"!==a?""+a+" text-center":a,k+="\n		<td id='"+a+"-"+e+"' class='"+l+" "+d+"'>"+b+"</td>")}return m++,m===Object.size(f)?(k+="\n	</tr>",g+=k):void 0}),toInt(e)===j?(g=i+g+h,console.log("Processed "+(toInt(e)+1)+" rows"),$(b).html(g),mapNewWindows(),lightboxImages(),modalTaxon(),$("#result-count").text(" - "+a.count+" entries"),stopLoad()):void 0})},parseTaxonYear=function(a,b){var c,d,e,f,g,h;null==b&&(b=!0);try{c=JSON.parse(a)}catch(i){d=i,console.warn("There was an error parsing '"+a+"', attempting to fix - ",d.message),g=a.split(":"),h=g[1].slice(g[1].search('"')+1,-2),console.log("Examining "+h),h=h.replace(/"/g,"'"),g[1]='"'+h+'"}',a=g.join(":"),console.log("Reconstructed "+a);try{c=JSON.parse(a)}catch(i){return d=i,b?!1:a}}return e=Object.keys(c)[0],f=c[e],h=new Object,h.genus=e,h.species=f,h},checkTaxonNear=function(a,b,c){var d,e,f,g,h,i;return null==a&&(a=void 0),null==b&&(b=void 0),null==c&&(c="#near-me-container"),null==a?(console.warn("Please specify a taxon."),!1):(null==locationData.last&&getLocation(),g=(Date.now()-locationData.last)/1e3,g>900&&getLocation(),d="http://www.inaturalist.org/places.json",e="taxon="+a+"&latitude="+locationData.lat+"&longitude="+locationData.lng+"&place_type=county",h="",f="",i="",$.get(d,e,"json").done(function(a){return Object.size(a)>0?(h="communication:location-on",f="good-location",i="This species occurs in your county"):(h="communication:location-off",f="bad-location",i="This species does not occur in your county")}).fail(function(){return f="bad-location",h="warning",i="We couldn't determine your location"}).always(function(){var a;try{$("html /deep/ "+c).html("<core-icon icon='"+h+"' class='small-icon "+f+"' data-toggle='tooltip' id='near-me-icon'></core-icon>"),$("html /deep/ #near-me-icon").attr("title",i),$("html /deep/ #near-me-icon").tooltip()}catch(d){a=d,console.warn("Your browser doesn't support the /deep/ syntax for shadow DOMs.");try{$(c).html("<core-icon icon='"+h+"' class='small-icon "+f+"' data-toggle='tooltip' id='near-me-icon'></core-icon>"),$("#near-me-icon").attr("title",i),$("#near-me-icon").tooltip()}catch(d){a=d,console.warn("Fallback failed to draw contents on the <paper-action-dialog>")}}return null!=b?b():void 0}),!1)},deferCalPhotos=function(a){var b,c,d;return null==a&&(a=".calphoto"),b=$(a).length,c="http://calphotos.berkeley.edu/cgi-bin/img_query",d=0,$(a).each(function(){var a,e,f;return d++,f=$(this),e=f.attr("data-taxon"),a="getthumbinfo=1&num=all&cconly=1&taxon="+e+"&format=xml",$.get(c,a).done(function(a){var b,c,d,g,h,i;return h=xmlToJSON.parseString(a),b=h.xml.calphotos,i=b.thumb_url,d=b.enlarge_jpeg_url,g=b.enlarge_url,c="<a href='"+d+"' class='calphoto-img-anchor'><img src='"+i+"' data-href='"+g+"' class='calphoto-img-thumb' data-taxon='"+e+"'/></a>",f.replaceWith(c),!1}).fail(function(){return!1}).always(function(){return d===b?lightboxImages(".calphoto-image-anchor"):void 0})}),!1},modalTaxon=function(a){var b;return null==a&&(a=void 0),null==a?($(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))}),!1):(animateLoad(),$("#modal-taxon").exists()||(b="<paper-action-dialog backdrop layered closeSelector=\"[affirmative]\" id='modal-taxon'><div id='modal-taxon-content'></div><paper-button dismissive id='modal-inat-linkout'>iNaturalist</paper-button><paper-button dismissive id='modal-calphotos-linkout'>CalPhotos</paper-button><paper-button affirmative autofocus>Close</paper-button></paper-action-dialog>",$("#result_container").after(b)),$.get(searchParams.targetApi,"q="+a,"json").done(function(c){var d,e,f,g,h,i,j,k,l;if(d=c.result[0],console.log("Got",d),k=parseTaxonYear(d.authority_year),l="",k!==!1&&(l="<div id='near-me-container'></div><p><span class='genus'>"+d.genus+"</span>, <span class='genus_authority'>"+d.genus_authority+"</span> "+k.genus+"; <span class='species'>"+d.species+"</span>, <span class='species_authority'>"+d.species_authority+"</span> "+k.species+"</p>"),e="",!isNull(d.deprecated_scientific)){e="<p>Deprecated names:";try{j=JSON.parse(d.deprecated_scientific),h=0,$.each(j,function(a,b){return h++,1!==h&&(e+="; "),e+="<span class='sciname'>"+a+"</span>, "+b,h===Object.size(j)?e+="</p>":void 0})}catch(m){f=m,e="",console.error("There were deprecated scientific names, but the JSON was malformed.")}}return i="",isNull(d.minor_type)||(i=" <core-icon icon='arrow-forward'></core-icon> <span id='taxon-minor-type'>"+d.minor_type+"</span>"),isNull(d.notes)&&(d.notes="Sorry, we have no notes on this taxon yet."),b="<div id='meta-taxon-info'>"+l+"<p>Common name: <span id='taxon-common-name' class='common_name'>"+d.common_name+"</span></p><p>Type: <span id='taxon-type'>"+d.major_type+"</span> (<span id='taxon-common-type'>"+d.major_common_type+"</span>) <core-icon icon='arrow-forward'></core-icon> <span id='taxon-subtype'>"+d.major_subtype+"</span>"+i+"</p>"+e+"</div><h3>Taxon Notes</h3><p id='taxon-notes'>"+d.notes+"</p>",$("#modal-taxon-content").html(b),$("#modal-inat-linkout").unbind().click(function(){return openTab("http://www.inaturalist.org/taxa/search?q="+a)}),$("#modal-calphotos-linkout").unbind().click(function(){return openTab("http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+a)}),formatScientificNames(),g=a.charAt(0).toUpperCase()+a.slice(1),g=g.replace(/\+/g," "),$("#modal-taxon").attr("heading",g),stopLoad(),checkTaxonNear(a,function(){return $("#modal-taxon")[0].open()})}).fail(function(){return stopLoadError()}),!1)},sortResults=function(){var a;return a=searchParams.result},setHistory=function(a,b,c){return null==a&&(a="#"),null==b&&(b=null),null==c&&(c=null),history.pushState(b,c,a),uri.query=$.url(a).attr("fragment"),!1},clearSearch=function(a){var b;return null==a&&(a=!1),$("#result-count").text(""),b='<div class="bs-callout bs-callout-info center-block col-xs-12 col-sm-8 col-md-5"> Search for a common or scientific name above to begin. </div>',$("#result_container").html(b),a===!0?!1:(setHistory(),$(".cndb-filter").attr("value",""),$("#collapse-advanced").collapse("hide"),$("#search").attr("value",""),$("#linnean-order").polymerSelected("any"),!1)},$(function(){var a,b,c,d,e,f,g,h,i;if(console.log("Doing onloads ..."),animateLoad(),window.addEventListener("popstate",function(a){var b,c;uri.query=$.url().attr("fragment");try{b=Base64.decode(uri.query)}catch(d){a=d,b=""}return console.log("Popping state to "+b),performSearch(b),c=b.split("&")[0],$("#search").attr("value",c)}),$("#do-reset-search").click(function(){return clearSearch()}),$("#search_form").submit(function(a){return a.preventDefault(),performSearch()}),$("#collapse-advanced").on("shown.bs.collapse",function(){return $("#collapse-icon").attr("icon","unfold-less")}),$("#collapse-advanced").on("hidden.bs.collapse",function(){return $("#collapse-icon").attr("icon","unfold-more")}),$("#search_form").keypress(function(a){return 13===a.which?performSearch():void 0}),$("#do-search").click(function(){return performSearch()}),$("#do-search-all").click(function(){return performSearch(!0)}),isNull(uri.query))e="";else try{e=Base64.decode(uri.query),h=$.url(""+searchParams.apiPath+"?q="+e);try{f=h.param("loose").toBool()}catch(j){a=j,f=!1}try{d=h.param("fuzzy").toBool()}catch(j){a=j,d=!1}$("#loose").prop("checked",f),$("#fuzzy").prop("checked",d),i=e.split("&")[0],i=i.replace(/\+/g," ").trim(),$("#search").attr("value",i);try{b=h.param("filter"),c=JSON.parse(Base64.decode(b)),g=!1,$.each(c,function(a,b){var c;return a=a.replace(/_/g,"-"),c="#"+a+"-filter","type"!==a?($(c).attr("value",b),g=!0):$("#linnean-order").polymerSelected(b)}),g&&$("#collapse-advanced").collapse("show")}catch(j){a=j,b=!1}}catch(j){a=j,console.error("Bad argument "+uri.query+" => "+e+", looseState, fuzzyState",f,d,""+searchParams.apiPath+"?q="+e),console.warn(a.message),e=""}return isNull(e)||"#"===e?(stopLoad(),$("#search").attr("disabled",!1),$("#loose").prop("checked",!0)):(console.log("Doing initial search with '"+e+"', hitting",""+searchParams.apiPath+"?q="+e),$.get(searchParams.targetApi,"q="+e,"json").done(function(a){return a.status===!0&&a.count>0?(console.log("Got a valid result, formatting "+a.count+" results."),formatSearchResults(a),!1):(0===a.count&&(a.human_error='No results for "'+e.split("&")[0]+'"'),$("#search-status").attr("text",a.human_error),$("#search-status")[0].show(),console.error(a.error),console.warn(a),stopLoadError())}).fail(function(a,b){return console.error("There was an error loading the generic table"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't load table - "+b),$("#search-status")[0].show(),stopLoadError()}).always(function(){return $("#search").attr("disabled",!1),!1}))}),function(a){"function"==typeof define&&define.amd?define(a):window.purl=a()}(function(){function a(a,b){for(var c=decodeURI(a),d=p[b?"strict":"loose"].exec(c),e={attr:{},param:{},seg:{}},g=14;g--;)e.attr[n[g]]=d[g]||"";return e.param.query=f(e.attr.query),e.param.fragment=f(e.attr.fragment),e.seg.path=e.attr.path.replace(/^\/+|\/+$/g,"").split("/"),e.seg.fragment=e.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),e.attr.base=e.attr.host?(e.attr.protocol?e.attr.protocol+"://"+e.attr.host:e.attr.host)+(e.attr.port?":"+e.attr.port:""):"",e}function b(a){var b=a.tagName;return"undefined"!=typeof b?m[b.toLowerCase()]:b}function c(a,b){if(0===a[b].length)return a[b]={};var c={};for(var d in a[b])c[d]=a[b][d];return a[b]=c,c}function d(a,b,e,f){var g=a.shift();if(g){var h=b[e]=b[e]||[];"]"==g?j(h)?""!==f&&h.push(f):"object"==typeof h?h[k(h).length]=f:h=b[e]=[b[e],f]:~g.indexOf("]")?(g=g.substr(0,g.length-1),!q.test(g)&&j(h)&&(h=c(b,e)),d(a,h,g,f)):(!q.test(g)&&j(h)&&(h=c(b,e)),d(a,h,g,f))}else j(b[e])?b[e].push(f):b[e]="object"==typeof b[e]?f:"undefined"==typeof b[e]?f:[b[e],f]}function e(a,b,c){if(~b.indexOf("]")){var e=b.split("[");d(e,a,"base",c)}else{if(!q.test(b)&&j(a.base)){var f={};for(var h in a.base)f[h]=a.base[h];a.base=f}""!==b&&g(a.base,b,c)}return a}function f(a){return i(String(a).split(/&|;/),function(a,b){try{b=decodeURIComponent(b.replace(/\+/g," "))}catch(c){}var d=b.indexOf("="),f=h(b),g=b.substr(0,f||d),i=b.substr(f||d,b.length);
return i=i.substr(i.indexOf("=")+1,i.length),""===g&&(g=b,i=""),e(a,g,i)},{base:{}}).base}function g(a,b,c){var d=a[b];"undefined"==typeof d?a[b]=c:j(d)?d.push(c):a[b]=[d,c]}function h(a){for(var b,c,d=a.length,e=0;d>e;++e)if(c=a[e],"]"==c&&(b=!1),"["==c&&(b=!0),"="==c&&!b)return e}function i(a,b){for(var c=0,d=a.length>>0,e=arguments[2];d>c;)c in a&&(e=b.call(void 0,e,a[c],c,a)),++c;return e}function j(a){return"[object Array]"===Object.prototype.toString.call(a)}function k(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function l(b,c){return 1===arguments.length&&b===!0&&(c=!0,b=void 0),c=c||!1,b=b||window.location.toString(),{data:a(b,c),attr:function(a){return a=o[a]||a,"undefined"!=typeof a?this.data.attr[a]:this.data.attr},param:function(a){return"undefined"!=typeof a?this.data.param.query[a]:this.data.param.query},fparam:function(a){return"undefined"!=typeof a?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){return"undefined"==typeof a?this.data.seg.path:(a=0>a?this.data.seg.path.length+a:a-1,this.data.seg.path[a])},fsegment:function(a){return"undefined"==typeof a?this.data.seg.fragment:(a=0>a?this.data.seg.fragment.length+a:a-1,this.data.seg.fragment[a])}}}var m={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],o={anchor:"fragment"},p={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},q=/^[0-9]+$/;return l.jQuery=function(a){null!=a&&(a.fn.url=function(c){var d="";return this.length&&(d=a(this).attr(b(this[0]))||""),l(d,c)},a.url=l)},l.jQuery(window.jQuery),l});var xmlToJSON=function(){this.version="1.1";var a={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},b=new RegExp(/(?!xmlns)^.*:/),c=new RegExp(/^\s+|\s+$/g);return this.grokType=function(a){return/^\s*$/.test(a)?null:/^(?:true|false)$/i.test(a)?"true"===a.toLowerCase():isFinite(a)?parseFloat(a):a},this.parseString=function(a,b){return this.parseXML(this.stringToXML(a),b)},this.parseXML=function(d,e){for(key in e)a[key]=e[key];var f={},g=0,h="";if(a.xmlns&&d.namespaceURI&&(f[a.namespaceKey]=d.namespaceURI),d.attributes&&d.attributes.length>0){var i={};for(g;g<d.attributes.length;g++)oAttrib=d.attributes.item(g),l={},attribName="",attribName=a.stripAttrPrefix?oAttrib.name.replace(b,""):oAttrib.name,l[a.valueKey]=a.grokAttr?grokType(oAttrib.value.replace(c,"")):oAttrib.value.replace(c,""),a.xmlns&&oAttrib.namespaceURI&&(l[a.namespaceKey]=oAttrib.namespaceURI),a.attrsAsObject?i[attribName]=l:f[a.attrKey+attribName]=l;a.attrsAsObject&&(f[a.attrKey]=i)}if(d.hasChildNodes())for(var j,k,l,m=0;m<d.childNodes.length;m++)j=d.childNodes.item(m),4===j.nodeType?a.mergeCDATA?h+=j.nodeValue:f.hasOwnProperty(a.cdataKey)?(f[a.cdataKey].constructor!==Array&&(f[a.cdataKey]=[f[a.cdataKey]]),f[a.cdataKey].push(j.nodeValue)):a.childrenAsArray?(f[a.cdataKey]=[],f[a.cdataKey].push(j.nodeValue)):f[a.cdataKey]=j.nodeValue:3===j.nodeType?h+=j.nodeValue:1===j.nodeType&&(0===g&&(f={}),k=a.stripElemPrefix?j.nodeName.replace(b,""):j.nodeName,l=xmlToJSON.parseXML(j),f.hasOwnProperty(k)?(f[k].constructor!==Array&&(f[k]=[f[k]]),f[k].push(l)):(a.childrenAsArray?(f[k]=[],f[k].push(l)):f[k]=l,g++));else h||(a.childrenAsArray?(f[a.textKey]=[],f[a.textKey].push(null)):f[a.textKey]=null);return h&&(a.grokText?(value=this.grokType(h.replace(c,"")),null!==value&&void 0!==value&&(f[a.textKey]=value)):f[a.textKey]=a.normalize?h.replace(c,"").replace(/\s+/g," "):h.replace(c,"")),f},this.xmlToString=function(a){try{var b=a.xml?a.xml:(new XMLSerializer).serializeToString(a);return b}catch(c){return null}},this.stringToXML=function(a){try{var b=null;if(window.DOMParser){var c=new DOMParser;return b=c.parseFromString(a,"text/xml")}return b=new ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.loadXML(a),b}catch(d){return null}},this}();!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}});
//# sourceMappingURL=maps/combined.map