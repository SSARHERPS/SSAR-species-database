var activityIndicatorOff,activityIndicatorOn,adminParams,animateLoad,byteCount,deferCalPhotos,delay,formatScientificNames,formatSearchResults,goTo,isBlank,isBool,isEmpty,isJson,isNull,isNumber,lightboxImages,loadAdminUi,mapNewWindows,modalTaxon,openLink,openTab,overlayOff,overlayOn,parseTaxonYear,performSearch,prepURI,randomInt,root,roundNumber,searchParams,setHistory,sortResults,stopLoad,stopLoadError,toFloat,toInt,toastStatusMessage,uri,__slice=[].slice;adminParams=new Object();adminParams.loginPage="admin-login.php";adminParams.apiTarget="admin_api.php";loadAdminUi=function(){return false};$(function(){if(window.loadAdminUi===true){return loadAdminUi()}});root=typeof exports!=="undefined"&&exports!==null?exports:this;uri=new Object();uri.o=$.url();uri.urlString=uri.o.attr("protocol")+"://"+uri.o.attr("host")+uri.o.attr("directory");uri.query=uri.o.attr("fragment");isBool=function(a){return a===true||a===false};isEmpty=function(a){return !a||a.length===0};isBlank=function(a){return !a||/^\s*$/.test(a)};isNull=function(b){try{if(isEmpty(b)||isBlank(b)||(b==null)){if(!(b===false||b===0)){return true}}}catch(a){}return false};isJson=function(b){if(typeof b==="object"){return true}try{JSON.parse(b);return true}catch(a){}return false};isNumber=function(a){return !isNaN(parseFloat(a))&&isFinite(a)};toFloat=function(a){if(!isNumber(a)||isNull(a)){return 0}return parseFloat(a)};toInt=function(a){if(!isNumber(a)||isNull(a)){return 0}return parseInt(a)};function toObject(a){var c={};for(var b=0;b<a.length;++b){if(a[b]!==undefined){c[b]=a[b]}}return c}String.prototype.toBool=function(){return this.toString()==="true"};Boolean.prototype.toBool=function(){return this.toString()==="true"};Number.prototype.toBool=function(){return this===1};Object.size=function(c){var b,a;a=0;for(b in c){if(c.hasOwnProperty(b)){a++}}return a};delay=function(a,b){return setTimeout(b,a)};roundNumber=function(b,c){var a;if(c==null){c=0}a=Math.pow(10,c);return Math.round(b*a)/a};jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery.fn.polymerSelected=function(b){var a,c,g,f;if(b==null){b=void 0}if(b!=null){try{jQuery(this).prop("selected",b);jQuery(this).prop("active",b);if(b===true){return jQuery(this).addClass("core-selected")}else{return jQuery(this).removeClass("core-selected")}}catch(d){c=d;return false}}else{f=void 0;try{a=$(this).find("[valueattr]");if(isNull(a)){a=$(this)}g=a.attr("valueattr");console.log("Looking at  prop "+g);f=$(this).find(".core-selected").attr(g)}catch(d){c=d;return false}if(f==="null"||(f==null)){f=void 0}return f}};jQuery.fn.polymerChecked=function(a){var b;if(a==null){a=void 0}if(a!=null){return jQuery(this).prop("checked",a)}else{b=jQuery(this)[0].checked;if(b==="null"||(b==null)){b=void 0}return b}};jQuery.fn.isVisible=function(){return jQuery(this).css("display")!=="none"};jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3};byteCount=(function(a){return function(b){return encodeURI(b).split(/%..|./).length-1}})(this);function shuffle(d){for(var b,a,c=d.length;c;b=Math.floor(Math.random()*c),a=d[--c],d[c]=d[b],d[b]=a){}return d}randomInt=function(b,c){var e,d,a;if(b==null){b=0}if(c==null){c=1}e=Math.random();if(b==null){d=[0,b],b=d[0],c=d[1]}if(b>c){a=[c,b],b=a[0],c=a[1]}return Math.floor(e*(c-b+1)+b)};window.debounce_timer=null;({debounce:function(c,a,b){if(a==null){a=300}if(b==null){b=false}return function(){var e,d,f;e=1<=arguments.length?__slice.call(arguments,0):[];f=this;d=function(){if(!b){return c.apply(f,e)}};if(window.debounce_timer!=null){clearTimeout(window.debounce_timer)}else{if(b){c.apply(f,e)}}return window.debounce_timer=setTimeout(d,a)}}});Function.prototype.debounce=function(){var d,c,h,b,f,a,g;a=arguments[0],b=arguments[1],g=arguments[2],d=4<=arguments.length?__slice.call(arguments,3):[];if(a==null){a=300}if(b==null){b=false}if(g==null){g=window.debounce_timer}f=this;c=function(){if(!b){f.apply(f,d)}return console.log("Debounce applied")};if(g!=null){try{clearTimeout(g)}catch(i){h=i}}else{if(b){f.apply(obj,d);console.log("Executed immediately")}}return window.debounce_timer=setTimeout(c,a)};mapNewWindows=function(){return $(".newwindow").each(function(){var a,b;a=$(this).attr("href");if(a==null){a=$(this).attr("data-href")}b=function(c){if(c==null){return false}window.open(c);return false};$(this).click(function(){return b(a)});return $(this).keypress(function(){return b(a)})})};toastStatusMessage=function(d,c,e,a){var b;if(c==null){c="error"}if(e==null){e=3000}if(a==null){a="#status-message"}if(!isNumber(e)){e=3000}if(a.slice(0,1)===!"#"){a="#"+a}if(!$(a).exists()){b='<paper-toast id="'+(a.slice(1))+'" duration="'+e+'"></paper-toast>';$(b).appendTo("body")}$(a).attr("text",d);$(a).addClass(c);$(a)[0].show();return delay(e+500,function(){$(a).empty();$(a).removeClass(c);return $(a).attr("text","")})};openLink=function(a){if(a==null){return false}window.open(a);return false};openTab=function(a){return openLink(a)};goTo=function(a){if(a==null){return false}window.location.href=a;return false};animateLoad=function(g,b){var c,a;if(g==null){g=50}if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if(!$(a).exists()){$("body").append('<paper-spinner id="'+b+'" active></paper-spinner')}else{$(a).attr("active",true)}return false}catch(f){c=f;return console.log("Could not animate loader",c.message)}};stopLoad=function(b){var c,a;if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if($(a).exists()){$(a).addClass("good");return delay(1000,function(){$(a).removeClass("good");return $(a).attr("active",false)})}}catch(d){c=d;return console.log("Could not stop load animation",c.message)}};stopLoadError=function(b){var c,a;if(b==null){b="loader"}if(b.slice(0,1)==="#"){a=b;b=b.slice(1)}else{a="#"+b}try{if($(a).exists()){$(a).addClass("bad");return delay(3000,function(){$(a).removeClass("bad");return $(a).attr("active",false)})}}catch(d){c=d;return console.log("Could not stop load error animation",c.message)}};lightboxImages=function(a){var b;if(a==null){a=".lightboximage"}b={onStart:function(){return overlayOn()},onEnd:function(){overlayOff();return activityIndicatorOff()},onLoadStart:function(){return activityIndicatorOn()},onLoadEnd:function(){return activityIndicatorOff()},allowedTypes:"png|jpg|jpeg|gif"};return $(a).imageLightbox(b)};activityIndicatorOn=function(){return $('<div id="imagelightbox-loading"><div></div></div>').appendTo("body")};activityIndicatorOff=function(){return $("#imagelightbox-loading").remove()};overlayOn=function(){return $('<div id="imagelightbox-overlay"></div>').appendTo("body")};overlayOff=function(){return $("#imagelightbox-overlay").remove()};formatScientificNames=function(a){if(a==null){a=".sciname"}return $(".sciname").each(function(){var b;b=$(this).css("font-style")==="italic"?"normal":"italic";return $(this).css("font-style",b)})};prepURI=function(a){a=encodeURIComponent(a);return a.replace(/%20/g,"+")};$(function(){$(".click").click(function(){return openTab($(this).attr("data-url"))});return $('[data-toggle="tooltip"]').tooltip()});searchParams=new Object();searchParams.targetApi="commonnames_api.php";searchParams.targetContainer="#result_container";searchParams.apiPath=uri.urlString+searchParams.targetApi;performSearch=function(d){var a,c,b;if(d==null){d=void 0}if(d==null){c=$("#search").val();b=c;c=c.toLowerCase();if(isNull(c)||(c==null)){$("#search-status").attr("text","Please enter a search term.");$("#search-status")[0].show();return false}c=prepURI(c);if($("#loose").polymerChecked()){c=""+c+"&loose=true"}if($("#fuzzy").polymerChecked()){c=""+c+"&fuzzy=true"}a="q="+c}else{if(d===true){a="q=";b="(all items)"}else{a="q="+d;b=d.split("&")[0]}console.log("Searching on "+d)}if(c==="#"||(isNull(c)&&isNull(a))||(a==="q="&&d!==true)){return false}animateLoad();console.log("Got search value "+c+", hitting",""+searchParams.apiPath+"?"+a);return $.get(searchParams.targetApi,a,"json").done(function(e){console.log("Search executed by "+e.method+" with "+e.count+" results.");if(toInt(e.count)===0){$("#search-status").attr("text",'"'+b+'" returned no results.');$("#search-status")[0].show();stopLoadError();return false}if(e.status===true){formatSearchResults(e);return false}$("#search-status").attr("text",e.human_error);$("#search-status")[0].show();console.error(e.error);console.warn(e);return stopLoadError()}).fail(function(e,f){console.error("There was an error performing the search");console.warn(e,f,e.statusText);f=""+e.status+" - "+e.statusText;$("#search-status").attr("text","Couldn't execute the search - "+f);$("#search-status")[0].show();return stopLoadError()}).always(function(){var e;e=Base64.encodeURI(c);if(c!=null){setHistory(""+uri.urlString+"#"+e)}return false})};formatSearchResults=function(j,a){var g,i,f,c,h,d,e,b;if(a==null){a=searchParams.targetContainer}f=j.result;searchParams.result=f;c=new Array();h="";e="<table id='cndb-result-list' class='table table-striped table-hover'>\n\t<tr class='cndb-row-headers'>";d="</table>";b=toInt(j.count)-1;i=null;g=0;return $.each(f,function(o,q){var p,m,k,n;if(toInt(o)===0){m=0;e+="\n<!-- Table Headers - "+(Object.size(q))+" entries -->";$.each(q,function(r,l){var t,u,s;s=r.replace(/_/g," ");if(r!=="id"&&r!=="minor_type"&&r!=="notes"){if($("#show-deprecated").polymerSelected()!==true){t="deprecated_scientific"}else{t=""}if(r!==t){e+="\n\t\t<th class='text-center'>"+s+"</th>";g++}}m++;if(m===Object.size(q)){e+="\n\t</tr>";e+="\n<!-- End Table Headers -->";console.log("Got "+g+" display columns.");u=roundNumber(12/g,0);return i="col-md-"+u}})}n=""+q.genus+"+"+q.species;if(!isNull(q.subspecies)){n=""+n+"+"+q.subspecies}p="\n\t<tr id='cndb-row"+o+"' class='cndb-result-entry' data-taxon=\""+n+'">';k=0;$.each(q,function(r,l){var s,u,t,z,y,A,w,v;if(r!=="id"&&r!=="minor_type"&&r!=="notes"){if(r==="authority_year"){try{try{u=JSON.parse(l)}catch(x){t=x;console.warn("There was an error parsing '"+l+"', attempting to fix - ",t.message);w=l.split(":");v=w[1].slice(w[1].search('"')+1,-2);console.log("Examining "+v);v=v.replace(/"/g,"'");w[1]='"'+v+'"}';l=w.join(":");console.log("Reconstructed "+l);u=JSON.parse(l)}z=Object.keys(u)[0];A=u[z];l="G: "+z+"<br/>S: "+A}catch(x){t=x;console.error("There was an error parsing '"+l+"'",t.message);u=l}}if($("#show-deprecated").polymerSelected()!==true){s="deprecated_scientific"}else{s=""}if(r!==s){if(r==="image"){if(isNull(l)){l="<paper-icon-button icon='launch' data-href='http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+n+"' class='newwindow calphoto' data-taxon=\""+n+'"></paper-icon-button>'}else{l="<paper-icon-button icon='image:image' data-lightbox='"+l+"' class='lightboximage'></paper-icon-button>"}}if(r!=="genus"&&r!=="species"&&r!=="subspecies"){y=""+r+" text-center"}else{y=r}p+="\n\t\t<td id='"+r+"-"+o+"' class='"+y+" "+i+"'>"+l+"</td>"}}k++;if(k===Object.size(q)){p+="\n\t</tr>";return h+=p}});if(toInt(o)===b){h=e+h+d;console.log("Processed "+(toInt(o)+1)+" rows");$(a).html(h);mapNewWindows();lightboxImages();modalTaxon();$("#result-count").text(" - "+j.count+" entries");return stopLoad()}})};parseTaxonYear=function(a,h){var c,b,j,k,g,f;if(h==null){h=true}try{c=JSON.parse(a)}catch(i){b=i;console.warn("There was an error parsing '"+a+"', attempting to fix - ",b.message);g=a.split(":");f=g[1].slice(g[1].search('"')+1,-2);console.log("Examining "+f);f=f.replace(/"/g,"'");g[1]='"'+f+'"}';a=g.join(":");console.log("Reconstructed "+a);try{c=JSON.parse(a)}catch(i){b=i;if(h){return false}else{return a}}}j=Object.keys(c)[0];k=c[j];f=new Object();f.genus=j;f.species=k;return f};deferCalPhotos=function(a){var d,c,b;if(a==null){a=".calphoto"}d=$(a).length;c="http://calphotos.berkeley.edu/cgi-bin/img_query";b=0;$(a).each(function(){var f,e,g;b++;g=$(this);e=g.attr("data-taxon");f="getthumbinfo=1&num=all&cconly=1&taxon="+e+"&format=xml";return $.get(c,f).done(function(n){var m,j,k,l,h,i;h=xmlToJSON.parseString(n);m=h.xml.calphotos;i=m.thumb_url;k=m.enlarge_jpeg_url;l=m.enlarge_url;j="<a href='"+k+"' class='calphoto-img-anchor'><img src='"+i+"' data-href='"+l+"' class='calphoto-img-thumb' data-taxon='"+e+"'/></a>";g.replaceWith(j);return false}).fail(function(h,i){return false}).always(function(){if(b===d){return lightboxImages(".calphoto-image-anchor")}})});return false};modalTaxon=function(a){var b;if(a==null){a=void 0}if(a==null){$(".cndb-result-entry").click(function(){return modalTaxon($(this).attr("data-taxon"))});return false}animateLoad();if(!$("#modal-taxon").exists()){b="<paper-action-dialog backdrop layered closeSelector=\"[affirmative]\" id='modal-taxon'><div id='modal-taxon-content'></div><paper-button dismissive id='modal-inat-linkout'>iNaturalist</paper-button><paper-button dismissive id='modal-calphotos-linkout'>CalPhotos</paper-button><paper-button affirmative autofocus>Close</paper-button></paper-action-dialog>";$("#result_container").after(b)}$.get(searchParams.targetApi,"q="+a,"json").done(function(o){var h,c,k,g,j,d,f,l,m;h=o.result[0];console.log("Got",h);l=parseTaxonYear(h.authority_year);m="";if(l!==false){m="<p><span class='genus'>"+h.genus+"</span>, <span class='genus_authority'>"+h.genus_authority+"</span> "+l.genus+"; <span class='species'>"+h.species+"</span>, <span class='species_authority'>"+h.species_authority+"</span> "+l.species+"</p>"}c="";if(!isNull(h.deprecated_scientific)){c="<p>Deprecated names:";try{f=JSON.parse(h.deprecated_scientific);j=0;$.each(f,function(e,i){j++;if(j!==1){c+="; "}c+="<span class='sciname'>"+e+"</span>, "+i;if(j===Object.size(f)){return c+="</p>"}})}catch(n){k=n;c="";console.error("There were deprecated scientific names, but the JSON was malformed.")}}d="";if(!isNull(h.minor_type)){d=" <core-icon icon='arrow-forward'></core-icon> <span id='taxon-minor-type'>"+h.minor_type+"</span>"}if(isNull(h.notes)){h.notes="Sorry, we have no notes on this taxon yet."}b="<div id='meta-taxon-info'>"+m+"<p>Common name: <span id='taxon-common-name' class='common_name'>"+h.common_name+"</span></p><p>Type: <span id='taxon-type'>"+h.major_type+"</span> (<span id='taxon-common-type'>"+h.major_common_type+"</span>) <core-icon icon='arrow-forward'></core-icon> <span id='taxon-subtype'>"+h.major_subtype+"</span>"+d+"</p>"+c+"</div><h3>Taxon Notes</h3><p id='taxon-notes'>"+h.notes+"</p>";$("#modal-taxon-content").html(b);$("#modal-inat-linkout").unbind().click(function(){return openTab("http://www.inaturalist.org/taxa/search?q="+a)});$("#modal-calphotos-linkout").unbind().click(function(){return openTab("http://calphotos.berkeley.edu/cgi/img_query?rel-taxon=contains&where-taxon="+a)});formatScientificNames();g=a.charAt(0).toUpperCase()+a.slice(1);g=g.replace(/\+/g," ");$("#modal-taxon").attr("heading",g);stopLoad();return $("#modal-taxon")[0].open()}).fail(function(c,d){return stopLoadError()});return false};sortResults=function(b){var a;return a=searchParams.result};setHistory=function(a,b,c){if(a==null){a="#"}if(b==null){b=null}if(c==null){c=null}history.pushState(b,c,a);uri.query=$.url(a).attr("fragment");return false};$(function(){var f,h,d,a,c,b;console.log("Doing onloads ...");animateLoad();window.addEventListener("popstate",function(k){var j,i;uri.query=$.url().attr("fragment");j=Base64.decode(uri.query);console.log("Popping state to "+j);performSearch(j);i=j.split("&")[0];return $("#search").attr("value",i)});$("#search_form").submit(function(i){i.preventDefault();return performSearch()});$("#search_form").keypress(function(i){if(i.which===13){return performSearch()}});$("#do-search").click(function(){return performSearch()});$("#do-search-all").click(function(){return performSearch(true)});if(isNull(uri.query)){d=""}else{try{d=Base64.decode(uri.query);c=$.url(""+searchParams.apiPath+"?q="+d);try{a=c.param("loose").toBool()}catch(g){f=g;a=false}try{h=c.param("fuzzy").toBool()}catch(g){f=g;h=false}$("#loose").prop("checked",a);$("#fuzzy").prop("checked",h);b=d.split("&")[0];$("#search").attr("value",b)}catch(g){f=g;console.error("Bad argument "+uri.query+" => "+d+", looseState, fuzzyState",a,h,""+searchParams.apiPath+"?q="+d);console.warn(f.message);d=""}}if(!isNull(d)&&d!=="#"){console.log("Doing initial search with '"+d+"', hitting",""+searchParams.apiPath+"?q="+d);return $.get(searchParams.targetApi,"q="+d,"json").done(function(e){if(e.status===true&&e.count>0){console.log("Got a valid result, formatting "+e.count+" results.");formatSearchResults(e);return false}if(e.count===0){e.human_error='No results for "'+(d.split("&")[0])+'"'}$("#search-status").attr("text",e.human_error);$("#search-status")[0].show();console.error(e.error);console.warn(e);return stopLoadError()}).fail(function(e,i){console.error("There was an error loading the generic table");console.warn(e,i,e.statusText);i=""+e.status+" - "+e.statusText;$("#search-status").attr("text","Couldn't load table - "+i);$("#search-status")[0].show();return stopLoadError()}).always(function(){$("#search").attr("disabled",false);return false})}else{stopLoad();$("#search").attr("disabled",false);return $("#loose").prop("checked",true)}});(function(a){if(typeof define==="function"&&define.amd){define(a)}else{window.purl=a()}})(function(){var h={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],c={anchor:"fragment"},a={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},f=/^[0-9]+$/;function e(r,u){var w=decodeURI(r),t=a[u||false?"strict":"loose"].exec(w),v={attr:{},param:{},seg:{}},s=14;while(s--){v.attr[n[s]]=t[s]||""}v.param.query=i(v.attr.query);v.param.fragment=i(v.attr.fragment);v.seg.path=v.attr.path.replace(/^\/+|\/+$/g,"").split("/");v.seg.fragment=v.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");v.attr.base=v.attr.host?(v.attr.protocol?v.attr.protocol+"://"+v.attr.host:v.attr.host)+(v.attr.port?":"+v.attr.port:""):"";return v}function b(s){var r=s.tagName;if(typeof r!=="undefined"){return h[r.toLowerCase()]}return r}function q(v,u){if(v[u].length===0){return v[u]={}}var s={};for(var r in v[u]){s[r]=v[u][r]}v[u]=s;return s}function d(v,t,s,w){var r=v.shift();if(!r){if(g(t[s])){t[s].push(w)}else{if("object"==typeof t[s]){t[s]=w}else{if("undefined"==typeof t[s]){t[s]=w}else{t[s]=[t[s],w]}}}}else{var u=t[s]=t[s]||[];if("]"==r){if(g(u)){if(""!==w){u.push(w)}}else{if("object"==typeof u){u[p(u).length]=w}else{u=t[s]=[t[s],w]}}}else{if(~r.indexOf("]")){r=r.substr(0,r.length-1);if(!f.test(r)&&g(u)){u=q(t,s)}d(v,u,r,w)}else{if(!f.test(r)&&g(u)){u=q(t,s)}d(v,u,r,w)}}}}function k(v,u,x){if(~u.indexOf("]")){var w=u.split("[");d(w,v,"base",x)}else{if(!f.test(u)&&g(v.base)){var s={};for(var r in v.base){s[r]=v.base[r]}v.base=s}if(u!==""){l(v.base,u,x)}}return v}function i(r){return j(String(r).split(/&|;/),function(s,x){try{x=decodeURIComponent(x.replace(/\+/g," "))}catch(u){}var y=x.indexOf("="),w=o(x),t=x.substr(0,w||y),v=x.substr(w||y,x.length);v=v.substr(v.indexOf("=")+1,v.length);if(t===""){t=x;v=""}return k(s,t,v)},{base:{}}).base}function l(t,s,u){var r=t[s];if(typeof r==="undefined"){t[s]=u}else{if(g(r)){r.push(u)}else{t[s]=[r,u]}}}function o(u){var r=u.length,t,v;for(var s=0;s<r;++s){v=u[s];if("]"==v){t=false}if("["==v){t=true}if("="==v&&!t){return s}}}function j(v,s){var t=0,r=v.length>>0,u=arguments[2];while(t<r){if(t in v){u=s.call(undefined,u,v[t],t,v)}++t}return u}function g(r){return Object.prototype.toString.call(r)==="[object Array]"}function p(s){var r=[];for(var t in s){if(s.hasOwnProperty(t)){r.push(t)}}return r}function m(r,s){if(arguments.length===1&&r===true){s=true;r=undefined}s=s||false;r=r||window.location.toString();return{data:e(r,s),attr:function(t){t=c[t]||t;return typeof t!=="undefined"?this.data.attr[t]:this.data.attr},param:function(t){return typeof t!=="undefined"?this.data.param.query[t]:this.data.param.query},fparam:function(t){return typeof t!=="undefined"?this.data.param.fragment[t]:this.data.param.fragment},segment:function(t){if(typeof t==="undefined"){return this.data.seg.path}else{t=t<0?this.data.seg.path.length+t:t-1;return this.data.seg.path[t]}},fsegment:function(t){if(typeof t==="undefined"){return this.data.seg.fragment}else{t=t<0?this.data.seg.fragment.length+t:t-1;return this.data.seg.fragment[t]}}}}m.jQuery=function(r){if(r!=null){r.fn.url=function(t){var s="";if(this.length){s=r(this).attr(b(this[0]))||""}return m(s,t)};r.url=m}};m.jQuery(window.jQuery);return m});var xmlToJSON=(function(){this.version="1.1";var a={mergeCDATA:true,grokAttr:true,grokText:true,normalize:true,xmlns:true,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:true,stripAttrPrefix:true,stripElemPrefix:true,childrenAsArray:true};var b=new RegExp(/(?!xmlns)^.*:/);var c=new RegExp(/^\s+|\s+$/g);this.grokType=function(d){if(/^\s*$/.test(d)){return null}if(/^(?:true|false)$/i.test(d)){return d.toLowerCase()==="true"}if(isFinite(d)){return parseFloat(d)}return d};this.parseString=function(e,d){return this.parseXML(this.stringToXML(e),d)};this.parseXML=function(l,f){for(key in f){a[key]=f[key]}var d={},m=0,e="";if(a.xmlns&&l.namespaceURI){d[a.namespaceKey]=l.namespaceURI}if(l.attributes&&l.attributes.length>0){var h={};for(m;m<l.attributes.length;m++){oAttrib=l.attributes.item(m);j={};attribName="";if(a.stripAttrPrefix){attribName=oAttrib.name.replace(b,"")}else{attribName=oAttrib.name}if(a.grokAttr){j[a.valueKey]=grokType(oAttrib.value.replace(c,""))}else{j[a.valueKey]=oAttrib.value.replace(c,"")}if(a.xmlns&&oAttrib.namespaceURI){j[a.namespaceKey]=oAttrib.namespaceURI}if(a.attrsAsObject){h[attribName]=j}else{d[a.attrKey+attribName]=j}}if(a.attrsAsObject){d[a.attrKey]=h}else{}}if(l.hasChildNodes()){for(var k,g,j,i=0;i<l.childNodes.length;i++){k=l.childNodes.item(i);if(k.nodeType===4){if(a.mergeCDATA){e+=k.nodeValue}else{if(d.hasOwnProperty(a.cdataKey)){if(d[a.cdataKey].constructor!==Array){d[a.cdataKey]=[d[a.cdataKey]]}d[a.cdataKey].push(k.nodeValue)}else{if(a.childrenAsArray){d[a.cdataKey]=[];d[a.cdataKey].push(k.nodeValue)}else{d[a.cdataKey]=k.nodeValue}}}}else{if(k.nodeType===3){e+=k.nodeValue}else{if(k.nodeType===1){if(m===0){d={}}if(a.stripElemPrefix){g=k.nodeName.replace(b,"")}else{g=k.nodeName}j=xmlToJSON.parseXML(k);if(d.hasOwnProperty(g)){if(d[g].constructor!==Array){d[g]=[d[g]]}d[g].push(j)}else{if(a.childrenAsArray){d[g]=[];d[g].push(j)}else{d[g]=j}m++}}}}}}else{if(!e){if(a.childrenAsArray){d[a.textKey]=[];d[a.textKey].push(null)}else{d[a.textKey]=null}}}if(e){if(a.grokText){value=this.grokType(e.replace(c,""));if(value!==null&&value!==undefined){d[a.textKey]=value}}else{if(a.normalize){d[a.textKey]=e.replace(c,"").replace(/\s+/g," ")}else{d[a.textKey]=e.replace(c,"")}}}return d};this.xmlToString=function(e){try{var f=e.xml?e.xml:(new XMLSerializer()).serializeToString(e);return f}catch(d){return null}};this.stringToXML=function(g){try{var d=null;if(window.DOMParser){var h=new DOMParser();d=h.parseFromString(g,"text/xml");return d}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async=false;d.loadXML(g);return d}}catch(f){return null}};return this})();