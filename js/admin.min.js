var adminParams,createDuplicateTaxon,createNewTaxon,deleteTaxon,foo,handleDragDropImage,loadAdminUi,loadModalTaxonEditor,lookupEditorSpecies,renderAdminSearchResults,saveEditorEntry,verifyLoginCredentials,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};adminParams={},adminParams.apiTarget="admin_api.php",adminParams.adminPageUrl="http://ssarherps.org/cndb/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=""+adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){var a;try{verifyLoginCredentials(function(a){var b,c;return b="<h3>\n  Welcome, "+$.cookie("ssarherps_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'settings-applications\' class=\'click\' data-url=\''+a.login_url+'\'></paper-icon-button>\n  </span>\n  <span id="pib-wrapper-exit-to-app" class="pib-wrapper" data-toggle="tooltip" title="Go to CNDB app" data-placement="bottom">\n    <paper-icon-button icon=\'exit-to-app\' class=\'click\' data-url=\''+uri.urlString+"' id=\"app-linkout\"></paper-icon-button>\n  </span>\n</h3>\n<div id='admin-actions-block'>\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</div>",$("article").html(b),$(".pib-wrapper").tooltip(),c='<form id="admin-search-form" onsubmit="event.preventDefault()" class="row">\n  <div>\n    <paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel class="col-xs-7 col-sm-8"></paper-input>\n    <paper-fab id="do-admin-search" icon="search" raisedButton class="materialblue"></paper-fab>\n    <paper-fab id="do-admin-add" icon="add" raisedButton class="materialblue"></paper-fab>\n  </div>\n</form>\n<div id=\'search-results\' class="row"></div>',$("#admin-actions-block").html(c),$("#admin-search-form").submit(function(a){return a.preventDefault()}),$("#admin-search").keypress(function(a){return 13===a.which?renderAdminSearchResults():void 0}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),$("#do-admin-add").click(function(){return createNewTaxon()}),bindClickTargets(),!1})}catch(b){a=b,$("article").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(a){var b,c,d,e;return c=$.cookie("ssarherps_auth"),e=$.cookie("ssarherps_secret"),d=$.cookie("ssarherps_link"),b="hash="+c+"&secret="+e+"&dblink="+d,$.post(adminParams.loginApiTarget,b,"json").done(function(b){return b.status===!0?a(b):goTo(b.login_url)}).fail(function(a,b){return $("article").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p>'</div>"),console.log(a,b),!1}),!1},renderAdminSearchResults=function(a){var b,c,d,e;return null==a&&(a="#search-results"),e=$("#admin-search").val(),isNull(e)?(toastStatusMessage("Please enter a search term"),!1):(animateLoad(),$("#admin-search").blur(),e=e.replace(/\./g,""),e=prepURI(e.toLowerCase()),b="q="+e+"&loose=true",c=Base64.encodeURI(e),d=""+uri.urlString+"#"+c,$("#app-linkout").attr("data-url",d),$.get(searchParams.targetApi,b,"json").done(function(b){var c,d,e,f,g,h,i;return b.status!==!0||0===b.count?(stopLoadError(),isNull(b.human_error)?toastStatusMessage("Your search returned no results. Please try again."):toastStatusMessage(b.human_error),!1):(e=b.result,f="",h="<table id='cndb-result-list' class='table table-striped table-hover'>\n	<tr class='cndb-row-headers'>",g="</table>",i=toInt(b.count)-1,d=null,c=0,$.each(e,function(b,e){var j,k,l,m;return 0===toInt(b)&&(k=0,h+="\n<!-- Table Headers - "+Object.size(e)+" entries -->",$.each(e,function(a){var b,f;return f=a.replace(/_/g," "),("genus"===a||"species"===a||"subspecies"===a)&&(h+="\n		<th class='text-center'>"+f+"</th>",c++),k++,k===Object.size(e)?(h+="\n		<th class='text-center'>Edit</th>",c++,h+="\n		<th class='text-center'>Delete</th>\n	</tr>",c++,h+="\n<!-- End Table Headers -->",console.log("Got "+c+" display columns."),b=roundNumber(12/c,0),d="col-md-"+b):void 0})),m=""+e.genus.trim()+"+"+e.species.trim(),isNull(e.subspecies)||(m=""+m+"+"+e.subspecies.trim()),j="\n	<tr id='cndb-row"+b+"' class='cndb-result-entry' data-taxon=\""+m+'">',l=0,$.each(e,function(a,c){return isNull(e.genus)?!0:(("genus"===a||"species"===a||"subspecies"===a)&&(j+="\n		<td id='"+a+"-"+b+"' class='"+a+" "+d+"'>"+c+"</td>"),l++,l===Object.size(e)?(j+="\n		<td id='edit-"+b+"' class='edit-taxon "+d+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+m+"'></paper-icon-button></td>",j+="\n		<td id='delete-"+b+"' class='delete-taxon "+d+" text-center'><paper-icon-button icon='delete' class='delete-taxon-button fadebg' data-taxon='"+m+"' data-database-id='"+e.id+"'></paper-icon-button></td>",j+="\n	</tr>",f+=j):void 0)}),toInt(b)===i?(f=h+f+g,$(a).html(f),console.log("Processed "+(toInt(b)+1)+" rows"),$(".edit").click(function(){var a;return a=$(this).attr("data-taxon"),lookupEditorSpecies(a)}),$(".delete-taxon-button").click(function(){var a,b;return b=$(this).attr("data-taxon"),a=$(this).attr("data-database-id"),deleteTaxon(a)}),stopLoad()):void 0}))}).fail(function(a){var b;return console.error("There was an error performing the search"),console.warn(a,b,a.statusText),b=""+a.status+" - "+a.statusText,$("#search-status").attr("text","Couldn't execute the search - "+b),$("#search-status")[0].show(),stopLoadError()}))},loadModalTaxonEditor=function(a,b){var c,d,e,f;null==a&&(a=""),null==b&&(b="Save"),d='<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input>\n<paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input>\n<paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input>\n<paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input>\n<paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp"></paper-input>\n  <span class="help-block" id="deprecatedHelp">List names here in the form <span class="code">"Genus species":"Authority: year","Genus species":"Authority: year",[...]</span>.<br/>There should be no spaces between the quotes and comma or colon. If there are, it may not save correctly.</span>\n<paper-input label="Clade" class="capitalize" id="edit-major-type" name="edit-major-type" floatingLabel></paper-input>\n<paper-input label="Subtype" class="capitalize" id="edit-major-subtype" name="edit-major-subtype" floatingLabel></paper-input>\n<paper-input label="Minor clade / \'Family\'" id="edit-minor-type" name="edit-minor-type" floatingLabel></paper-input>\n<paper-input label="Linnean Order" id="edit-linnean-order" name="edit-linnean-order" class="linnean_order" floatingLabel></paper-input>\n<paper-input label="Common Type (eg., \'lizard\')" id="edit-major-common-type" name="edit-major-common-type" class="major_common_type" floatingLabel></paper-input>\n<paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input>\n<paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input>\n<core-label>\n  Use Parenthesis for Genus Authority\n  <paper-toggle-button id="genus-authority-parens"  checked="false"></paper-toggle-button>\n</core-label>\n<paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input>\n<paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input>\n<core-label>\n  Use Parenthesis for Species Authority\n  <paper-toggle-button id="species-authority-parens" checked="false"></paper-toggle-button>\n</core-label>\n<br/><br/>\n<paper-autogrow-textarea id="edit-notes-autogrow" rows="5">\n  <textarea placeholder="Notes" id="edit-notes" name="edit-notes" aria-describedby="notes-help" rows="5"></textarea>\n</paper-autogrow-textarea>\n<span class="help-block" id="notes-help">You can write your notes in Markdown. (<a href="https://daringfireball.net/projects/markdown/syntax" "onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'">Official Full Syntax Guide</a>)</span>\n<div id="upload-image"></div>\n<span class="help-block" id="upload-image-help">You can drag and drop an image above, or enter its server path below.</span>\n<paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input>\n  <span class="help-block" id="imagehelp">The image path here should be relative to the <span class="code">public_html/cndb/</span> directory.</span>\n<paper-input label="Image Credit" id="edit-image-credit" name="edit-image-credit" floatingLabel></paper-input>\n<paper-input label="Image License" id="edit-image-license" name="edit-image-license" floatingLabel></paper-input>\n<paper-input label="Taxon Credit" id="edit-taxon-credit" name="edit-taxon-credit" floatingLabel aria-describedby="taxon-credit-help"></paper-input>\n  <span class="help-block" id="taxon-credit-help">This will be displayed as "Taxon information by [your entry]."</span>\n<paper-input label="Taxon Credit Date" id="edit-taxon-credit-date" name="edit-taxon-credit-date" floatingLabel></paper-input>\n'+a+'\n<input type="hidden" name="edit-taxon-author" id="edit-taxon-author" value="" />',e="<paper-action-dialog backdrop layered autoCloseDisabled closeSelector=\"#close-editor\" id='modal-taxon-edit'>\n  <div id='modal-taxon-editor'>\n    "+d+"\n  </div>\n  <paper-button id='close-editor' dismissive>Cancel</paper-button>\n  <paper-button id='duplicate-taxon' dismissive>Duplicate</paper-button>\n  <paper-button id='save-editor' affirmative>"+b+"</paper-button></paper-action-dialog>",$("#modal-taxon-edit").exists()&&$("#modal-taxon-edit").remove(),$("#search-results").after(e),handleDragDropImage();try{f=$("html /deep/ #edit-notes").get(0),$("html /deep/ #edit-notes-autogrow").attr("target",f)}catch(g){c=g;try{f=$("html >>> #edit-notes").get(0),$("html >>> #edit-notes-autogrow").attr("target",f)}catch(g){c=g;try{f=$("#edit-notes").get(0),$("#edit-notes-autogrow").attr("target",f)}catch(g){c=g,console.error("Couldn't bind autogrow")}}}$("#modal-taxon-edit").unbind();try{return $("html /deep/ #save-editor").unbind(),$("html /deep/ #duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})}catch(g){return c=g,$("html >>> #save-editor").unbind(),$("html >>> #duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})}},createNewTaxon=function(){var a,b;animateLoad(),loadModalTaxonEditor("","Create");try{$("html /deep/ #duplicate-taxon").remove()}catch(c){a=c,$("html >>> #duplicate-taxon").remove()}b=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname");try{$("html /deep/ #edit-taxon-author").attr("value",b)}catch(c){a=c,$("html >>> #edit-taxon-author").attr("value",b)}try{$("html /deep/ #save-editor").click(function(){return saveEditorEntry("new")})}catch(c){a=c,$("html >>> #save-editor").click(function(){return saveEditorEntry("new")})}return $("#modal-taxon-edit")[0].open(),stopLoad()},createDuplicateTaxon=function(){var a;animateLoad();try{try{$("html /deep/ #taxon-id").remove(),$("html /deep/ #last-edited-by").remove(),$("html /deep/ #duplicate-taxon").remove()}catch(b){a=b,$("html >>> #taxon-id").remove(),$("html >>> #last-edited-by").remove(),$("html >>> #duplicate-taxon").remove()}try{$("html /deep/ #save-editor").text("Create").unbind().click(function(){return saveEditorEntry("new")})}catch(b){a=b,$("html >>> #save-editor").text("Create").unbind().click(function(){return saveEditorEntry("new")})}delay(250,function(){return stopLoad()})}catch(b){a=b,stopLoadError("Unable to duplicate taxon"),console.error("Couldn't duplicate taxon! "+a.message);try{$("html /deep/ #modal-taxon-edit").get(0).close()}catch(b){a=b,$("html >>> #modal-taxon-edit").get(0).close()}}return!1},lookupEditorSpecies=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(null==a&&(a=void 0),null==a)return!1;if(animateLoad(),f="<p id=\"last-edited-by\">\n  Last edited by <span id=\"taxon-author-last\" class=\"capitalize\"></span>\n</p>\n<input type='hidden' name='taxon-id' id='taxon-id'/>",loadModalTaxonEditor(f),d$("#save-editor").click(function(){return saveEditorEntry()}),c=d$("#last-edited-by").exists(),c||d$("#axon-credit-help").after(f),h=void 0,g=void 0,b="q="+a,-1!==a.search(/\(/)){for(g={genus:"",species:"",subspecies:""},h={genus:"",species:"",subspecies:""},k=a.split("+"),e=0;e<k.length;){switch(l=k[e],console.log("Checking '"+l+"'"),toInt(e)){case 0:d=l.split("("),console.log("Looking at genus array",d),g.genus=d[0].trim(),h.genus=null!=d[1]?d[1].trim().slice(0,-1):d[0];break;case 1:i=l.split("("),console.log("Looking at species array",i),g.species=i[0].trim(),h.species=null!=i[1]?i[1].trim().slice(0,-1):i[0];break;case 2:j=l.split("("),console.log("Looking at ssp array",j),g.subspecies=j[0].trim(),h.subspecies=null!=j[1]?j[1].trim().slice(0,-1):j[0];break;default:console.error("K value of '"+e+"' didn't match 0,1,2!")}k[e]=l.trim(),e++}a=""+g.genus+"+"+g.species,isNull(g.subspecies)||(a+=g.subspecies),b="q="+a+"&loose=true",console.warn("Bad name! Calculated out:"),console.warn("Should be currently",h),console.warn("Was previously",g),console.warn("Pinging with",""+uri.urlString+searchParams.targetApi+"?q="+a)}return $.get(searchParams.targetApi,b,"json").done(function(b){var c,d,e,f;try{if(c=b.result[0],null==c)return stopLoadError("Sorry, there was a problem parsing the information for this taxon. If it persists, you may have to fix it manually."),console.error("No data returned for",""+searchParams.targetApi+"?q="+a),!1;try{c.deprecated_scientific=JSON.parse(c.deprecated_scientific)}catch(i){d=i}null!=g&&(toastStatusMessage("Bad information found. Please review and resave."),c.genus=h.genus,c.species=h.species,c.subspecies=h.subspecies,"object"!=typeof c.deprecated_scientific&&(c.deprecated_scientific={}),f=g.species,isNull(g.subspecies)||(f+=" "+g.subspecies),c.deprecated_scientific[""+g.genus.toTitleCase()+" "+f]="AUTHORITY: YEAR"),$.each(c,function(a,b){var c,e,f,g;try{"string"==typeof b&&(b=b.trim())}catch(h){d=h}return"id"===a&&$("#taxon-id").attr("value",b),"authority_year"===a?(g=parseTaxonYear(b),$("#edit-gauthyear").attr("value",g.genus),$("#edit-sauthyear").attr("value",g.species)):"parens_auth_genus"===a||"parens_auth_species"===a?(c=a.split("_").pop(),d$("#"+c+"-authority-parens").polymerChecked(toInt(b).toBool())):"taxon_author"===a?("null"===b||isNull(b)?($("#last-edited-by").remove(),console.warn("Removed #last-edited-by! Didn't have an author provided for column '"+a+"', giving '"+b+"'. It's probably the first edit to this taxon.")):d$("#taxon-author-last").text(b),f=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname"),d$("#edit-taxon-author").attr("value",f)):(e="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a&&(b=JSON.stringify(b).trim().replace(/\\/g,""),b=b.replace(/{/,""),b=b.replace(/}/,""),'""'===b&&(b="")),"notes"!==a?d$(e).attr("value",b):d$(e).text(b))});try{e=d$("#edit-notes").get(0),d$("#edit-notes-autogrow").get(0).update(e)}catch(i){d=i,console.error("Couldn't update autogrow size. Possibly related to","https://github.com/Polymer/paper-input/issues/182")}return $("#modal-taxon-edit")[0].open(),stopLoad()}catch(i){return d=i,stopLoadError(),toastStatusMessage("Unable to populate the editor for this taxon - "+d.message)}}).fail(function(){return stopLoadError(),toastStatusMessage("There was a server error populating this taxon. Please try again.")}),!1},saveEditorEntry=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;null==a&&(a="save"),p=["genus","species","subspecies","common-name","major-type","major-common-type","major-subtype","minor-type","linnean-order","genus-authority","species-authority","notes","image","image-credit","image-license","taxon-author","taxon-credit","taxon-credit-date"],z={},o=!1;try{$("html /deep/ paper-input /deep/ paper-input-decorator").removeAttr("isinvalid")}catch(J){m=J,$("html >>> paper-input-button >>> paper-input-decorator").removeAttr("isinvalid")}try{D=function(a,b){var c,d,e,f,g,h,i,j,k;if(null==b&&(b=!1),i=b?a:d$(a).val(),f=void 0,g=1707,e=new Date,h=e.getUTCFullYear()+1,d=/^[1-2][07-9]\d{2}$|^[1-2][07-9]\d{2} (\"|')[1-2][07-9]\d{2}\1$/,isNumber(i)&&i>g&&h>i||(d.test(i)?-1===i.search(" ")?f="This must be a valid year between "+g+" and "+h:(j=i.split(" "),g<(k=j[0])&&h>k||(f="The first year must be a valid year between "+g+" and "+h),c=j[1].replace(/(\"|')/g,""),c>g&&h>c||(f="The second year must be a valid year between "+g+" and "+h),i=i.replace(/'/g,'"')):f=-1===i.search(" ")?"This must be a valid year between "+g+" and "+h:"Nonstandard years must be of the form: YYYY 'YYYY', eg, 1801 '1802'"),null!=f){if(o=!0,console.warn(""+a+" failed its validity checks for "+i+"!"),b)throw Error(f);try{$("html /deep/ "+a+" /deep/ paper-input-decorator").attr("error",f).attr("isinvalid","isinvalid")}catch(l){m=l,$("html >>> "+a+" >>> paper-input-decorator").attr("error",f).attr("isinvalid","isinvalid")}}return i};try{q=D("#edit-gauthyear"),y=D("#edit-sauthyear"),console.log("Escape Completion State:",o)}catch(J){m=J,console.error("Unable to parse authority year! "+m.message),d=""}c={},c[q]=y,d=JSON.stringify(c)}catch(J){m=J,console.error("Failed to JSON parse the authority year - "+m.message),d=""}z.authority_year=d;try{if(i={},k=d$("#edit-deprecated-scientific").val(),isNull(k))l="";else{for(j=k.split('","'),H=0,I=j.length;I>H;H++)t=j[H],s=t.split('":"'),i[s[0].replace(/"/g,"")]=s[1].replace(/"/g,"");console.log("Validating",i);for(C in i){if(e=i[C],f=e.split(":"),console.log("Testing "+e,f),2!==f.length)throw Error("Authority string should have an authority and year seperated by a colon.");if(c=f[0].trim(),E=f[1].trim(),-1!==E.search(","))throw Error("Looks like there may be an extra space, or forgotten \", near '"+E+"'");G=D(E,!0),console.log("Validated",c,G)}if(l=JSON.stringify(i),l.replace(/[{}]/g,"")!==k)throw Error("Badly formatted entry - generated doesn't match read")}}catch(J){m=J,console.error("Failed to parse the deprecated scientifics - "+m.message+". They may be empty."),l="",n=""+m.message+". Check your formatting!";try{$("html /deep/ #edit-deprecated-scientific /deep/ paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}catch(J){m=J,$("html >>> #edit-deprecated-scientific >>> paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}o=!0,g="There was a problem with your formatting for the deprecated scientifics. Please check it and try again."}return z.deprecated_scientific=l,u=["notes","taxon_credit","image","image_credit","image_license"],w=["common-name","major-type","linnean-order","genus-authority","species-authority"],isNull(d$("#edit-image").val())||(w.push("image-credit"),w.push("image-license")),isNull(d$("#edit-taxon-credit").val())||w.push("taxon-credit-date"),$.each(p,function(a,b){var c,d,e,f,g,h;try{if(g="html /deep/ #edit-"+b,isNull($(g)))throw"Invalid Selector"}catch(i){m=i,g="html >>> #edit-"+b}switch(c=b.replace(/-/g,"_"),h=$(g).val().trim(),__indexOf.call(u,c)<0&&(h=h.toLowerCase()),b){case"genus":case"species":case"subspecies":if(n="This required field must have only letters",d="genus"===b||"species"===b?isNull(h):!1,/[^A-Za-z]/m.test(h)||d){try{$("html /deep/ #edit-"+b+" /deep/ paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}catch(i){m=i,$("html >>> #edit-"+b+" >>> paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}o=!0}break;case"common-name":case"major-type":case"linnean-order":case"genus-authority":case"species-authority":if(n="This cannot be empty",isNull(h)){try{$("html /deep/ #edit-"+b+" /deep/ paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}catch(i){m=i,$("html >>> #edit-"+b+" >>> paper-input-decorator").attr("error",n).attr("isinvalid","isinvalid")}o=!0}break;default:if(__indexOf.call(w,b)>=0&&(e="#edit-"+b,f="This must not be empty",("#edit-image-credit"===e||"#edit-image-license"===e)&&(f="This cannot be empty if an image is provided"),"#edit-taxon-credit-date"===e&&(f="If you have a taxon credit, it also needs a date"),isNull(h))){try{$("html /deep/ #edit-"+b+" /deep/ paper-input-decorator").attr("error",f).attr("isinvalid","isinvalid")}catch(i){m=i,$("html >>> #edit-"+b+" >>> paper-input-decorator").attr("error",f).attr("isinvalid","isinvalid")}o=!0}}return z[c]=h}),o?(animateLoad(),h=null!=g?g:"Bad characters in entry. Stopping ...",null==g&&(g="There was a problem with your entry. Please correct your entry and try again."),stopLoadError(g),console.error(h),!1):(z.id=d$("#taxon-id").val(),z.parens_auth_genus=d$("#genus-authority-parens").polymerChecked(),z.parens_auth_species=d$("#species-authority-parens").polymerChecked(),"save"!==a||isNumber(z.id)?(A=JSON.stringify(z),x=Base64.encodeURI(A),isNull(A)||isNull(x)?(animateLoad(),stopLoadError("The system was unable to parse this entry for the server. Please see the console for more details."),console.error("Unable to stringify the JSON!."),console.warn("The total save object so far is:",z),console.warn("Got the output string",saveSring),console.warn("Sending b64 string",x),!1):(r=$.cookie("ssarherps_auth"),B=$.cookie("ssarherps_secret"),v=$.cookie("ssarherps_link"),F="hash="+r+"&secret="+B+"&dblink="+v,b="perform="+a+"&"+F+"&data="+x,console.log("Going to save",z),console.log("Using mode '"+a+"'"),animateLoad(),$.post(adminParams.apiTarget,b,"json").done(function(a){if(a.status===!0){if(console.log("Server returned",a),o)return console.error("Warning! The item saved, even though it wasn't supposed to."),!1;try{$("html /deep/ #modal-taxon-edit")[0].close()}catch(c){m=c,$("html >>> #modal-taxon-edit")[0].close()}return isNull($("#admin-search").val())||renderAdminSearchResults(),!1}return stopLoadError(),toastStatusMessage(a.human_error),console.error(a.error),console.warn("Server returned",a),console.warn("We sent",""+uri.urlString+adminParams.apiTarget+"?"+b),!1}).fail(function(){return stopLoadError("Failed to send the data to the server."),console.error("Server error! We sent",""+uri.urlString+adminParams.apiTarget+"?"+b),!1}))):(animateLoad(),stopLoadError("The system was unable to generate a valid taxon ID for this entry. Please see the console for more details."),console.error("Unable to get a valid, numeric taxon id! We got '"+z.id+"'."),console.warn("The total save object so far is:",z),!1))},deleteTaxon=function(a){var b,c,d,e,f;return c=$(".delete-taxon .delete-taxon-button[data-database-id='"+a+"']"),f=c.attr("data-taxon").replace(/\+/g," "),e=f.substr(0,1).toUpperCase()+f.substr(1),c.hasClass("extreme-danger")?null!=window.deleteWatchTimer?(d=Date.now()-window.deleteWatchTimer,console.warn("The taxon was asked to be deleted "+d+"ms after the confirmation was prompted. Rejecting ..."),!1):(animateLoad(),b="perform=delete&id="+a,$.post(adminParams.apiTarget,b,"json").done(function(b){return b.status===!0?(c.parents("tr").remove(),toastStatusMessage(""+e+" with ID "+a+" has been removed from the database."),stopLoad()):(stopLoadError(),toastStatusMessage(b.human_error),console.error(b.error),console.warn(b)),!1}).fail(function(){return stopLoadError(),toastStatusMessage("Failed to communicate with the server."),!1})):(window.deleteWatchTimer=Date.now(),delay(300,function(){return delete window.deleteWatchTimer}),c.addClass("extreme-danger"),delay(7500,function(){return c.removeClass("extreme-danger")}),toastStatusMessage("Click again to confirm deletion of "+e),!1)},handleDragDropImage=function(a,b){return null==a&&(a="#upload-image"),"function"!=typeof b&&(b=function(a,b){var c,d,e,f,g;if(b.status!==!0)return null==b.human_error&&(b.human_error="There was a problem uploading your image."),toastStatusMessage(b.human_error),console.error("Error uploading!",b),!1;try{e=a.name,ssar.dropzone.disable(),d=e.split(".").pop(),f=""+md5(e)+"."+d,g="species_photos/"+f,d$("#edit-image").attr("disabled","disabled").attr("value",g),toastStatusMessage("Upload complete")}catch(h){c=h,console.error("There was a problem with upload post-processing - "+c.message),console.warn("Using",e,b),toastStatusMessage("Your upload completed, but we couldn't post-process it.")}return!1}),loadJS("bower_components/JavaScript-MD5/js/md5.min.js"),loadJS("bower_components/dropzone/dist/min/dropzone.min.js",function(){var c,d,e,f,g;return c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href","css/dropzone.min.css"),document.getElementsByTagName("head")[0].appendChild(c),Dropzone.autoDiscover=!1,d="Drop a high-resolution image for the taxon here.",e=function(){return d$(a).css("box-shadow","").css("border",""),d$(""+a+" .dz-message span").text(d)},f={url:""+uri.urlString+"meta.php?do=upload_image",acceptedFiles:"image/*",autoProcessQueue:!0,maxFiles:1,dictDefaultMessage:d,init:function(){return this.on("error",function(){return toastStatusMessage("An error occured sending your image to the server.")}),this.on("canceled",function(){return toastStatusMessage("Upload canceled.")}),this.on("dragover",function(){return d$(""+a+" .dz-message span").text("Drop here to upload the image"),d$(a).css("box-shadow","0px 0px 15px rgba(15,157,88,.8)").css("border","1px solid #0F9D58")}),this.on("dragleave",function(){return e()}),this.on("dragend",function(){return e()}),this.on("drop",function(){return e()}),this.on("success",function(a,c){return b(a,c)})}},d$(a).hasClass("dropzone")||d$(a).addClass("dropzone"),g=new Dropzone(d$(a).get(0),f),ssar.dropzone=g}),!1},foo=function(){return toastStatusMessage("Sorry, this feature is not yet finished"),stopLoad(),!1},$(function(){return $("#next").exists()?$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}):void 0});
//# sourceMappingURL=maps/c.map