var adminParams,createDuplicateTaxon,createNewTaxon,deleteTaxon,handleDragDropImage,loadAdminUi,loadModalTaxonEditor,lookupEditorSpecies,renderAdminSearchResults,saveEditorEntry,verifyLoginCredentials,indexOf=[].indexOf||function(e){for(var t=0,a=this.length;t<a;t++)if(t in this&&this[t]===e)return t;return-1};(adminParams={}).apiTarget="admin_api.php",adminParams.adminPageUrl="https://ssarherps.org/cndb/admin-page.html",adminParams.loginDir="admin/",adminParams.loginApiTarget=adminParams.loginDir+"async_login_handler.php",loadAdminUi=function(){try{verifyLoginCredentials(function(e){var t,a;return t="<h3>\n  Welcome, "+$.cookie("ssarherps_name")+'\n  <span id="pib-wrapper-settings" class="pib-wrapper" data-toggle="tooltip" title="User Settings" data-placement="bottom">\n    <paper-icon-button icon=\'settings-applications\' class=\'click\' data-url=\''+e.login_url+'\'></paper-icon-button>\n  </span>\n  <span id="pib-wrapper-exit-to-app" class="pib-wrapper" data-toggle="tooltip" title="Go to CNDB app" data-placement="bottom">\n    <paper-icon-button icon=\'exit-to-app\' class=\'click\' data-url=\''+uri.urlString+"' id=\"app-linkout\"></paper-icon-button>\n  </span>\n</h3>\n<div id='admin-actions-block'>\n  <div class='bs-callout bs-callout-info'>\n    <p>Please be patient while the administrative interface loads.</p>\n  </div>\n</div>",$("article #main-body").html(t),bindClicks(),a='<form id="admin-search-form" onsubmit="event.preventDefault()" class="row">\n  <div>\n    <paper-input label="Search for species" id="admin-search" name="admin-search" required autofocus floatingLabel class="col-xs-7 col-sm-8"></paper-input>\n    <paper-fab id="do-admin-search" icon="search" raisedButton class="materialblue"></paper-fab>\n    <paper-fab id="do-admin-add" icon="add" raisedButton class="materialblue"></paper-fab>\n  </div>\n</form>\n<div id=\'search-results\' class="row"></div>',$("#admin-actions-block").html(a),$("#admin-search-form").submit(function(e){return e.preventDefault()}),$("#admin-search").keypress(function(e){if(13===e.which)return renderAdminSearchResults()}),$("#do-admin-search").click(function(){return renderAdminSearchResults()}),$("#do-admin-add").click(function(){return createNewTaxon()}),bindClickTargets(),!1})}catch(e){e,$("article #main-body").html("<div class='bs-callout bs-callout-danger'><h4>Application Error</h4><p>There was an error in the application. Please refresh and try again. If this persists, please contact administration.</p></div>")}return!1},verifyLoginCredentials=function(e){var t,a,r,n;return a=$.cookie("ssarherps_auth"),n=$.cookie("ssarherps_secret"),r=$.cookie("ssarherps_link"),t="hash="+a+"&secret="+n+"&dblink="+r,$.post(adminParams.loginApiTarget,t,"json").done(function(t){return!0===t.status?e(t):goTo(t.login_url)}).fail(function(e,t){return $("article #main-body").html("<div class='bs-callout-danger bs-callout'><h4>Couldn't verify login</h4><p>There's currently a server problem. Try back again soon.</p>'</div>"),console.log(e,t),!1}),!1},renderAdminSearchResults=function(e){var t,a,r,n;return null==e&&(e="#search-results"),n=$("#admin-search").val(),isNull(n)?(toastStatusMessage("Please enter a search term"),!1):(animateLoad(),$("#admin-search").blur(),n=n.replace(/\./g,""),n=prepURI(n.toLowerCase()),t="q="+n+"&loose=true",a=Base64.encodeURI(n),r=uri.urlString+"#"+a,$("#app-linkout").attr("data-url",r),$.get(searchParams.targetApi,t,"json").done(function(t){var a,r,n,i,o,s;return!0!==t.status||0===t.count?(stopLoadError(),isNull(t.human_error)?toastStatusMessage("Your search returned no results. Please try again."):toastStatusMessage(t.human_error),!1):(n=t.result,i="",o="<table id='cndb-result-list' class='table table-striped table-hover'>\n\t<tr class='cndb-row-headers'>","</table>",s=toInt(t.count)-1,r=null,a=0,$.each(n,function(t,n){var l,d,c,p;if(0===toInt(t)&&(d=0,o+="\n\x3c!-- Table Headers - "+Object.size(n)+" entries --\x3e",$.each(n,function(e,t){var i,s;if(s=e.replace(/_/g," "),"genus"!==e&&"species"!==e&&"subspecies"!==e||(o+="\n\t\t<th class='text-center'>"+s+"</th>",a++),++d===Object.size(n))return o+="\n\t\t<th class='text-center'>Edit</th>",a++,o+="\n\t\t<th class='text-center'>Delete</th>\n\t</tr>",a++,o+="\n\x3c!-- End Table Headers --\x3e",console.log("Got "+a+" display columns."),i=roundNumber(12/a,0),r="col-md-"+i})),p=n.genus.trim()+"+"+n.species.trim(),isNull(n.subspecies)||(p=p+"+"+n.subspecies.trim()),l="\n\t<tr id='cndb-row"+t+"' class='cndb-result-entry' data-taxon=\""+p+'">',c=0,$.each(n,function(e,a){return!!isNull(n.genus)||("genus"!==e&&"species"!==e&&"subspecies"!==e||(l+="\n\t\t<td id='"+e+"-"+t+"' class='"+e+" "+r+"'>"+a+"</td>"),++c===Object.size(n)?(l+="\n\t\t<td id='edit-"+t+"' class='edit-taxon "+r+" text-center'><paper-icon-button icon='image:edit' class='edit' data-taxon='"+p+"'></paper-icon-button></td>",l+="\n\t\t<td id='delete-"+t+"' class='delete-taxon "+r+" text-center'><paper-icon-button icon='delete' class='delete-taxon-button fadebg' data-taxon='"+p+"' data-database-id='"+n.id+"'></paper-icon-button></td>",l+="\n\t</tr>",i+=l):void 0)}),toInt(t)===s)return i=o+i+"</table>",$(e).html(i),console.log("Processed "+(toInt(t)+1)+" rows"),$(".edit").click(function(){var e;return e=$(this).attr("data-taxon"),lookupEditorSpecies(e)}),$(".delete-taxon-button").click(function(){var e;return $(this).attr("data-taxon"),e=$(this).attr("data-database-id"),deleteTaxon(e)}),stopLoad()}))}).fail(function(e,t){var a;return console.error("There was an error performing the search"),console.warn(e,a,e.statusText),a=e.status+" - "+e.statusText,$("#search-status").attr("text","Couldn't execute the search - "+a),$("#search-status")[0].show(),stopLoadError()}))},loadModalTaxonEditor=function(e,t){var a,r;return null==e&&(e=""),null==t&&(t="Save"),a='<paper-input label="Genus" id="edit-genus" name="edit-genus" class="genus" floatingLabel></paper-input>\n<paper-input label="Species" id="edit-species" name="edit-species" class="species" floatingLabel></paper-input>\n<paper-input label="Subspecies" id="edit-subspecies" name="edit-subspecies" class="subspecies" floatingLabel></paper-input>\n<iron-label>\n  Alien species?\n  <paper-toggle-button id="is-alien"  checked="false"></paper-toggle-button>\n</iron-label>\n<paper-input label="Common Name" id="edit-common-name" name="edit-common-name"  class="common_name" floatingLabel></paper-input>\n<paper-input label="Deprecated Scientific Names" id="edit-deprecated-scientific" name="edit-depreated-scientific" floatingLabel aria-describedby="deprecatedHelp"></paper-input>\n  <span class="help-block" id="deprecatedHelp">List names here in the form <span class="code">"Genus species":"Authority: year","Genus species":"Authority: year",[...]</span>.<br/>There should be no spaces between the quotes and comma or colon. If there are, it may not save correctly.</span>\n<paper-input label="Clade" class="capitalize" id="edit-major-type" name="edit-major-type" floatingLabel></paper-input>\n<paper-input label="Subtype" class="capitalize" id="edit-major-subtype" name="edit-major-subtype" floatingLabel></paper-input>\n<paper-input label="Minor clade / \'Family\'" id="edit-minor-type" name="edit-minor-type" floatingLabel></paper-input>\n<paper-input label="Linnean Order" id="edit-linnean-order" name="edit-linnean-order" class="linnean_order" floatingLabel></paper-input>\n<paper-input label="Common Type (eg., \'lizard\')" id="edit-major-common-type" name="edit-major-common-type" class="major_common_type" floatingLabel></paper-input>\n<paper-input label="Genus authority" id="edit-genus-authority" name="edit-genus-authority" class="genus_authority" floatingLabel></paper-input>\n<paper-input label="Genus authority year" id="edit-gauthyear" name="edit-gauthyear" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Genus Authority\n  <paper-toggle-button id="genus-authority-parens"  checked="false"></paper-toggle-button>\n</iron-label>\n<paper-input label="Species authority" id="edit-species-authority" name="edit-species-authority" class="species_authority" floatingLabel></paper-input>\n<paper-input label="Species authority year" id="edit-sauthyear" name="edit-sauthyear" floatingLabel></paper-input>\n<iron-label>\n  Use Parenthesis for Species Authority\n  <paper-toggle-button id="species-authority-parens" checked="false"></paper-toggle-button>\n</iron-label>\n<br/><br/>\n<iron-autogrow-textarea id="edit-notes" rows="5" aria-describedby="notes-help" placeholder="Notes">\n  <textarea placeholder="Notes" id="edit-notes-textarea" name="edit-notes-textarea" aria-describedby="notes-help" rows="5"></textarea>\n</iron-autogrow-textarea>\n<span class="help-block" id="notes-help">You can write your notes in Markdown. (<a href="https://daringfireball.net/projects/markdown/syntax" "onclick=\'window.open(this.href); return false;\' onkeypress=\'window.open(this.href); return false;\'">Official Full Syntax Guide</a>)</span>\n<div id="upload-image"></div>\n<span class="help-block" id="upload-image-help">You can drag and drop an image above, or enter its server path below.</span>\n<paper-input label="Image" id="edit-image" name="edit-image" floatingLabel aria-describedby="imagehelp"></paper-input>\n  <span class="help-block" id="imagehelp">The image path here should be relative to the <span class="code">public_html/cndb/</span> directory.</span>\n<paper-input label="Image Credit" id="edit-image-credit" name="edit-image-credit" floatingLabel></paper-input>\n<paper-input label="Image License" id="edit-image-license" name="edit-image-license" floatingLabel></paper-input>\n<paper-input label="Taxon Credit" id="edit-taxon-credit" name="edit-taxon-credit" floatingLabel aria-describedby="taxon-credit-help"></paper-input>\n  <span class="help-block" id="taxon-credit-help">This will be displayed as "Taxon information by [your entry]."</span>\n<paper-input label="Taxon Credit Date" id="edit-taxon-credit-date" name="edit-taxon-credit-date" floatingLabel></paper-input>\n'+e+'\n<input type="hidden" name="edit-taxon-author" id="edit-taxon-author" value="" />',r='<paper-dialog modal id=\'modal-taxon-edit\' entry-animation="scale-up-animation" exit-animation="fade-out-animation">\n  <h2 id="editor-title">Taxon Editor</h2>\n  <paper-dialog-scrollable id=\'modal-taxon-editor\'>\n    '+a+"\n  </paper-dialog-scrollable>\n  <div class=\"buttons\">\n    <paper-button id='close-editor' dialog-dismiss>Cancel</paper-button>\n    <paper-button id='duplicate-taxon'>Duplicate</paper-button>\n    <paper-button id='save-editor'>"+t+"</paper-button>\n  </div>\n</paper-dialog>",$("#modal-taxon-edit").exists()&&$("#modal-taxon-edit").remove(),$("#search-results").after(r),handleDragDropImage(),$("#modal-taxon-edit").unbind(),d$("#save-editor").unbind(),d$("#duplicate-taxon").unbind().click(function(){return createDuplicateTaxon()})},createNewTaxon=function(){var e,t;return animateLoad(),loadModalTaxonEditor("","Create"),d$("#editor-title").text("Create New Taxon"),t=.5*$(window).height(),d$("#modal-taxon-editor").css("min-height",t+"px"),d$("#modal-taxon-editor div.scrollable").css("max-height",""),d$("#modal-taxon-edit").addClass("create-new-taxon"),d$("#duplicate-taxon").remove(),e=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname"),d$("#edit-taxon-author").attr("value",e),d$("#save-editor").click(function(){return saveEditorEntry("new")}),$("#modal-taxon-edit").get(0).open(),stopLoad()},createDuplicateTaxon=function(){var e,t;animateLoad();try{d$("#taxon-id").remove(),d$("#last-edited-by").remove(),d$("#duplicate-taxon").remove(),d$("#editor-title").text("Create Duplicate Taxon"),t='<paper-button id="save-editor">Create</paper-button>',d$("#save-editor").replaceWith(t),d$("#save-editor").click(function(){return saveEditorEntry("new")}),delay(250,function(){return stopLoad()})}catch(t){e=t,stopLoadError("Unable to duplicate taxon"),console.error("Couldn't duplicate taxon! "+e.message),d$("#modal-taxon-edit").get(0).close()}return!0},lookupEditorSpecies=function(e){var t,a,r,n,i,o,s,l,d,c;if(null==e&&(e=void 0),null==e)return!1;if(animateLoad(),n="<p id=\"last-edited-by\">\n  Last edited by <span id=\"taxon-author-last\" class=\"capitalize\"></span>\n</p>\n<input type='hidden' name='taxon-id' id='taxon-id'/>",loadModalTaxonEditor(n),d$("#save-editor").click(function(){return saveEditorEntry()}),d$("#last-edited-by").exists()||d$("#taxon-credit-help").after(n),o=void 0,i=void 0,t="q="+e,-1!==e.search(/\(/)){for(i={genus:"",species:"",subspecies:""},o={genus:"",species:"",subspecies:""},d=e.split("+"),r=0;r<d.length;){switch(c=d[r],console.log("Checking '"+c+"'"),toInt(r)){case 0:a=c.split("("),console.log("Looking at genus array",a),i.genus=a[0].trim(),o.genus=null!=a[1]?a[1].trim().slice(0,-1):a[0];break;case 1:s=c.split("("),console.log("Looking at species array",s),i.species=s[0].trim(),o.species=null!=s[1]?s[1].trim().slice(0,-1):s[0];break;case 2:l=c.split("("),console.log("Looking at ssp array",l),i.subspecies=l[0].trim(),o.subspecies=null!=l[1]?l[1].trim().slice(0,-1):l[0];break;default:console.error("K value of '"+r+"' didn't match 0,1,2!")}d[r]=c.trim(),r++}e=i.genus+"+"+i.species,isNull(i.subspecies)||(e+=i.subspecies),t="q="+e+"&loose=true",console.warn("Bad name! Calculated out:"),console.warn("Should be currently",o),console.warn("Was previously",i),console.warn("Pinging with",""+uri.urlString+searchParams.targetApi+"?q="+e)}return $.get(searchParams.targetApi,t,"json").done(function(t){var a,r,n,s,l,d,c,p,u,m,h,g,b;try{if(null==(n=t.result[0]))return stopLoadError("Sorry, there was a problem parsing the information for this taxon. If it persists, you may have to fix it manually."),console.error("No data returned for",searchParams.targetApi+"?q="+e),!1;try{n.deprecated_scientific=JSON.parse(n.deprecated_scientific)}catch(e){s=e}null!=i&&(toastStatusMessage("Bad information found. Please review and resave."),n.genus=o.genus,n.species=o.species,n.subspecies=o.subspecies,"object"!=typeof n.deprecated_scientific&&(n.deprecated_scientific={}),c=i.species,isNull(i.subspecies)||(c+=" "+i.subspecies),n.deprecated_scientific[i.genus.toTitleCase()+" "+c]="AUTHORITY: YEAR"),m=["parens_auth_genus","parens_auth_species","is_alien"];for(a in n){r=n[a];try{"string"==typeof r&&(r=r.trim())}catch(e){s=e}if("id"===a&&$("#taxon-id").attr("value",r),"authority_year"===a)b=parseTaxonYear(r),$("#edit-gauthyear").attr("value",b.genus),$("#edit-sauthyear").attr("value",b.species);else if(indexOf.call(m,a)>=0)p="parens"===a.split("_")[0]?"#"+a.split("_").pop()+"-authority-parens":"#"+a.replace(/_/g,"-"),d$(p).polymerChecked(toInt(r).toBool());else if("taxon_author"===a)"null"===r||isNull(r)?($("#last-edited-by").remove(),console.warn("Removed #last-edited-by! Didn't have an author provided for column '"+a+"', giving '"+r+"'. It's probably the first edit to this taxon.")):d$("#taxon-author-last").text(r),h=isNull($.cookie("ssarherps_fullname"))?$.cookie("ssarherps_user"):$.cookie("ssarherps_fullname"),d$("#edit-taxon-author").attr("value",h);else if(l="#edit-"+a.replace(/_/g,"-"),"deprecated_scientific"===a&&'""'===(r=(r=(r=JSON.stringify(r).trim().replace(/\\/g,"")).replace(/{/,"")).replace(/}/,""))&&(r=""),"notes"!==a)d$(l).attr("value",r);else{g=.9*$("#modal-taxon-edit").width(),d$(l).css("width",g+"px"),u=d$(l).get(0).textarea,$(u).text(r);try{d$(l).get(0)._update()}catch(e){s=e,console.warn("Couldn't update the textarea! See","https://github.com/PolymerElements/iron-autogrow-textarea/issues/24")}}}return d=$("#modal-taxon-edit")[0],$("#modal-taxon-edit").on("iron-overlay-opened",function(){return d.fit(),d.scrollTop=0,toFloat($(d).css("top").slice(0,-2))>$(window).height()&&$(d).css("top","12.5vh"),delay(250,function(){return d.fit()})}),d.sizingTarget=d$("#modal-taxon-editor")[0],safariDialogHelper("#modal-taxon-edit"),stopLoad()}catch(e){return s=e,stopLoadError("Unable to populate the editor for this taxon - "+s.message)}}).fail(function(e,t){return stopLoadError("There was a server error populating this taxon. Please try again.")}),!1},saveEditorEntry=function(e){var t,a,r,n,i,o,s,l,d,c,p,u,m,h,g,b,f,y,x,v,w,T,k,_,L,S,E,C,N,D,P,j,A,I,U,z,M,O,Y,R;null==e&&(e="save"),b=["genus","species","subspecies","common-name","major-type","major-common-type","major-subtype","minor-type","linnean-order","genus-authority","species-authority","notes","image","image-credit","image-license","taxon-author","taxon-credit","taxon-credit-date"],D={},g=!1,d$("paper-input").removeAttr("invalid");try{z=function(e,t){var a,r,n,i,o,s,l,d;if(null==t&&(t=!1),l=t?e:d$(e).val(),i=void 0,1707,n=new Date,o=n.getUTCFullYear()+1,r=/^[1-2][07-9]\d{2}$|^[1-2][07-9]\d{2} (\"|')[1-2][07-9]\d{2}\1$/,isNumber(l)&&1707<l&&l<o||(r.test(l)?-1===l.search(" ")?i="This must be a valid year between 1707 and "+o:(1707<(s=(d=l.split(" "))[0])&&s<o||(i="The first year must be a valid year between 1707 and "+o),1707<(a=d[1].replace(/(\"|')/g,""))&&a<o||(i="The second year must be a valid year between 1707 and "+o),l=l.replace(/'/g,'"')):i=-1===l.search(" ")?"This must be a valid year between 1707 and "+o:"Nonstandard years must be of the form: YYYY 'YYYY', eg, 1801 '1802'"),null!=i){if(g=!0,console.warn(e+" failed its validity checks for "+l+"!"),t)throw Error(i);d$(""+e).attr("error-message",i).attr("invalid","invalid")}return l};try{f=z("#edit-gauthyear"),N=z("#edit-sauthyear"),console.log("Escape Completion State:",g)}catch(e){m=e,console.error("Unable to parse authority year! "+m.message),r=""}(a={})[f]=N,r=JSON.stringify(a)}catch(e){m=e,console.error("Failed to JSON parse the authority year - "+m.message),r=""}D.authority_year=r;try{if(d={},p=d$("#edit-deprecated-scientific").val(),isNull(p))u="";else{for(L=0,k=(c=p.split('","')).length;L<k;L++)d[(v=(w=c[L]).split('":"'))[0].replace(/"/g,"")]=v[1].replace(/"/g,"");console.log("Validating",d);for(U in d){if(n=d[U],i=n.split(":"),console.log("Testing "+n,i),2!==i.length)throw Error("Authority string should have an authority and year seperated by a colon.");if(a=i[0].trim(),-1!==(M=i[1].trim()).search(","))throw Error("Looks like there may be an extra space, or forgotten \", near '"+M+"'");R=z(M,!0),console.log("Validated",a,R)}if((u=JSON.stringify(d)).replace(/[{}]/g,"")!==p)throw Error("Badly formatted entry - generated doesn't match read")}}catch(e){m=e,console.error("Failed to parse the deprecated scientifics - "+m.message+". They may be empty."),u="",h=m.message+". Check your formatting!",d$("#edit-deprecated-scientific").attr("error-message",h).attr("invalid",!0),g=!0,s="There was a problem with your formatting for the deprecated scientifics. Please check it and try again."}D.deprecated_scientific=u,T=["notes","taxon_credit","image","image_credit","image_license"],E=["common-name","major-type","linnean-order","genus-authority","species-authority"],isNull(d$("#edit-image").val())||(E.push("image-credit"),E.push("image-license")),isNull(d$("#edit-taxon-credit").val())||E.push("taxon-credit-date");for(w in b){switch(x=b[w],o=x.replace(/-/g,"_"),Y="notes"!==o?d$("#edit-"+x).val().trim():d$("#edit-notes").get(0).textarea.value,indexOf.call(T,o)<0&&(Y=Y.toLowerCase()),x){case"genus":case"species":case"subspecies":h="This required field must have only letters",S=("genus"===x||"species"===x)&&isNull(Y),(/[^A-Za-z]/m.test(Y)||S)&&(d$("#edit-"+x).attr("error-message",h).attr("invalid","invalid"),g=!0);break;case"common-name":case"major-type":case"linnean-order":case"genus-authority":case"species-authority":h="This cannot be empty",isNull(Y)&&($("#edit-"+x).attr("error-message",h).attr("invalid","invalid"),g=!0);break;default:indexOf.call(E,x)>=0&&(I="This must not be empty","#edit-image-credit"!==(A="#edit-"+x)&&"#edit-image-license"!==A||(I="This cannot be empty if an image is provided"),"#edit-taxon-credit-date"===A&&(I="If you have a taxon credit, it also needs a date"),isNull(Y)&&(d$("#edit-"+x).attr("error-message",I).attr("invalid","invalid"),g=!0))}D[o]=Y}return g?(animateLoad(),l=null!=s?s:"Bad characters in entry. Stopping ...",null==s&&(s="There was a problem with your entry. Please correct your entry and try again."),stopLoadError(s),console.error(l),!0):(D.id=d$("#taxon-id").val(),D.parens_auth_genus=d$("#genus-authority-parens").polymerChecked(),D.parens_auth_species=d$("#species-authority-parens").polymerChecked(),D.is_alien=d$("#is-alien").polymerChecked(),"save"!==e||isNumber(D.id)?(P=JSON.stringify(D),C=Base64.encodeURI(P),isNull(P)||isNull(C)?(animateLoad(),stopLoadError("The system was unable to parse this entry for the server. Please see the console for more details."),console.error("Unable to stringify the JSON!."),console.warn("The total save object so far is:",D),console.warn("Got the output string",saveSring),console.warn("Sending b64 string",C),!0):(y=$.cookie("ssarherps_auth"),j=$.cookie("ssarherps_secret"),_=$.cookie("ssarherps_link"),O="hash="+y+"&secret="+j+"&dblink="+_,t="perform="+e+"&"+O+"&data="+C,console.log("Going to save",D),console.log("Using mode '"+e+"'"),animateLoad(),$.post(adminParams.apiTarget,t,"json").done(function(e){return!0===e.status?(console.log("Server returned",e),g?(console.error("Warning! The item saved, even though it wasn't supposed to."),!1):(d$("#modal-taxon-edit").get(0).close(),isNull($("#admin-search").val())||renderAdminSearchResults(),!1)):(stopLoadError(),toastStatusMessage(e.human_error),console.error(e.error),console.warn("Server returned",e),console.warn("We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1)}).fail(function(e,a){return stopLoadError("Failed to send the data to the server."),console.error("Server error! We sent",""+uri.urlString+adminParams.apiTarget+"?"+t),!1}))):(animateLoad(),stopLoadError("The system was unable to generate a valid taxon ID for this entry. Please see the console for more details."),console.error("Unable to get a valid, numeric taxon id! We got '"+D.id+"'."),console.warn("The total save object so far is:",D),!1))},deleteTaxon=function(e){var t,a,r,n,i;return a=$(".delete-taxon .delete-taxon-button[data-database-id='"+e+"']"),i=a.attr("data-taxon").replace(/\+/g," "),n=i.substr(0,1).toUpperCase()+i.substr(1),a.hasClass("extreme-danger")?null!=window.deleteWatchTimer?(r=Date.now()-window.deleteWatchTimer,console.warn("The taxon was asked to be deleted "+r+"ms after the confirmation was prompted. Rejecting ..."),!1):(animateLoad(),t="perform=delete&id="+e,$.post(adminParams.apiTarget,t,"json").done(function(t){return!0===t.status?(a.parents("tr").remove(),toastStatusMessage(n+" with ID "+e+" has been removed from the database."),stopLoad()):(stopLoadError(t.human_error),console.error(t.error),console.warn(t)),!1}).fail(function(e,t){return stopLoadError("Failed to communicate with the server."),!1})):(window.deleteWatchTimer=Date.now(),delay(300,function(){return delete window.deleteWatchTimer}),a.addClass("extreme-danger"),delay(7500,function(){return a.removeClass("extreme-danger")}),toastStatusMessage("Click again to confirm deletion of "+n),!1)},handleDragDropImage=function(e,t){return null==e&&(e="#upload-image"),"function"!=typeof t&&(t=function(e,t){var a,r,n,i;if(!0!==t.status)return null==t.human_error&&(t.human_error="There was a problem uploading your image."),toastStatusMessage(t.human_error),console.error("Error uploading!",t),!1;try{n=e.name,ssar.dropzone.disable(),r=n.split(".").pop(),i="species_photos/"+(md5(n)+"."+r),d$("#edit-image").attr("disabled","disabled").attr("value",i),toastStatusMessage("Upload complete")}catch(e){a=e,console.error("There was a problem with upload post-processing - "+a.message),console.warn("Using",n,t),toastStatusMessage("Your upload completed, but we couldn't post-process it.")}return!1}),loadJS("bower_components/JavaScript-MD5/js/md5.min.js"),loadJS("bower_components/dropzone/dist/min/dropzone.min.js",function(){var a,r,n,i,o;return(a=document.createElement("link")).setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","css/dropzone.min.css"),document.getElementsByTagName("head")[0].appendChild(a),Dropzone.autoDiscover=!1,r="Drop a high-resolution image for the taxon here.",n=function(){return d$(e).css("box-shadow","").css("border",""),d$(e+" .dz-message span").text(r)},i={url:uri.urlString+"meta.php?do=upload_image",acceptedFiles:"image/*",autoProcessQueue:!0,maxFiles:1,dictDefaultMessage:r,init:function(){return this.on("error",function(){return toastStatusMessage("An error occured sending your image to the server.")}),this.on("canceled",function(){return toastStatusMessage("Upload canceled.")}),this.on("dragover",function(){return d$(e+" .dz-message span").text("Drop here to upload the image"),d$(e).css("box-shadow","0px 0px 15px rgba(15,157,88,.8)").css("border","1px solid #0F9D58")}),this.on("dragleave",function(){return n()}),this.on("dragend",function(){return n()}),this.on("drop",function(){return n()}),this.on("success",function(e,a){return t(e,a)})}},d$(e).hasClass("dropzone")||d$(e).addClass("dropzone"),o=new Dropzone(d$(e).get(0),i),ssar.dropzone=o}),!1},$(function(){return $("#next").exists()&&$("#next").unbind().click(function(){return openTab(adminParams.adminPageUrl)}),loadJS("https://ssarherps.org/cndb/bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $("[data-toggle='tooltip']").tooltip()})});
//# sourceMappingURL=maps/c.map