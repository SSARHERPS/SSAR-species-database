function toObject(a){for(var b={},c=0;c<a.length;++c)void 0!==a[c]&&(b[c]=a[c]);return b}function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}var animateLoad,byteCount,checkMatchPassword,checkPasswordLive,delay,doAsyncCreate,doAsyncLogin,doEmailCheck,doRemoveAccountAction,doTOTPRemove,doTOTPSubmit,evalRequirements,finishPasswordResetHandler,giveAltVerificationOptions,isBlank,isBool,isEmpty,isJson,isNull,isNumber,loadJS,makeTOTP,mapNewWindows,noSubmit,popupSecret,removeAccount,resetPassword,root,roundNumber,saveTOTP,showAdvancedOptions,showInstructions,stopLoad,stopLoadError,toFloat,toInt,toggleNewUserSubmit,url,verifyPhone,_base,_base1,__slice=[].slice;root="undefined"!=typeof exports&&null!==exports?exports:this,isBool=function(a){return a===!0||a===!1},isEmpty=function(a){return!a||0===a.length},isBlank=function(a){return!a||/^\s*$/.test(a)},isNull=function(a){try{if((isEmpty(a)||isBlank(a)||null==a)&&a!==!1&&0!==a)return!0}catch(b){}return!1},isJson=function(a){if("object"==typeof a)return!0;try{return JSON.parse(a),!0}catch(b){}return!1},isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},toFloat=function(a){return!isNumber(a)||isNull(a)?0:parseFloat(a)},toInt=function(a){return!isNumber(a)||isNull(a)?0:parseInt(a)},String.prototype.toBool=function(){return"true"===this.toString()},Boolean.prototype.toBool=function(){return"true"===this.toString()},Object.size=function(a){var b,c;c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},delay=function(a,b){return setTimeout(b,a)},roundNumber=function(a,b){var c;return null==b&&(b=0),c=Math.pow(10,b),Math.round(a*c)/c},jQuery.fn.exists=function(){return jQuery(this).length>0},jQuery.fn.isVisible=function(){return"none"!==jQuery(this).css("display")},jQuery.fn.hasChildren=function(){return Object.size(jQuery(this).children())>3},byteCount=function(){return function(a){return encodeURI(a).split(/%..|./).length-1}}(this),window.debounce_timer=null,Function.prototype.debounce=function(){var a,b,c,d,e,f,g;if(f=arguments[0],d=arguments[1],g=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[],null==f&&(f=300),null==d&&(d=!1),null==g&&(g=window.debounce_timer),e=this,b=function(){return d||e.apply(e,a),console.log("Debounce applied")},null!=g)try{clearTimeout(g)}catch(h){c=h}else d&&(e.apply(obj,a),console.log("Executed immediately"));return window.debounce_timer=setTimeout(b,f)},loadJS=function(a,b,c){var d,e,f,g;if(null==b&&(b=new Object),null==c&&(c=!0),$("script[src='"+a+"']").exists()){if("function"==typeof b)try{b()}catch(h){d=h,console.error("Script is already loaded, but there was an error executing the callback function - "+d.message)}return!0}return g=document.createElement("script"),g.setAttribute("src",a),g.setAttribute("async","async"),g.setAttribute("type","text/javascript"),g.src=a,g.async=!0,f=function(){var a;a=g.readyState;try{if(!b.done&&(!a||/loaded|complete/.test(a))&&(b.done=!0,"function"==typeof b))try{return b()}catch(c){return d=c,console.error("Postload callback error - "+d.message)}}catch(c){return d=c,console.error("Onload error - "+d.message)}},e=function(){console.warn("There may have been a problem loading "+a);try{if(!b.done&&(b.done=!0,"function"==typeof b&&c))try{return b()}catch(e){return d=e,console.error("Post error callback error - "+d.message)}}catch(e){return d=e,console.error("There was an error in the error handler! "+d.message)}},g.setAttribute("onload",f),g.setAttribute("onreadystate",f),g.setAttribute("onerror",e),g.onload=g.onreadystate=f,g.onerror=e,document.getElementsByTagName("head")[0].appendChild(g),!0},mapNewWindows=function(){return $(".newwindow").each(function(){var a,b;return a=$(this).attr("href"),b=function(a){return null==a?!1:(window.open(a),!1)},$(this).click(function(){return b(a)}),$(this).keypress(function(){return b(a)})})},animateLoad=function(a,b){var c,d,e,f,g,h;null==a&&(a=50),null==b&&(b="#status-container");try{return $(b).exists()?(g=roundNumber(.5*a),c=$(b).find(".ball"),h=$(b).find(".ball1"),c.removeClass("stop hide"),c.css({width:""+a+"px",height:""+a+"px"}),e=roundNumber(a/2+g/2+9),f=roundNumber((a+10)/2-(g+6)/2),h.removeClass("stop hide"),h.css({width:""+g+"px",height:""+g+"px",top:"-"+e+"px","margin-left":""+f+"px"}),!0):!1}catch(i){return d=i,console.log("Could not animate loader",d.message)}},stopLoad=function(a){var b,c,d;null==a&&(a="#status-container");try{if($(a).exists())return b=$(a).find(".ball"),d=$(a).find(".ball1"),b.addClass("bballgood ballgood"),d.addClass("bballgood ball1good"),delay(250,function(){return b.addClass("stop hide"),b.removeClass("bballgood ballgood"),d.addClass("stop hide"),d.removeClass("bballgood ballgood")})}catch(e){return c=e,console.log("Could not stop load animation",c.message)}},stopLoadError=function(a){var b,c,d;null==a&&(a="#status-container");try{if($(a).exists())return b=$(a).find(".ball"),d=$(a).find(".ball1"),b.addClass("bballerror ballerror"),d.addClass("bballerror ball1error"),delay(1500,function(){return b.addClass("stop hide"),b.removeClass("bballerror ballerror"),d.addClass("stop hide"),d.removeClass("bballerror ballerror")})}catch(e){return c=e,console.log("Could not stop load error animation",c.message)}},$(function(){var a,b,c;try{"function"==typeof picturefill&&window.picturefill()}catch(d){a=d,console.warn("Could not execute picturefill.")}mapNewWindows();try{null==(b=window.totpParams).tfaLock&&(b.tfaLock=!1),null==window.latejs&&(window.latejs=new Object),null==(c=window.latejs).done&&(c.done=!1),window.latejs.done!==!0&&window.totpParams.tfaLock!==!0&&"function"==typeof lateJS&&lateJS()}catch(d){a=d,console.warn("There was an error calling lateJS(). If you haven't set that up, you can safely ignore this.")}try{if("function"==typeof loadLast)return loadLast()}catch(d){return a=d,console.warn("There was an error calling loadLast(). This may result in unexpected behaviour.")}}),"object"!=typeof window.passwords&&(window.passwords=new Object),window.passwords.goodbg="#cae682",window.passwords.badbg="#e5786d",null==(_base=window.passwords).minLength&&(_base.minLength=8),null==(_base1=window.passwords).overrideLength&&(_base1.overrideLength=20),"object"!=typeof window.totpParams&&(window.totpParams=new Object),window.totpParams.popClass="pop-panel",null==window.totpParams.home&&(url=$.url(),window.totpParams.home=url.attr("protocol")+"://"+url.attr("host")+"/"),null==window.totpParams.relative&&(window.totpParams.relative=""),null==window.totpParams.subdirectory&&(window.totpParams.subdirectory=""),window.totpParams.mainStylesheetPath=window.totpParams.relative+"css/otp_styles.css",window.totpParams.popStylesheetPath=window.totpParams.relative+"css/otp_panels.css",window.totpParams.combinedStylesheetPath=window.totpParams.relative+"css/otp.min.css",checkPasswordLive=function(a){var b,c;return null==a&&(a="#createUser_submit"),b=$("#password").val(),c=new RegExp("^(?:(?=^.{"+window.passwords.minLength+",}$)((?=.*\\d)|(?=.*\\W+))(?![.\\n])(?=.*[A-Z])(?=.*[a-z]).*$)$"),b.length>window.passwords.overrideLength||b.match(c)?($("#password").css("background",window.passwords.goodbg).parent().parent().removeClass("has-error").addClass("has-success"),$("#feedback-status-1").replaceWith("<span id='feedback-status-1' class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>"),window.passwords.basepwgood=!0):($("#password").css("background",window.passwords.badbg).parent().parent().removeClass("has-success").addClass("has-error"),$("#feedback-status-1").replaceWith("<span id='feedback-status-1' class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>"),window.passwords.basepwgood=!1),evalRequirements(),isNull($("#password2").val())||(checkMatchPassword(a),toggleNewUserSubmit(a)),!1},checkMatchPassword=function(a){return null==a&&(a="#createUser_submit"),$("#password").val()===$("#password2").val()?($("#password2").css("background",window.passwords.goodbg).parent().parent().removeClass("has-error").addClass("has-success"),$("#feedback-status-2").replaceWith("<span id='feedback-status-2' class='glyphicon glyphicon-ok form-control-feedback' aria-hidden='true'></span>"),window.passwords.passmatch=!0):($("#password2").css("background",window.passwords.badbg).parent().parent().removeClass("has-success").addClass("has-error"),$("#feedback-status-2").replaceWith("<span id='feedback-status-2' class='glyphicon glyphicon-remove form-control-feedback' aria-hidden='true'></span>"),window.passwords.passmatch=!1),toggleNewUserSubmit(a),!1},toggleNewUserSubmit=function(a){var b,c;null==a&&(a="#createUser_submit");try{return b=!(window.passwords.passmatch&&window.passwords.basepwgood),$("#createUser_submit").attr("disabled",b)}catch(d){return c=d,window.passwords.passmatch=!1,window.passwords.basepwgood=!1}},evalRequirements=function(){var a,b,c,d,e,f,g,h,i;return $("#strength-meter").exists()||(b="<h4>Password Requirements</h4><div id='strength-meter'><div id='strength-requirements'><p style='float:left;margin-top:2em;font-weight:700;'>Character Classes:</p><div id='strength-alpha'><p class='label'>a</p><div class='strength-eval'></div></div><div id='strength-alphacap'><p class='label'>A</p><div class='strength-eval'></div></div><div id='strength-numspecial'><p class='label'>1/!</p><div class='strength-eval'></div></div></div><div id='strength-bar'><label for='password-strength'>Strength: </label><progress id='password-strength' max='5'></progress><p>Time to crack: <span id='crack-time'></span></p></div></div>",e="<br/><br/><p>We require a password of at least "+window.passwords.minLength+" characters with at least one upper case letter, at least one lower case letter, and at least one digit or special character.</p><p>You can also use <a href='http://imgs.xkcd.com/comics/password_strength.png'>any long password</a> of at least "+window.passwords.overrideLength+" characters, with no security requirements.</p>",$("#password_security").html(b+e).removeClass("invisible"),$("#helpText").removeClass("invisible")),f=$("#password").val(),g=zxcvbn(f),a=51*(toInt(g.score)+1),h=255-toInt(16*Math.pow(g.score,2)),0>h&&(h=0),d="rgb("+h+","+a+",0)",i="\nprogress[value]::-webkit-progress-value { background: -webkit-linear-gradient(left,rgb(255,0,30),"+d+"), -webkit-linear-gradient(top,rgba(255, 255, 255, .5), rgba(0, 0, 0, .5)); }",c="\nprogress::-moz-progress-bar { background: -moz-linear-gradient(left,rgb(255,0,30),"+d+"), -moz-linear-gradient(top,rgba(255, 255, 255, .5), rgba(0, 0, 0, .5)); }",$("#dynamic").exists()||$("<style type='text/css' id='dynamic' />").appendTo("head"),$("#dynamic").text(i+c),$(".strength-eval").css("background",window.passwords.badbg),f.length>=window.passwords.overrideLength?$(".strength-eval").css("background",window.passwords.goodbg):(f.match(/^(?:((?=.*\d)|(?=.*\W+)).*$)$/)&&$("#strength-numspecial .strength-eval").css("background",window.passwords.goodbg),f.match(/^(?=.*[a-z]).*$/)&&$("#strength-alpha .strength-eval").css("background",window.passwords.goodbg),f.match(/^(?=.*[A-Z]).*$/)&&$("#strength-alphacap .strength-eval").css("background",window.passwords.goodbg)),$("#password-strength").attr("value",g.score+1),$("#crack-time").text(g.crack_time_display)},doEmailCheck=function(){},doTOTPSubmit=function(a){var b,c,d,e,f,g,h,i;return null==a&&(a=window.totpParams.home),noSubmit(),animateLoad(),d=$("#totp_code").val(),i=$("#username").val(),f=$("#password").val(),e=$("#remote").val(),url=$.url(),b="async_login_handler.php",h=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+b,c="action=verifytotp&code="+d+"&user="+i+"&password="+f+"&remote="+e,g=$.post(h,c,"json"),g.done(function(b){var c,d;if(b.status!==!0)return $("#totp_message").text(b.human_error).addClass("error"),$("#totp_code").val(""),$("#totp_code").focus(),stopLoadError(),console.error("Invalid code error",b.error,b);try{return $("#totp_message").text("Correct!").removeClass("error").addClass("good"),d=0,$.each(b.cookies.raw_cookie,function(c,e){var f;try{$.cookie(c,e,b.cookies.expires)}catch(g){f=g,console.error("Couldn't set cookies",b.cookies.raw_cookie)}return d++,d===Object.size(b.cookies.raw_cookie)?(null==a&&(a=url.attr("protocol")+"://"+url.attr("host")+"/"),stopLoad(),delay(500,function(){return window.location.href=a})):void 0})}catch(e){return c=e,console.error("Unexpected error while validating",c.message)}}),g.fail(function(a,b){return $("#totp_message").text("Failed to contact server. Please try again.").addClass("error"),console.error("AJAX failure",h+"?"+c,a,b),stopLoadError()})},doTOTPRemove=function(){var a,b,c,d,e,f,g;return noSubmit(),animateLoad(),g=$("#username").val(),d=encodeURIComponent($("#password").val()),c=$("#code").val(),url=$.url(),a="async_login_handler.php",f=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,b="action=removetotp&code="+c+"&username="+g+"&password="+d+"&base64=true",e=$.post(f,b,"json"),e.done(function(a){return a.status!==!0?($("#totp_message").text(a.human_error).addClass("error"),console.error(a.error),console.warn(""+f+"?"+b),console.warn(a),stopLoadError(),!1):($("#totp_message").removeClass("error").addClass("good").text("Two-factor authentication removed for "+a.username+"."),$("#totp_remove").remove(),console.log(f+"?"+b),console.log(a),stopLoad(),!1)}),e.fail(function(a,c){return $("#totp_message").text("Failed to contact server. Please try again.").addClass("error"),console.error("AJAX failure",f+"?"+b,a,c),stopLoadError()})},makeTOTP=function(){var a,b,c,d,e,f,g,h;return noSubmit(),animateLoad(),h=$("#username").val(),e=$("#password").val(),c=$("#hash").val(),d=$("#secret").val(),url=$.url(),a="async_login_handler.php",g=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,b="action=maketotp&password="+e+"&user="+h,f=$.post(g,b,"json"),f.done(function(a){var e,f,i,j,k,l;return a.status===!0?($("#totp_message").html("To continue, scan this barcode with your smartphone authenticator application. <small><a href='#' id='alt_totp_help'>Don't have the app?</a></small>").removeClass("error").addClass("good"),console.log(a),l=a.svg,i=a.raw,k="show_secret",j="showAltBarcode",e="secretBarcode",f="<form id='totp_verify' onsubmit='event.preventDefault();'> <p style='font-weight:bold'>If you're unable to do so, <a href='#' id='"+k+"'>click here to manually input your key.</a></p> <div id='"+e+"'> "+a.svg+" <p>Don't see the barcode? <a href='#' id='"+j+"' role='button' class='btn btn-link'>Click here</a></p> </div> <p>Once you've done so, enter the code generated by your app in the field below to verify your setup.</p> <fieldset> <legend>Confirmation</legend> <input type='number' pattern='[0-9]{6}' size='6' maxlength='6' id='code' name='code' placeholder='Code'/> <input type='hidden' id='username' name='username' value='"+h+"'/> <input type='hidden' id='hash' name='hash' value='"+c+"'/> <input type='hidden' id='secret' name='secret' value='"+d+"'/> <button id='verify_totp_button' class='totpbutton'>Verify</button> </fieldset> </form>",$("#totp_start").remove(),$("#totp_message").after(f),$("#alt_totp_help").click(function(){return showInstructions()}),$("#"+k).click(function(){return popupSecret(a.human_secret)}),$("#"+j).click(function(){var b;return b="<img src='"+a.raw+"' alt='TOTP barcode'/>",$(""+barcode_div).html(b),$("#"+j).remove()}),$("#verify_totp_button").click(function(){return noSubmit(),saveTOTP(d,c)}),$("#totp_verify").submit(function(){return noSubmit(),saveTOTP(d,c)}),stopLoad()):(console.error("Couldn't generate TOTP code",g+"?"+b),console.warn(a),$("#totp_message").text("There was an error generating your code. "+a.message).addClass("error"),stopLoadError())}),f.fail(function(a,c){return $("#totp_message").text("Failed to contact server. Please try again.").addClass("error"),console.error("AJAX failure",g+"?"+b,a,c),stopLoadError()}),!1},saveTOTP=function(a,b){var c,d,e,f,g,h;return noSubmit(),animateLoad(),e=$("#code").val(),b=$("#hash").val(),a=$("#secret").val(),h=$("#username").val(),url=$.url(),c="async_login_handler.php",g=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+c,d="action=savetotp&secret="+a+"&user="+h+"&hash="+b+"&code="+e,f=$.post(g,d,"json"),f.done(function(a){var b;return a.status===!0?(b="<h1>Done!</h1><h2>Write down and save this backup code. Without it, you cannot disable two-factor authentication if you lose your device.</h2><pre id='backup_code'>"+a.backup+"</pre><br/><button id='to_home'>Home &#187;</a>",$("#totp_add").html(b),$("#to_home").click(function(){return window.location.href=window.totpParams.home}),stopLoad()):(b="<p class='error' id='temp_error'>"+a.human_error+"</p>",$("#temp_error").exists()?$("#temp_error").html(b):$("#verify_totp_button").after(b),console.error(a.error),stopLoadError())}),f.fail(function(a,b){return $("#totp_message").text("Failed to contact server. Please try again."),console.error("AJAX failure",a,b),stopLoadError()})},popupSecret=function(a){var b;return $("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.popStylesheetPath}).appendTo("head"),b="<div id='cover_wrapper'><div id='secret_id_panel' class='"+window.totpParams.popClass+" cover_content'><p class='close-popup'>X</p><h2>"+a+"</h2></div></div>",$("article").after(b),$("article").addClass("blur"),$(".close-popup").click(function(){return $("#cover_wrapper").remove(),$("article").removeClass("blur")})},giveAltVerificationOptions=function(){var a,b,c,d,e,f,g,h,i,j;return url=$.url(),a="async_login_handler.php",i=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,j=$("#username").val(),b="action=cansms&user="+j,f="remove_totp_link",h="send_totp_sms",d="alt_auth_pane",e="alt_auth_messages",$("#"+d).exists()?($("#"+d).toggle("fast"),!1):(c=new Object,c.remove="<a href='#' id='"+f+"' role='button' class='btn btn-default'>Remove two-factor authentication</a>",g=$.get(i,b,"json"),g.done(function(a){var f,g;return a[0]===!0?c.sms="<a href='#' id='"+h+"' role='button' class='btn btn-default'>Send SMS</a>":console.warn("Couldn't get a valid result",a,i+"?"+b),g="",$.each(c,function(a,b){return g+=b}),f="<div id='"+d+"'><p>"+g+"</p><p id='"+e+"'></p></div>",$("#totp_submit").after(f),$("#"+h).click(function(){var a;return b="action=sendtotptext&user="+j,a=$.get(i,b,"json"),console.log("Sending message ...",i+"?"+b),a.done(function(a){return a.status===!0?($("#"+d).remove(),$("#totp_message").text(a.message)):($("#"+e).addClass("error").text(a.human_error),console.error(a.error))}),a.fail(function(a,c){return console.error("AJAX failure trying to send TOTP text",i+"?"+b),console.error("Returns:",a,c)})})}),g.fail(function(a,b){return console.error("Could not check SMS-ability",a,b)}),g.always(function(){return $("#"+f).click(function(){var a;return a="\n  <p id='totp_message' class='error'>Are you sure you want to disable two-factor authentication?</p>\n  <form id='totp_remove' onsubmit='event.preventDefault();'>\n    <fieldset>\n      <legend>Remove Two-Factor Authentication</legend>\n      <input type='email' value='"+j+"' readonly='readonly' id='username' name='username'/><br/>\n      <input type='password' id='password' name='password' placeholder='Password'/><br/>\n      <input type='text' id='code' name='code' placeholder='Authenticator Code or Backup Code' size='32' maxlength='32' autocomplete='off'/><br/>\n      <button id='remove_totp_button' class='totpbutton btn btn-danger'>Remove Two-Factor Authentication</button>\n    </fieldset>\n  </form>\n",$("#totp_prompt").html(a).attr("id","totp_remove_section"),$("#totp_remove").submit(function(){return doTOTPRemove()}),$("#remove_totp_button").click(function(){return doTOTPRemove()})})}))},verifyPhone=function(){var a,b,c,d,e,f;return noSubmit(),url=$.url(),a="async_login_handler.php",d=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,c=null!=$("#phone_auth").val()?$("#phone_auth").val():null,e=$("#username").val(),b="action=verifyphone&username="+e+"&auth="+c,f=$.get(d,b,"json"),f.done(function(a){var b,c;return a.status===!1?($("#phone_verify_message").exists()||$("#phone").before("<p id='phone_verify_message'></p>"),a.is_good===!0?($("#verify_phone_button").remove(),b="You've already verified your phone number, thanks!",c="good"):(b=a.human_error,c="error",console.error(a.error)),$("#phone_verify_message").text(b).addClass(c),a.fatal===!0&&($("#verify_phone_button").attr("disabled",!0),$("#verify_phone").unbind("submit").attr("onsubmit","")),!1):a.status===!0?($("#phone_auth").exists()||$("#username").after("<br/><input type='text' length='8' name='phone_auth' id='phone_auth' placeholder='Authorization Code'/>"),$("#phone_verify_message").exists()||$("#phone").before("<p id='phone_verify_message'></p>"),$("#phone_verify_message").text(a.message),a.is_good!==!0?$("#verify_phone_button").text("Confirm"):($("#phone_auth").remove(),$("#verify_later").remove(),$("#verify_phone_button").html("Continue &#187; ").unbind("click").click(function(){return window.location.href=window.totpParams.home}))):(console.warn("Unexpected condition encountered verifying the phone number",d),console.log(a),!1)}),f.fail(function(a,c){return console.error("AJAX failure trying to send phone verification text",d+"?"+b),console.error("Returns:",a,c)})},showInstructions=function(a){return null==a&&(a="help/instructions_pop.html"),$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.popStylesheetPath}).appendTo("head"),$.get(window.totpParams.relative+a).done(function(a){var b;return $("article").after(a),$("article").addClass("blur"),b=""+window.totpParams.relative+"assets/",$(".android").html("<img src='"+b+"playstore.png' alt='Google Play Store'/>"),$(".ios").html("<img src='"+b+"appstore.png' alt='iOS App Store'/>"),$(".wp8").html("<img src='"+b+"wpstore.png' alt='Windows Phone Store'/>"),$(".large_totp_icon").each(function(){var a;return a=b+$(this).attr("src"),$(this).attr("src",a)}),$(".app_link_container a").addClass("newwindow"),mapNewWindows(),$(".close-popup").click(function(){return $("article").removeClass("blur"),$("#cover_wrapper").remove()})}).fail(function(b,c){return console.error("Failed to load instructions @ "+a,b,c)})},showAdvancedOptions=function(a,b){var c,d;return c="advanced_options_list",$("#"+c).exists()?($("#"+c).toggle("fast"),!0):(d="<ul id='"+c+"'>",d+="<li><a href='?2fa=t' role='button' class='btn btn-default'>Configure Two-Factor Authentication</a></li>",d+="<li><a href='#' id='removeAccount' role='button' class='btn btn-default'>Remove Account</a></li>",$("#settings_list").after(d),$("#removeAccount").click(function(){return removeAccount(this,""+a+"_user",b)}))},removeAccount=function(a,b,c){var d,e,f,g,h;return null==c&&(c=!0),h=$.cookie(b),e="remove_acct_button",f="remove_account_section",g=c?"\n      <input type='text' id='code' name='code' placeholder='Authenticator Code or Backup Code' size='32' maxlength='32' autocomplete='off'/><br/>":"",d="<section id='"+f+"'>\n  <p id='remove_message' class='error'>Are you sure you want to remove your account?</p>\n  <form id='account_remove' onsubmit='event.preventDefault();'>\n    <fieldset>\n      <legend>Remove My Account</legend>\n      <input type='email' value='"+h+"' readonly='readonly' id='username' name='username'/><br/>\n      <input type='password' id='password' name='password' placeholder='Password'/><br/>"+g+"\n      <button id='"+e+"' class='totpbutton btn btn-danger'>Remove My Account Permanantly</button> <button onclick=\"window.location.href=totpParams.home\" class='btn btn-primary'>Back to Safety</button>\n    </fieldset>\n  </form>\n</section>",$("#login_block").exists()?$("#login_block").replaceWith(d):$(a).after(d),$("#"+e).click(function(){return doRemoveAccountAction()}),$("#account_remove").submit(function(){return doRemoveAccountAction()})},doRemoveAccountAction=function(){var a,b,c,d,e,f;return animateLoad(),url=$.url(),a="async_login_handler.php",e=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,f=$("#username").val(),d=$("#password").val(),c=$("#code").exists()?$("#code").val():!1,b="action=removeaccount&username="+f+"&password="+d+"&code="+c,$.post(e,b,"json").done(function(a){return a.status===!0?($("#remove_message").text("Your account has been successfully deleted."),$.each($.cookie(),function(a){return $.removeCookie(a,{path:"/"})}),delay(3e3,function(){return window.location.href=window.totpParams.home}),stopLoad()):($("#remove_message").text("There was an error removing your account. Please try again."),console.error("Got an error-result: ",a.error),console.warn(e+"?"+b,a),stopLoadError())}).fail(function(a,c){return $("#remove_message").text(a.error).addClass("error"),$("totp_code").val(""),console.error("Ajax Failure",e+"?"+b,a,c),stopLoadError()})},noSubmit=function(){return event.preventDefault(),event.returnValue=!1},doAsyncLogin=function(a,b){var c,d,e,f,g;return null==a&&(a="async_login_handler.php"),null==b&&(b=!0),noSubmit(),f=b?url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a:a,g=$("#username").val(),e=$("#password").val(),d=Base64.encodeURI(e),c="action=dologin&username="+g+"&password="+d+"&b64=true",!1},doAsyncCreate=function(){var a;return a=grecaptcha.getResponse(),a.success!==!0?($("#createUser_submit").before("<p id='createUser_fail' class='bg-danger'>Sorry, your CAPTCHA was incorrect. Please try again.</p>"),grecaptcha.reset(),!1):($("#createUser_fail").remove(),!1)},resetPassword=function(){var a,b,c,d,e,f,g;return $("#password").remove(),$("label[for='password']").remove(),$("#reset-password-icon").remove(),$(".alert").remove(),$("#form_create_new_account").remove(),$(".tooltip").remove(),e="reset-user-messages",$("#"+e).exists()||$("#login").before("<div id='"+e+"'></div>"),$("#"+e).removeClass("alert-danger alert-info").addClass("alert alert-warning").text("Once your password has been reset, your old password will be invalid."),url=$.url(),a="async_login_handler.php",g=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,c='<button class="btn btn-warning" id="check-login">Start Reset</button>',$("#login_button").replaceWith(c),b="action=startpasswordreset",d=function(a){return null==a&&(a=b),$(".reset-pass-button").unbind().click(function(){var b,c;return c=$("#totp").val(),null!=c&&(a+="&totp="+c),b=$(this).attr("data-method"),f(a,b),!1}),!1},f=function(a,b){var c;return c=$("#username").val(),null==a&&(a="action=startpasswordreset&username="+c),animateLoad(),$.get(g,a,"json").done(function(f){var h,i,j,k,l,m,n,o;if(f.status===!1)switch(isNull(f.human_error)&&(f.human_error=void 0),console.log("Got requested action "+f.action,f),console.log("Requested",""+g+"?"+a),$("#username").prop("disabled",!0),f.action){case"GET_TOTP":return n=!1,j="<legend>Two-Factor Authentication</legend>\n<p><code>"+c+'</code> has two-factor authentication enabled.</p>\n<div id=\'start-reset-process\' class="totp">\n  <div class="form-group">\n    <label for="totp">Authentication Code:</label>\n    <input type="number" class="form-control" id="totp" name="totp"/>\n  </div>\n</div>\n<button class=\'reset-pass-button btn btn-danger\' data-method=\'email\'>\n  Verify By Email\n</button>',f.canSMS&&(k="reset-user-sms-totp",m="<button class='btn btn-primary' id='"+k+"'>Text Code</button>",$("#start-reset-process").after(m),$("#"+k).click(function(){var b,f;return animateLoad(),b="action=sendtotptext&user="+c,f=$.get(g,b,"json"),console.log("Sending message ...",g+"?"+a),f.done(function(b){var c;return b.status===!0?($("#"+e).text("Your code has been sent to your registered number.").removeClass("alert-warning alert-danger").addClass("alert-info"),n=!0,c='<button class="reset-pass-button btn btn-danger" data-method="email">\n  Verify by SMS\n</button>',$("#"+k).replaceWith(c),d(a)):($("#"+e).addClass("alert-danger").text(b.human_error),console.error(b.error))}),f.fail(function(b,c){return $("#"+e).addClass("alert-danger").text("There was a problem sending your text. Please try again."),console.error("AJAX failure trying to send TOTP text",g+"?"+a),console.error("Returns:",b,c)}),f.always(function(){return stopLoad()})})),$("#login").replaceWith(j).unbind().submit(function(){return noSubmit(),doTotpSubmission()}),d(a),!1;case"NEED_METHOD":return j="<p>Resetting password for <code>"+c+"</code></p>",f.canSMS&&n!==!0&&(j="<button class='reset-pass-button btn btn-danger' data-method='sms'>Verify by SMS</button>"),j+="<button class='reset-pass-button btn btn-danger' data-method='email'>\n  Verify by Email\n</button>",$("#login").replaceWith(j),d(a),!1;case"BAD_USER":return $("#"+e).addClass("alert-danger").text("Sorry, that user doesn't exist."),$("#username").prop("disabled",!1).val(""),!1;default:return l=null!=(o=f.human_error)?o:"There was a problem resetting your password. Please try again",$("#"+e).addClass("alert-danger").removeClass("alert-info alert-warning").text(l),console.error("Illegal state!"),console.warn(f),!1}else console.log("Got a good result."),console.log(f),$(".form-group").remove(),i=function(){var a;return a='<legend>Verify Reset</legend>\n<div class="form-group">\n  <label for="verify">Verification Token:</label>\n  <input type="text" class="form-control" id="verify" name="verify" />\n</div>\n<div class="form-group">\n  <label for="key">Key:</label>\n  <input type="text" class="form-control" id="key" name="key" />\n</div>\n<input type="hidden" id="username" name="username" value="'+c+'" />\n<button class="btn btn-success" id="verify-now">Verify Now</button>',$("#login").html(a).unbind().submit(function(){return noSubmit(),finishPasswordResetHandler()}),$("#verify-now").click(function(){return finishPasswordResetHandler()})},("email"===b||null==b)&&($("#"+e).removeClass("alert-warning alert-danger").addClass("alert-info").text("Check your email for your reset link. Once you've clicked that, your password will be reset."),h="<button class='btn btn-default' id='manual-input'>Manually Input Verification</button>",$("#check-login").replaceWith(h),$("#manual-input").click(function(){return i()})),"sms"===b&&i();return stopLoad(),!1}).fail(function(){return stopLoadError(),$("#"+e).removeClass("alert-info alert-warning").addClass("alert-danger").text("We couldn't process the password reset. Please try again."),!1})},$("#login").unbind().submit(function(){return noSubmit(),f()}),$("#check-login").unbind().click(function(){return noSubmit(),f()})},finishPasswordResetHandler=function(){var a,b,c,d,e,f,g;return g="",d="",url=$.url(),$("input#verify").exists()?(g=$("input#verify").val().trim(),d=$("input#key").val().trim(),f=$("input#username").val()):(g=window.resetParams.verify,d=window.resetParams.key,f=window.resetParams.user,isNull(g)&&(g=$.url().param("verify"),d=$.url().param("key"),f=$.url().param("user")),c="<h1>Password Reset Confirmation</h1>\n<div id='login'></div>",$("body").append(c)),isNull(g)||isNull(d)?($(".alert").exists()&&$(".alert").remove(),c='<div class="alert alert-danger">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Yikes!</strong> We need both the verification token and key to continue resetting your password.\n</div>',$("#login").before(c),$(".alert").alert(),!1):(a="async_login_handler.php",e=url.attr("protocol")+"://"+url.attr("host")+"/"+window.totpParams.subdirectory+a,b="action=finishpasswordreset&key="+d+"&verify="+g+"&username="+f,$.post(e,b,"json").done(function(a){return a.status?(c='<div class="alert alert-success">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Your password has been successfully reset</strong> Your new password is <strong>'+a.new_password+"</strong>. Write this down! You will NOT be able to generate or see this password again.\n</div>",$("#login").replaceWith(c),$(".alert").alert(),!1):($(".alert").exists()&&$(".alert").remove(),c='<div class="alert alert-danger">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>There was a problem resetting your password.</strong> '+a.human_error+"\n</div>",$("#login").before(c),$(".alert").alert(),!1)
}).fail(function(){return c='<div class="alert alert-danger">\n  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n  <strong>Yikes!</strong> We had a problem checking the server. Try again later.\n</div>',$("#login").before(c),$(".alert").alert(),console.error("Couldn't communicate with server! Tried to contact",""+e+"?args"),!1}),!1)},$(function(){var a,b;b=null==window.passwords.submitSelector?"#createUser_submit":window.passwords.submitSelector,$("#password.create").exists()&&(loadJS(window.totpParams.relative+"js/zxcvbn/zxcvbn.js"),$("#password.create").keyup(function(){return checkPasswordLive()}).change(function(){return checkPasswordLive()}),$("#password2").change(function(){return checkMatchPassword()}).keyup(function(){return checkMatchPassword()}),$("input").addClass("form-control").parent().addClass("form-inline").blur(function(){return checkPasswordLive()}),$("#password").after("<span id='feedback-status-1'></span>").parent().removeClass("form-inline").parent().addClass("has-feedback").parent().addClass("form-horizontal"),$("#password2").after("<span id='feedback-status-2'></span>").parent().removeClass("form-inline").parent().addClass("has-feedback").parent().addClass("form-horizontal")),$("#totp_submit").submit(function(){return doTOTPSubmit()}),$("#verify_totp_button").click(function(){return doTOTPSubmit()}),$("#totp_start").submit(function(){return makeTOTP()}),$("#add_totp_button").click(function(){return makeTOTP()}),$("#totp_remove").submit(function(){return doTOTPRemove()}),$("#remove_totp_button").click(function(){return doTOTPRemove()}),$("#alternate_verification_prompt").click(function(){return giveAltVerificationOptions(),!1}),$("#verify_phone").submit(function(){return verifyPhone()}),$("#verify_phone_button").click(function(){return verifyPhone()}),$("#verify_later").click(function(){return window.location.href=window.totpParams.home}),$("#totp_help").click(function(){return showInstructions()}),$("#showAdvancedOptions").click(function(){var a,b;return a=$(this).attr("data-domain"),b="true"===$(this).attr("data-user-tfa")?!0:!1,showAdvancedOptions(a,b)}),$(".do-password-reset").click(function(){return resetPassword(),!1});try{loadJS("http://ssarherps.org/cndb/bower_components/bootstrap/dist/js/bootstrap.min.js",function(){return $(".do-password-reset").unbind(),$("#reset-password-icon").tooltip(),$(".do-password-reset").click(function(){return resetPassword(),!1}),$(".alert").alert()})}catch(c){a=c,console.log("Couldn't tooltip icon!")}try{null!=$.url().param("showhelp")&&showInstructions()}catch(c){a=c,delay(300,function(){return null!=$.url().param("showhelp")?showInstructions():void 0})}try{window.checkPasswordReset===!0&&finishPasswordResetHandler()}catch(c){a=c,console.error("Couldn't check password reset state! "+a.message)}return $("#next.continue").click(function(){return window.location.href=window.totpParams.home}),$("<link/>",{rel:"stylesheet",type:"text/css",media:"screen",href:window.totpParams.combinedStylesheetPath}).appendTo("head")});
//# sourceMappingURL=maps/c.map